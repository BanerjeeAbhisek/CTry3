<!DOCTYPE html>
<html lang="en"><head>
<script src="NormalisingFlows_files/libs/clipboard/clipboard.min.js"></script>
<script src="NormalisingFlows_files/libs/quarto-html/tabby.min.js"></script>
<script src="NormalisingFlows_files/libs/quarto-html/popper.min.js"></script>
<script src="NormalisingFlows_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="NormalisingFlows_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="NormalisingFlows_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="NormalisingFlows_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.1.189">

  <meta name="author" content="Abhisek Banerjee">
  <title>Normalizing Flows</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="NormalisingFlows_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="NormalisingFlows_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="NormalisingFlows_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link rel="stylesheet" href="styles.css">
  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
  <link href="NormalisingFlows_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="NormalisingFlows_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="NormalisingFlows_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="NormalisingFlows_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="NormalisingFlows_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="NormalisingFlows_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script type="module" src="NormalisingFlows_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
  <link href="NormalisingFlows_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&amp;display=swap" rel="stylesheet">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="assets/tigerstripes.png" data-background-position="center" data-background-size="cover" class="center">
  <h1 class="title">Normalizing Flows</h1>
  <p class="author">Abhisek Banerjee</p>
</section>

<section id="outline" class="slide level2">
<h2>Outline</h2>
<div class="toc-card">
<ol type="1">
<li><a href="#/motivation">Motivation</a></li>
<li><a href="#/NormFlows">Normalizing Flows</a><br>
</li>
<li><a href="#/InfNormFlow">Inference with Normalizing Flows</a><br>
</li>
<li><a href="#/AlgoNormFlows">Algorithm of Normalizing Flows</a></li>
<li><a href="#/BFlowStart">Bayes Flow</a><br>
</li>
<li><a href="#/AlgoBayesFlow">Algorithm of Bayes Flow</a></li>
<li><a href="#/DevelopNormFlow">Recent Developments in Normalizing Flows</a></li>
<li><a href="#/SummNormFlow">Summary of Normalizing Flow Families</a></li>
<li><a href="#/FutureDir">Future Directions of Normalizing Flows</a></li>
</ol>
</div>
</section>
<section id="motivation" class="slide level2">
<h2>Motivation</h2>
<h3 id="variational-inference-the-core-problem">Variational inference: the core problem</h3>
<p>We consider a latent variable model with observations <span class="math inline">x</span> and latent variables <span class="math inline">z</span> and parameter <span class="math inline">\theta</span>.</p>
<p>The posterior <span class="math display">
p_\theta(z \mid x)
</span> is typically <strong>intractable</strong>.</p>
<h3 id="variational-idea">Variational idea</h3>
<p>Introduce a tractable approximation <span class="math display">
q_\phi(z \mid x) \approx p_\theta(z \mid x),
</span> and optimize the evidence lower bound (ELBO): <span class="math display">
\log p_\theta(x)
\;\ge\;
\mathbb{E}_{q_\phi(z \mid x)}\!\left[\log p_\theta(x \mid z)\right]
-
\mathrm{D_{KL}}\!\left(q_\phi(z \mid x)\,\|\,p(z)\right).
</span></p>
</section>
<section id="reparameterization-trick" class="slide level2">
<h2>Reparameterization trick</h2>
<p>Assume a Gaussian variational posterior: <span class="math display">
q_\phi(z \mid x) = \mathcal{N}\!\big(z | \mu(x), \sigma^2(x)\big).
</span></p>
<p><br></p>
<h3 id="reparameterize">Reparameterize</h3>
<p>Instead of sampling <span class="math inline">z \sim q_\phi</span>, write: <span class="math display">
z = \mu(x) + \sigma(x)\,\varepsilon,
\qquad
\varepsilon \sim \mathcal{N}(0, I).
</span></p>
<p><br></p>
<h3 id="result">Result</h3>
<p>Gradients move <strong>inside</strong> the expectation: <span class="math display">
\nabla_\phi
\mathbb{E}_{q_\phi(z \mid x)}[f(z)]
=
\mathbb{E}\!\left[
\nabla_\phi f\big(\mu(x)+\sigma(x)\varepsilon\big)
\right].
</span></p>
</section>
<section id="the-problem-with-standard-amortized-vi" class="slide level2">
<h2>The problem with standard amortized VI</h2>
<p>In practice, <span class="math inline">q_\phi(z \mid x)</span> is chosen to be <strong>simple</strong>:</p>
<p><span class="math display">
q_\phi(z \mid x)
=
\mathcal{N}\!\big(z | \mu_\phi(x), \mathrm{diag}(\sigma_\phi^2(x))\big).
</span></p>
<h3 id="consequences">Consequences</h3>
<ul>
<li>Mean-field independence assumptions</li>
<li>Cannot represent:
<ul>
<li>multimodality</li>
<li>strong correlations</li>
<li>complex posterior geometry</li>
</ul></li>
</ul>
<h3 id="empirical-issues-well-documented">Empirical issues (well documented)</h3>
<ul>
<li>Underestimation of posterior variance</li>
<li>Biased parameter estimates</li>
<li>Poor uncertainty quantification</li>
</ul>
</section>
<section id="what-do-we-want-from-a-variational-posterior" class="slide level2">
<h2>What do we want from a variational posterior?</h2>
<p>An ideal variational family should be:</p>
<ul>
<li>Flexible enough to approximate the true posterior</li>
<li>Compatible with reparameterization</li>
<li>Scalable with amortized inference</li>
<li>Computationally tractable</li>
</ul>
<p><br></p>
<h3 id="key-question">Key question</h3>
<p>Can we start with a simple distribution and <strong>systematically increase its complexity</strong>?</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="216" data-source-offset="0"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 215;"><span id="cb1-216"><a href="#cb1-216"></a>flow_strip_anim <span class="op">=</span> {</span>
<span id="cb1-217"><a href="#cb1-217"></a>  <span class="kw">const</span> W <span class="op">=</span> <span class="dv">920</span><span class="op">,</span> H <span class="op">=</span> <span class="dv">170</span><span class="op">,</span> pad <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb1-218"><a href="#cb1-218"></a>  <span class="kw">const</span> panels <span class="op">=</span> <span class="dv">4</span><span class="op">,</span> panelW <span class="op">=</span> W <span class="op">/</span> panels<span class="op">;</span></span>
<span id="cb1-219"><a href="#cb1-219"></a></span>
<span id="cb1-220"><a href="#cb1-220"></a>  <span class="co">// sample base points</span></span>
<span id="cb1-221"><a href="#cb1-221"></a>  <span class="kw">const</span> n <span class="op">=</span> <span class="dv">320</span><span class="op">;</span></span>
<span id="cb1-222"><a href="#cb1-222"></a>  <span class="kw">const</span> pts0 <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(n)<span class="op">.</span><span class="fu">map</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb1-223"><a href="#cb1-223"></a>    <span class="kw">const</span> u1 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">,</span> u2 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">;</span></span>
<span id="cb1-224"><a href="#cb1-224"></a>    <span class="kw">const</span> r <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="op">-</span><span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(u1))<span class="op">;</span></span>
<span id="cb1-225"><a href="#cb1-225"></a>    <span class="kw">const</span> a <span class="op">=</span> <span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span>u2<span class="op">;</span></span>
<span id="cb1-226"><a href="#cb1-226"></a>    <span class="cf">return</span> [r<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(a)<span class="op">,</span> r<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(a)]<span class="op">;</span></span>
<span id="cb1-227"><a href="#cb1-227"></a>  })<span class="op">;</span></span>
<span id="cb1-228"><a href="#cb1-228"></a></span>
<span id="cb1-229"><a href="#cb1-229"></a>  <span class="co">// STRONGER, visually distinct warps</span></span>
<span id="cb1-230"><a href="#cb1-230"></a>  <span class="kw">const</span> f1 <span class="op">=</span> ([x<span class="op">,</span>y]) <span class="kw">=&gt;</span> [x <span class="op">+</span> <span class="fl">1.2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">tanh</span>(<span class="fl">1.2</span><span class="op">*</span>y)<span class="op">,</span> y]<span class="op">;</span>                   <span class="co">// big shear</span></span>
<span id="cb1-231"><a href="#cb1-231"></a>  <span class="kw">const</span> f2 <span class="op">=</span> ([x<span class="op">,</span>y]) <span class="kw">=&gt;</span> {</span>
<span id="cb1-232"><a href="#cb1-232"></a>    <span class="kw">const</span> th <span class="op">=</span> <span class="fl">0.55</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">tanh</span>(<span class="fl">0.9</span><span class="op">*</span>x)<span class="op">;</span>                                    <span class="co">// local rotation</span></span>
<span id="cb1-233"><a href="#cb1-233"></a>    <span class="kw">const</span> c <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(th)<span class="op">,</span> s <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(th)<span class="op">;</span></span>
<span id="cb1-234"><a href="#cb1-234"></a>    <span class="cf">return</span> [c<span class="op">*</span>x <span class="op">-</span> s<span class="op">*</span>y<span class="op">,</span> s<span class="op">*</span>x <span class="op">+</span> c<span class="op">*</span>y]<span class="op">;</span></span>
<span id="cb1-235"><a href="#cb1-235"></a>  }<span class="op">;</span></span>
<span id="cb1-236"><a href="#cb1-236"></a>  <span class="kw">const</span> f3 <span class="op">=</span> ([x<span class="op">,</span>y]) <span class="kw">=&gt;</span> {</span>
<span id="cb1-237"><a href="#cb1-237"></a>    <span class="kw">const</span> r <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(x<span class="op">*</span>x <span class="op">+</span> y<span class="op">*</span>y) <span class="op">+</span> <span class="fl">1e-6</span><span class="op">;</span></span>
<span id="cb1-238"><a href="#cb1-238"></a>    <span class="kw">const</span> k <span class="op">=</span> <span class="fl">0.9</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">tanh</span>(<span class="fl">1.0</span><span class="op">*</span>(r<span class="op">-</span><span class="fl">1.1</span>))<span class="op">;</span>                                <span class="co">// twist/radial</span></span>
<span id="cb1-239"><a href="#cb1-239"></a>    <span class="cf">return</span> [x <span class="op">+</span> k<span class="op">*</span>(<span class="op">-</span>y)<span class="op">,</span> y <span class="op">+</span> k<span class="op">*</span>(x)]<span class="op">;</span></span>
<span id="cb1-240"><a href="#cb1-240"></a>  }<span class="op">;</span></span>
<span id="cb1-241"><a href="#cb1-241"></a></span>
<span id="cb1-242"><a href="#cb1-242"></a>  <span class="kw">const</span> steps <span class="op">=</span> [</span>
<span id="cb1-243"><a href="#cb1-243"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"z₀"</span><span class="op">,</span> <span class="dt">pts</span><span class="op">:</span> pts0}<span class="op">,</span></span>
<span id="cb1-244"><a href="#cb1-244"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"z₁"</span><span class="op">,</span> <span class="dt">pts</span><span class="op">:</span> pts0<span class="op">.</span><span class="fu">map</span>(f1)}<span class="op">,</span></span>
<span id="cb1-245"><a href="#cb1-245"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"z₂"</span><span class="op">,</span> <span class="dt">pts</span><span class="op">:</span> pts0<span class="op">.</span><span class="fu">map</span>(f1)<span class="op">.</span><span class="fu">map</span>(f2)}<span class="op">,</span></span>
<span id="cb1-246"><a href="#cb1-246"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"z₃"</span><span class="op">,</span> <span class="dt">pts</span><span class="op">:</span> pts0<span class="op">.</span><span class="fu">map</span>(f1)<span class="op">.</span><span class="fu">map</span>(f2)<span class="op">.</span><span class="fu">map</span>(f3)}</span>
<span id="cb1-247"><a href="#cb1-247"></a>  ]<span class="op">;</span></span>
<span id="cb1-248"><a href="#cb1-248"></a></span>
<span id="cb1-249"><a href="#cb1-249"></a>  <span class="kw">const</span> xS <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">4</span><span class="op">,</span><span class="dv">4</span>])<span class="op">.</span><span class="fu">range</span>([pad<span class="op">,</span> panelW<span class="op">-</span>pad])<span class="op">;</span></span>
<span id="cb1-250"><a href="#cb1-250"></a>  <span class="kw">const</span> yS <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">4</span><span class="op">,</span><span class="dv">4</span>])<span class="op">.</span><span class="fu">range</span>([H<span class="op">-</span>pad<span class="op">,</span> pad])<span class="op">;</span></span>
<span id="cb1-251"><a href="#cb1-251"></a></span>
<span id="cb1-252"><a href="#cb1-252"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-253"><a href="#cb1-253"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="vs">`0 0 </span><span class="sc">${</span>W<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>H<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb1-254"><a href="#cb1-254"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span><span class="st">"100%"</span>)</span>
<span id="cb1-255"><a href="#cb1-255"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span><span class="st">"920px"</span>)</span>
<span id="cb1-256"><a href="#cb1-256"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span><span class="st">"170px"</span>)</span>
<span id="cb1-257"><a href="#cb1-257"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border"</span><span class="op">,</span><span class="st">"1px solid rgba(255,255,255,0.18)"</span>)</span>
<span id="cb1-258"><a href="#cb1-258"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border-radius"</span><span class="op">,</span><span class="st">"10px"</span>)<span class="op">;</span></span>
<span id="cb1-259"><a href="#cb1-259"></a></span>
<span id="cb1-260"><a href="#cb1-260"></a>  <span class="co">// panel frames + labels</span></span>
<span id="cb1-261"><a href="#cb1-261"></a>  steps<span class="op">.</span><span class="fu">forEach</span>((s<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb1-262"><a href="#cb1-262"></a>    <span class="kw">const</span> g <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>i<span class="op">*</span>panelW<span class="sc">}</span><span class="vs">,0)`</span>)<span class="op">;</span></span>
<span id="cb1-263"><a href="#cb1-263"></a></span>
<span id="cb1-264"><a href="#cb1-264"></a>    g<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb1-265"><a href="#cb1-265"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb1-266"><a href="#cb1-266"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> panelW<span class="op">-</span><span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> H<span class="op">-</span><span class="dv">4</span>)</span>
<span id="cb1-267"><a href="#cb1-267"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb1-268"><a href="#cb1-268"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"transparent"</span>)</span>
<span id="cb1-269"><a href="#cb1-269"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"rgba(255,255,255,0.12)"</span>)<span class="op">;</span></span>
<span id="cb1-270"><a href="#cb1-270"></a></span>
<span id="cb1-271"><a href="#cb1-271"></a>    g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-272"><a href="#cb1-272"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">18</span>)</span>
<span id="cb1-273"><a href="#cb1-273"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">14</span>)</span>
<span id="cb1-274"><a href="#cb1-274"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">650</span>)</span>
<span id="cb1-275"><a href="#cb1-275"></a>      <span class="op">.</span><span class="fu">text</span>(s<span class="op">.</span><span class="at">name</span>)<span class="op">;</span></span>
<span id="cb1-276"><a href="#cb1-276"></a></span>
<span id="cb1-277"><a href="#cb1-277"></a>    <span class="cf">if</span> (i <span class="op">&lt;</span> panels<span class="op">-</span><span class="dv">1</span>) {</span>
<span id="cb1-278"><a href="#cb1-278"></a>      svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-279"><a href="#cb1-279"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (i<span class="op">+</span><span class="dv">1</span>)<span class="op">*</span>panelW <span class="op">-</span> <span class="dv">10</span>)</span>
<span id="cb1-280"><a href="#cb1-280"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> H<span class="op">/</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">6</span>)</span>
<span id="cb1-281"><a href="#cb1-281"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">22</span>)</span>
<span id="cb1-282"><a href="#cb1-282"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.55</span>)</span>
<span id="cb1-283"><a href="#cb1-283"></a>        <span class="op">.</span><span class="fu">text</span>(<span class="st">"→"</span>)<span class="op">;</span></span>
<span id="cb1-284"><a href="#cb1-284"></a>    }</span>
<span id="cb1-285"><a href="#cb1-285"></a>  })<span class="op">;</span></span>
<span id="cb1-286"><a href="#cb1-286"></a></span>
<span id="cb1-287"><a href="#cb1-287"></a>  <span class="co">// draw dots in each panel (same indices, so we can interpolate)</span></span>
<span id="cb1-288"><a href="#cb1-288"></a>  <span class="kw">const</span> dotGroups <span class="op">=</span> steps<span class="op">.</span><span class="fu">map</span>((s<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb1-289"><a href="#cb1-289"></a>    <span class="cf">return</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-290"><a href="#cb1-290"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>i<span class="op">*</span>panelW<span class="sc">}</span><span class="vs">,0)`</span>)</span>
<span id="cb1-291"><a href="#cb1-291"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-292"><a href="#cb1-292"></a>      <span class="op">.</span><span class="fu">data</span>(pts0<span class="op">.</span><span class="fu">map</span>((p<span class="op">,</span> idx) <span class="kw">=&gt;</span> ({idx<span class="op">,</span> <span class="dt">p0</span><span class="op">:</span> p})))</span>
<span id="cb1-293"><a href="#cb1-293"></a>      <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-294"><a href="#cb1-294"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="fl">1.35</span>)</span>
<span id="cb1-295"><a href="#cb1-295"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.75</span>)<span class="op">;</span></span>
<span id="cb1-296"><a href="#cb1-296"></a>  })<span class="op">;</span></span>
<span id="cb1-297"><a href="#cb1-297"></a></span>
<span id="cb1-298"><a href="#cb1-298"></a>  <span class="co">// helper: interpolate between step a and b</span></span>
<span id="cb1-299"><a href="#cb1-299"></a>  <span class="kw">function</span> <span class="fu">lerp</span>(a<span class="op">,</span>b<span class="op">,</span>t){ <span class="cf">return</span> a <span class="op">+</span> (b<span class="op">-</span>a)<span class="op">*</span>t<span class="op">;</span> }</span>
<span id="cb1-300"><a href="#cb1-300"></a></span>
<span id="cb1-301"><a href="#cb1-301"></a>  <span class="kw">function</span> <span class="fu">render</span>(tms){</span>
<span id="cb1-302"><a href="#cb1-302"></a>    <span class="co">// stage cycles: (0→1) for z0-&gt;z1, then z1-&gt;z2, then z2-&gt;z3</span></span>
<span id="cb1-303"><a href="#cb1-303"></a>    <span class="kw">const</span> cycle <span class="op">=</span> (tms<span class="op">/</span><span class="dv">1200</span>) <span class="op">%</span> <span class="dv">3</span><span class="op">;</span>             <span class="co">// 0..3</span></span>
<span id="cb1-304"><a href="#cb1-304"></a>    <span class="kw">const</span> k <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(cycle)<span class="op">;</span>              <span class="co">// 0,1,2</span></span>
<span id="cb1-305"><a href="#cb1-305"></a>    <span class="kw">const</span> t <span class="op">=</span> cycle <span class="op">-</span> k<span class="op">;</span>                      <span class="co">// 0..1</span></span>
<span id="cb1-306"><a href="#cb1-306"></a></span>
<span id="cb1-307"><a href="#cb1-307"></a>    <span class="cf">for</span> (<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>steps<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb1-308"><a href="#cb1-308"></a>      <span class="co">// Each panel shows its "target" step, but animates the transition for the current stage</span></span>
<span id="cb1-309"><a href="#cb1-309"></a>      <span class="kw">let</span> <span class="im">from</span> <span class="op">=</span> i<span class="op">,</span> to <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb1-310"><a href="#cb1-310"></a></span>
<span id="cb1-311"><a href="#cb1-311"></a>      <span class="cf">if</span> (k <span class="op">===</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> i <span class="op">===</span> <span class="dv">1</span>) { <span class="im">from</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> to <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> }   <span class="co">// animate z1</span></span>
<span id="cb1-312"><a href="#cb1-312"></a>      <span class="cf">if</span> (k <span class="op">===</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> i <span class="op">===</span> <span class="dv">2</span>) { <span class="im">from</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> to <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> }   <span class="co">// animate z2</span></span>
<span id="cb1-313"><a href="#cb1-313"></a>      <span class="cf">if</span> (k <span class="op">===</span> <span class="dv">2</span> <span class="op">&amp;&amp;</span> i <span class="op">===</span> <span class="dv">3</span>) { <span class="im">from</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> to <span class="op">=</span> <span class="dv">3</span><span class="op">;</span> }   <span class="co">// animate z3</span></span>
<span id="cb1-314"><a href="#cb1-314"></a></span>
<span id="cb1-315"><a href="#cb1-315"></a>      <span class="kw">const</span> A <span class="op">=</span> steps[<span class="im">from</span>]<span class="op">.</span><span class="at">pts</span><span class="op">;</span></span>
<span id="cb1-316"><a href="#cb1-316"></a>      <span class="kw">const</span> B <span class="op">=</span> steps[to]<span class="op">.</span><span class="at">pts</span><span class="op">;</span></span>
<span id="cb1-317"><a href="#cb1-317"></a></span>
<span id="cb1-318"><a href="#cb1-318"></a>      dotGroups[i]</span>
<span id="cb1-319"><a href="#cb1-319"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb1-320"><a href="#cb1-320"></a>          <span class="kw">const</span> a <span class="op">=</span> A[d<span class="op">.</span><span class="at">idx</span>]<span class="op">,</span> b <span class="op">=</span> B[d<span class="op">.</span><span class="at">idx</span>]<span class="op">;</span></span>
<span id="cb1-321"><a href="#cb1-321"></a>          <span class="cf">return</span> <span class="fu">xS</span>(<span class="fu">lerp</span>(a[<span class="dv">0</span>]<span class="op">,</span> b[<span class="dv">0</span>]<span class="op">,</span> t))<span class="op">;</span></span>
<span id="cb1-322"><a href="#cb1-322"></a>        })</span>
<span id="cb1-323"><a href="#cb1-323"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb1-324"><a href="#cb1-324"></a>          <span class="kw">const</span> a <span class="op">=</span> A[d<span class="op">.</span><span class="at">idx</span>]<span class="op">,</span> b <span class="op">=</span> B[d<span class="op">.</span><span class="at">idx</span>]<span class="op">;</span></span>
<span id="cb1-325"><a href="#cb1-325"></a>          <span class="cf">return</span> <span class="fu">yS</span>(<span class="fu">lerp</span>(a[<span class="dv">1</span>]<span class="op">,</span> b[<span class="dv">1</span>]<span class="op">,</span> t))<span class="op">;</span></span>
<span id="cb1-326"><a href="#cb1-326"></a>        })<span class="op">;</span></span>
<span id="cb1-327"><a href="#cb1-327"></a>    }</span>
<span id="cb1-328"><a href="#cb1-328"></a></span>
<span id="cb1-329"><a href="#cb1-329"></a>    <span class="fu">requestAnimationFrame</span>(render)<span class="op">;</span></span>
<span id="cb1-330"><a href="#cb1-330"></a>  }</span>
<span id="cb1-331"><a href="#cb1-331"></a></span>
<span id="cb1-332"><a href="#cb1-332"></a>  <span class="fu">requestAnimationFrame</span>(render)<span class="op">;</span></span>
<span id="cb1-333"><a href="#cb1-333"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-334"><a href="#cb1-334"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="NormFlows" class="slide level2">
<h2>Normalizing flows</h2>
<p><br></p>
<div class="mizzou-gold-box">
<p>A <strong>normalizing flow</strong> constructs a complex density by transforming a simple one through invertible mappings.</p>
<p>By repeatedly applying the rule for change of variables, the initial density ‘flows’ through the sequence of invertible mappings.</p>
</div>
<p><br></p>
<h3 id="construction">Construction</h3>
<p>Start with <span class="math display">
z_0 \sim q_0(z_0 \mid x),
</span> and apply a sequence of invertible transformations: <span class="math display">
z_k = f_k(z_{k-1}), \qquad k=1,\dots,K.
</span></p>
<p>The final variable <span class="math inline">z_K</span> has density <span class="math inline">q_K(z_K \mid x)</span>.</p>
</section>
<section id="change-of-variables" class="slide level2">
<h2>Change of variables</h2>
<p>By the change-of-variables formula: <span class="math display">
\log q_K(z_K \mid x)
=
\log q_0(z_0 \mid x)
-
\sum_{k=1}^K
\log\left|
\det
\frac{\partial f_k}{\partial z_{k-1}}
\right|.
</span></p>
<h3 id="interpretation">Interpretation</h3>
<ul>
<li>Each transformation <strong>warps</strong> the density</li>
<li>Stacking transformations yields rich posteriors</li>
<li>Complexity controlled by flow length <span class="math inline">K</span></li>
</ul>
<h3 id="why-normalizing-flows-help">Why normalizing flows help</h3>
<ul>
<li>Start from a simple, reparameterizable base distribution</li>
<li>Add flexibility through invertible transformations</li>
<li>Preserve tractable likelihoods and gradients</li>
</ul>
</section>
<section id="finite-normalizing-flows" class="slide level2">
<h2>Finite Normalizing flows</h2>
<p>Let <span class="math display">
f:\mathbb{R}^d \to \mathbb{R}^d
</span> be a smooth, invertible map with inverse <span class="math inline">f^{-1}</span>.</p>
<p>If <span class="math display">
z \sim q(z),
\qquad
z' = f(z),
</span> then <span class="math inline">z'</span> has density <span class="math display">
q(z') = q(z)\left|\det\frac{\partial f^{-1}}{\partial z'}\right|
      = q(z)\left|\det\frac{\partial f}{\partial z}\right|^{-1}.
</span></p>
</section>
<section id="finite-normalizing-flows-1" class="slide level2">
<h2>Finite normalizing flows</h2>
<p>Rather than a single transformation, we compose many:</p>
<p><span class="math display">
z_K = f_K \circ f_{K-1} \circ \cdots \circ f_1(z_0),
</span></p>
<p>where <span class="math display">
z_0 \sim q_0(z_0).
</span></p>
<p>The resulting density is <span class="math display">
\log q_K(z_K)
=
\log q_0(z_0)
-
\sum_{k=1}^K
\log\left|
\det\frac{\partial f_k}{\partial z_{k-1}}
\right|.
</span></p>
</section>
<section id="why-this-is-called-a-flow" class="slide level2">
<h2>Why this is called a <em>flow</em></h2>
<ul>
<li><p>The sequence <span class="math display">
z_0 \rightarrow z_1 \rightarrow \cdots \rightarrow z_K
</span> traces a <strong>path in latent space</strong></p></li>
<li><p>The corresponding sequence of densities <span class="math display">
q_0 \rightarrow q_1 \rightarrow \cdots \rightarrow q_K
</span> forms a <strong>normalizing flow</strong></p></li>
</ul>
<p><br></p>
<p>With increasing <span class="math inline">K</span>, the density can become: - non-Gaussian - correlated - multi-modal</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="474" data-source-offset="0"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 473;"><span id="cb2-474"><a href="#cb2-474"></a>flow_path_anim <span class="op">=</span> {</span>
<span id="cb2-475"><a href="#cb2-475"></a>  <span class="kw">const</span> W <span class="op">=</span> <span class="dv">920</span><span class="op">,</span> H <span class="op">=</span> <span class="dv">230</span><span class="op">,</span> pad <span class="op">=</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb2-476"><a href="#cb2-476"></a>  <span class="kw">const</span> K <span class="op">=</span> <span class="dv">5</span><span class="op">;</span>                 <span class="co">// show z0..z5</span></span>
<span id="cb2-477"><a href="#cb2-477"></a>  <span class="kw">const</span> panelW <span class="op">=</span> (W <span class="op">-</span> <span class="dv">2</span><span class="op">*</span>pad) <span class="op">/</span> (K<span class="op">+</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb2-478"><a href="#cb2-478"></a></span>
<span id="cb2-479"><a href="#cb2-479"></a>  <span class="co">// sample base points (standard normal)</span></span>
<span id="cb2-480"><a href="#cb2-480"></a>  <span class="kw">const</span> n <span class="op">=</span> <span class="dv">260</span><span class="op">;</span></span>
<span id="cb2-481"><a href="#cb2-481"></a>  <span class="kw">const</span> pts0 <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(n)<span class="op">.</span><span class="fu">map</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb2-482"><a href="#cb2-482"></a>    <span class="kw">const</span> u1 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">,</span> u2 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>()<span class="op">;</span></span>
<span id="cb2-483"><a href="#cb2-483"></a>    <span class="kw">const</span> r <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="op">-</span><span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">log</span>(u1))<span class="op">;</span></span>
<span id="cb2-484"><a href="#cb2-484"></a>    <span class="kw">const</span> a <span class="op">=</span> <span class="dv">2</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">*</span>u2<span class="op">;</span></span>
<span id="cb2-485"><a href="#cb2-485"></a>    <span class="cf">return</span> [r<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(a)<span class="op">,</span> r<span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(a)]<span class="op">;</span></span>
<span id="cb2-486"><a href="#cb2-486"></a>  })<span class="op">;</span></span>
<span id="cb2-487"><a href="#cb2-487"></a></span>
<span id="cb2-488"><a href="#cb2-488"></a>  <span class="co">// simple "flow-like" warps (deterministic, invertible-looking)</span></span>
<span id="cb2-489"><a href="#cb2-489"></a>  <span class="kw">const</span> f1 <span class="op">=</span> ([x<span class="op">,</span>y]) <span class="kw">=&gt;</span> [x <span class="op">+</span> <span class="fl">0.95</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">tanh</span>(<span class="fl">1.1</span><span class="op">*</span>y)<span class="op">,</span> y]<span class="op">;</span>                     <span class="co">// shear</span></span>
<span id="cb2-490"><a href="#cb2-490"></a>  <span class="kw">const</span> f2 <span class="op">=</span> ([x<span class="op">,</span>y]) <span class="kw">=&gt;</span> {</span>
<span id="cb2-491"><a href="#cb2-491"></a>    <span class="kw">const</span> th <span class="op">=</span> <span class="fl">0.55</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">tanh</span>(<span class="fl">0.8</span><span class="op">*</span>x)<span class="op">;</span>                                      <span class="co">// local rotation</span></span>
<span id="cb2-492"><a href="#cb2-492"></a>    <span class="kw">const</span> c <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(th)<span class="op">,</span> s <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(th)<span class="op">;</span></span>
<span id="cb2-493"><a href="#cb2-493"></a>    <span class="cf">return</span> [c<span class="op">*</span>x <span class="op">-</span> s<span class="op">*</span>y<span class="op">,</span> s<span class="op">*</span>x <span class="op">+</span> c<span class="op">*</span>y]<span class="op">;</span></span>
<span id="cb2-494"><a href="#cb2-494"></a>  }<span class="op">;</span></span>
<span id="cb2-495"><a href="#cb2-495"></a>  <span class="kw">const</span> f3 <span class="op">=</span> ([x<span class="op">,</span>y]) <span class="kw">=&gt;</span> {</span>
<span id="cb2-496"><a href="#cb2-496"></a>    <span class="kw">const</span> r <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(x<span class="op">*</span>x <span class="op">+</span> y<span class="op">*</span>y) <span class="op">+</span> <span class="fl">1e-6</span><span class="op">;</span></span>
<span id="cb2-497"><a href="#cb2-497"></a>    <span class="kw">const</span> k <span class="op">=</span> <span class="fl">0.75</span><span class="op">*</span><span class="bu">Math</span><span class="op">.</span><span class="fu">tanh</span>(<span class="fl">0.9</span><span class="op">*</span>(r<span class="op">-</span><span class="fl">1.1</span>))<span class="op">;</span>                                 <span class="co">// radial twist</span></span>
<span id="cb2-498"><a href="#cb2-498"></a>    <span class="cf">return</span> [x <span class="op">+</span> k<span class="op">*</span>(<span class="op">-</span>y)<span class="op">,</span> y <span class="op">+</span> k<span class="op">*</span>(x)]<span class="op">;</span></span>
<span id="cb2-499"><a href="#cb2-499"></a>  }<span class="op">;</span></span>
<span id="cb2-500"><a href="#cb2-500"></a></span>
<span id="cb2-501"><a href="#cb2-501"></a>  <span class="kw">const</span> Fs <span class="op">=</span> [p <span class="kw">=&gt;</span> p<span class="op">,</span> f1<span class="op">,</span> p <span class="kw">=&gt;</span> <span class="fu">f2</span>(<span class="fu">f1</span>(p))<span class="op">,</span> p <span class="kw">=&gt;</span> <span class="fu">f3</span>(<span class="fu">f2</span>(<span class="fu">f1</span>(p)))<span class="op">,</span> p <span class="kw">=&gt;</span> <span class="fu">f1</span>(<span class="fu">f3</span>(<span class="fu">f2</span>(<span class="fu">f1</span>(p))))<span class="op">,</span> p <span class="kw">=&gt;</span> <span class="fu">f2</span>(<span class="fu">f1</span>(<span class="fu">f3</span>(<span class="fu">f2</span>(<span class="fu">f1</span>(p)))))]<span class="op">;</span></span>
<span id="cb2-502"><a href="#cb2-502"></a></span>
<span id="cb2-503"><a href="#cb2-503"></a>  <span class="co">// precompute pts at each k (z_k)</span></span>
<span id="cb2-504"><a href="#cb2-504"></a>  <span class="kw">const</span> steps <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(K<span class="op">+</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">map</span>(k <span class="kw">=&gt;</span> pts0<span class="op">.</span><span class="fu">map</span>(Fs[k]))<span class="op">;</span></span>
<span id="cb2-505"><a href="#cb2-505"></a></span>
<span id="cb2-506"><a href="#cb2-506"></a>  <span class="kw">const</span> xS <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">4</span><span class="op">,</span><span class="dv">4</span>])<span class="op">.</span><span class="fu">range</span>([pad<span class="op">,</span> panelW <span class="op">-</span> pad])<span class="op">;</span></span>
<span id="cb2-507"><a href="#cb2-507"></a>  <span class="kw">const</span> yS <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">4</span><span class="op">,</span><span class="dv">4</span>])<span class="op">.</span><span class="fu">range</span>([H <span class="op">-</span> pad<span class="op">,</span> pad])<span class="op">;</span></span>
<span id="cb2-508"><a href="#cb2-508"></a></span>
<span id="cb2-509"><a href="#cb2-509"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb2-510"><a href="#cb2-510"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="vs">`0 0 </span><span class="sc">${</span>W<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>H<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb2-511"><a href="#cb2-511"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span><span class="st">"100%"</span>)</span>
<span id="cb2-512"><a href="#cb2-512"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span><span class="st">"920px"</span>)</span>
<span id="cb2-513"><a href="#cb2-513"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span><span class="st">"230px"</span>)</span>
<span id="cb2-514"><a href="#cb2-514"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border"</span><span class="op">,</span><span class="st">"1px solid rgba(255,255,255,0.18)"</span>)</span>
<span id="cb2-515"><a href="#cb2-515"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border-radius"</span><span class="op">,</span><span class="st">"12px"</span>)<span class="op">;</span></span>
<span id="cb2-516"><a href="#cb2-516"></a></span>
<span id="cb2-517"><a href="#cb2-517"></a>  <span class="co">// panel frames + labels</span></span>
<span id="cb2-518"><a href="#cb2-518"></a>  <span class="cf">for</span> (<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;=</span>K<span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb2-519"><a href="#cb2-519"></a>    <span class="kw">const</span> x0 <span class="op">=</span> pad <span class="op">+</span> i<span class="op">*</span>panelW<span class="op">;</span></span>
<span id="cb2-520"><a href="#cb2-520"></a></span>
<span id="cb2-521"><a href="#cb2-521"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb2-522"><a href="#cb2-522"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> x0 <span class="op">+</span> <span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb2-523"><a href="#cb2-523"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> panelW <span class="op">-</span> <span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> H <span class="op">-</span> <span class="dv">16</span>)</span>
<span id="cb2-524"><a href="#cb2-524"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb2-525"><a href="#cb2-525"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"transparent"</span>)</span>
<span id="cb2-526"><a href="#cb2-526"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(255,255,255,0.12)"</span>)<span class="op">;</span></span>
<span id="cb2-527"><a href="#cb2-527"></a></span>
<span id="cb2-528"><a href="#cb2-528"></a>    svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-529"><a href="#cb2-529"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> x0 <span class="op">+</span> <span class="dv">12</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">26</span>)</span>
<span id="cb2-530"><a href="#cb2-530"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="fl">13.5</span>)</span>
<span id="cb2-531"><a href="#cb2-531"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">750</span>)</span>
<span id="cb2-532"><a href="#cb2-532"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.92</span>)</span>
<span id="cb2-533"><a href="#cb2-533"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="vs">`z_</span><span class="sc">${</span>i<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb2-534"><a href="#cb2-534"></a></span>
<span id="cb2-535"><a href="#cb2-535"></a>    <span class="cf">if</span> (i <span class="op">&lt;</span> K){</span>
<span id="cb2-536"><a href="#cb2-536"></a>      svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb2-537"><a href="#cb2-537"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> x0 <span class="op">+</span> panelW <span class="op">-</span> <span class="dv">6</span>)</span>
<span id="cb2-538"><a href="#cb2-538"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> H<span class="op">/</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">6</span>)</span>
<span id="cb2-539"><a href="#cb2-539"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">22</span>)</span>
<span id="cb2-540"><a href="#cb2-540"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.55</span>)</span>
<span id="cb2-541"><a href="#cb2-541"></a>        <span class="op">.</span><span class="fu">text</span>(<span class="st">"→"</span>)<span class="op">;</span></span>
<span id="cb2-542"><a href="#cb2-542"></a>    }</span>
<span id="cb2-543"><a href="#cb2-543"></a>  }</span>
<span id="cb2-544"><a href="#cb2-544"></a></span>
<span id="cb2-545"><a href="#cb2-545"></a>  <span class="co">// dots per panel (same indices, so we can interpolate)</span></span>
<span id="cb2-546"><a href="#cb2-546"></a>  <span class="kw">const</span> dotGroups <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(K<span class="op">+</span><span class="dv">1</span>)<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> {</span>
<span id="cb2-547"><a href="#cb2-547"></a>    <span class="kw">const</span> gx <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>pad <span class="op">+</span> i<span class="op">*</span>panelW<span class="sc">}</span><span class="vs">,0)`</span>)<span class="op">;</span></span>
<span id="cb2-548"><a href="#cb2-548"></a>    <span class="cf">return</span> gx<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb2-549"><a href="#cb2-549"></a>      <span class="op">.</span><span class="fu">data</span>(pts0<span class="op">.</span><span class="fu">map</span>((p<span class="op">,</span> idx) <span class="kw">=&gt;</span> ({idx})))</span>
<span id="cb2-550"><a href="#cb2-550"></a>      <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb2-551"><a href="#cb2-551"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="fl">1.55</span>)</span>
<span id="cb2-552"><a href="#cb2-552"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.78</span>)<span class="op">;</span></span>
<span id="cb2-553"><a href="#cb2-553"></a>  })<span class="op">;</span></span>
<span id="cb2-554"><a href="#cb2-554"></a></span>
<span id="cb2-555"><a href="#cb2-555"></a>  <span class="kw">const</span> lerp <span class="op">=</span> (a<span class="op">,</span>b<span class="op">,</span>t) <span class="kw">=&gt;</span> a <span class="op">+</span> (b<span class="op">-</span>a)<span class="op">*</span>t<span class="op">;</span></span>
<span id="cb2-556"><a href="#cb2-556"></a></span>
<span id="cb2-557"><a href="#cb2-557"></a>  <span class="kw">function</span> <span class="fu">render</span>(tms){</span>
<span id="cb2-558"><a href="#cb2-558"></a>    <span class="co">// stage cycles through transitions: z0-&gt;z1-&gt;...-&gt;zK</span></span>
<span id="cb2-559"><a href="#cb2-559"></a>    <span class="kw">const</span> speed <span class="op">=</span> <span class="dv">1100</span><span class="op">;</span></span>
<span id="cb2-560"><a href="#cb2-560"></a>    <span class="kw">const</span> cycle <span class="op">=</span> (tms <span class="op">/</span> speed) <span class="op">%</span> K<span class="op">;</span>        <span class="co">// 0..K</span></span>
<span id="cb2-561"><a href="#cb2-561"></a>    <span class="kw">const</span> k <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(cycle)<span class="op">;</span>            <span class="co">// transition k -&gt; k+1</span></span>
<span id="cb2-562"><a href="#cb2-562"></a>    <span class="kw">const</span> t <span class="op">=</span> cycle <span class="op">-</span> k<span class="op">;</span>                    <span class="co">// 0..1</span></span>
<span id="cb2-563"><a href="#cb2-563"></a></span>
<span id="cb2-564"><a href="#cb2-564"></a>    <span class="cf">for</span> (<span class="kw">let</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;=</span>K<span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb2-565"><a href="#cb2-565"></a>      <span class="co">// each panel shows its final step, but panel i animates when it is the "current" step</span></span>
<span id="cb2-566"><a href="#cb2-566"></a>      <span class="kw">let</span> <span class="im">from</span> <span class="op">=</span> i<span class="op">,</span> to <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb2-567"><a href="#cb2-567"></a>      <span class="cf">if</span> (i <span class="op">===</span> k<span class="op">+</span><span class="dv">1</span>) { <span class="im">from</span> <span class="op">=</span> k<span class="op">;</span> to <span class="op">=</span> k<span class="op">+</span><span class="dv">1</span><span class="op">;</span> }   <span class="co">// animate the next panel filling in</span></span>
<span id="cb2-568"><a href="#cb2-568"></a></span>
<span id="cb2-569"><a href="#cb2-569"></a>      <span class="kw">const</span> A <span class="op">=</span> steps[<span class="im">from</span>]<span class="op">;</span></span>
<span id="cb2-570"><a href="#cb2-570"></a>      <span class="kw">const</span> B <span class="op">=</span> steps[to]<span class="op">;</span></span>
<span id="cb2-571"><a href="#cb2-571"></a></span>
<span id="cb2-572"><a href="#cb2-572"></a>      dotGroups[i]</span>
<span id="cb2-573"><a href="#cb2-573"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb2-574"><a href="#cb2-574"></a>          <span class="kw">const</span> a <span class="op">=</span> A[d<span class="op">.</span><span class="at">idx</span>]<span class="op">,</span> b <span class="op">=</span> B[d<span class="op">.</span><span class="at">idx</span>]<span class="op">;</span></span>
<span id="cb2-575"><a href="#cb2-575"></a>          <span class="cf">return</span> <span class="fu">xS</span>(<span class="fu">lerp</span>(a[<span class="dv">0</span>]<span class="op">,</span> b[<span class="dv">0</span>]<span class="op">,</span> t))<span class="op">;</span></span>
<span id="cb2-576"><a href="#cb2-576"></a>        })</span>
<span id="cb2-577"><a href="#cb2-577"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb2-578"><a href="#cb2-578"></a>          <span class="kw">const</span> a <span class="op">=</span> A[d<span class="op">.</span><span class="at">idx</span>]<span class="op">,</span> b <span class="op">=</span> B[d<span class="op">.</span><span class="at">idx</span>]<span class="op">;</span></span>
<span id="cb2-579"><a href="#cb2-579"></a>          <span class="cf">return</span> <span class="fu">yS</span>(<span class="fu">lerp</span>(a[<span class="dv">1</span>]<span class="op">,</span> b[<span class="dv">1</span>]<span class="op">,</span> t))<span class="op">;</span></span>
<span id="cb2-580"><a href="#cb2-580"></a>        })<span class="op">;</span></span>
<span id="cb2-581"><a href="#cb2-581"></a>    }</span>
<span id="cb2-582"><a href="#cb2-582"></a></span>
<span id="cb2-583"><a href="#cb2-583"></a>    <span class="fu">requestAnimationFrame</span>(render)<span class="op">;</span></span>
<span id="cb2-584"><a href="#cb2-584"></a>  }</span>
<span id="cb2-585"><a href="#cb2-585"></a></span>
<span id="cb2-586"><a href="#cb2-586"></a>  <span class="fu">requestAnimationFrame</span>(render)<span class="op">;</span></span>
<span id="cb2-587"><a href="#cb2-587"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb2-588"><a href="#cb2-588"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="expectations-under-a-flow-lotus" class="slide level2">
<h2>Expectations under a flow (LOTUS)</h2>
<p>A key property:</p>
<p>For any function <span class="math inline">h(z)</span>, <span class="math display">
\mathbb{E}_{q_K}[h(z)]
=
\mathbb{E}_{q_0}\!\left[
h\big(f_K \circ \cdots \circ f_1(z_0)\big)
\right].
</span></p>
<p><br></p>
<h3 id="consequence">Consequence</h3>
<ul>
<li>We can compute expectations <strong>without explicitly evaluating</strong> <span class="math inline">q_K</span></li>
<li>Jacobian terms only matter when evaluating <span class="math inline">\log q_K</span></li>
</ul>
</section>
<section id="geometric-intuition" class="slide level2">
<h2>Geometric intuition</h2>
<p>Effect of invertible flows can be thought of as a sequence of expansions or contractions on the initial density</p>
<ul>
<li><p><strong>Expansions</strong><br>
→ The map <span class="math inline">z'=f(z)</span> pulls the pointz <span class="math inline">z</span> away from a region in <span class="math inline">\mathbb{R}^d</span>, reducing density in that region.</p></li>
<li><p><strong>Contractions</strong><br>
→ concentrate mass, increase density locally</p></li>
</ul>
<p>By composing expansions and contractions, a simple base density can be warped into a highly complex one.</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="633" data-source-offset="-0"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 632;"><span id="cb3-633"><a href="#cb3-633"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span>)</span>
<span id="cb3-634"><a href="#cb3-634"></a></span>
<span id="cb3-635"><a href="#cb3-635"></a>flow_viz <span class="op">=</span> {</span>
<span id="cb3-636"><a href="#cb3-636"></a>  <span class="co">// ↓↓↓ reduced size ↓↓↓</span></span>
<span id="cb3-637"><a href="#cb3-637"></a>  <span class="kw">const</span> W <span class="op">=</span> <span class="dv">520</span><span class="op">,</span> H <span class="op">=</span> <span class="dv">260</span><span class="op">,</span> pad <span class="op">=</span> <span class="dv">18</span><span class="op">;</span></span>
<span id="cb3-638"><a href="#cb3-638"></a></span>
<span id="cb3-639"><a href="#cb3-639"></a>  <span class="kw">const</span> xs <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">2</span><span class="op">,</span><span class="dv">2</span>])<span class="op">.</span><span class="fu">range</span>([pad<span class="op">,</span> W<span class="op">-</span>pad])<span class="op">;</span></span>
<span id="cb3-640"><a href="#cb3-640"></a>  <span class="kw">const</span> ys <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()<span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="fl">1.4</span><span class="op">,</span><span class="fl">1.4</span>])<span class="op">.</span><span class="fu">range</span>([H<span class="op">-</span>pad<span class="op">,</span> pad])<span class="op">;</span></span>
<span id="cb3-641"><a href="#cb3-641"></a></span>
<span id="cb3-642"><a href="#cb3-642"></a>  <span class="co">// ↓↓↓ slightly sparser grid ↓↓↓</span></span>
<span id="cb3-643"><a href="#cb3-643"></a>  <span class="kw">const</span> pts <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-644"><a href="#cb3-644"></a>  <span class="cf">for</span> (<span class="kw">let</span> x<span class="op">=-</span><span class="dv">2</span><span class="op">;</span> x<span class="op">&lt;=</span><span class="fl">2.001</span><span class="op">;</span> x<span class="op">+=</span><span class="fl">0.22</span>)</span>
<span id="cb3-645"><a href="#cb3-645"></a>    <span class="cf">for</span> (<span class="kw">let</span> y<span class="op">=-</span><span class="fl">1.4</span><span class="op">;</span> y<span class="op">&lt;=</span><span class="fl">1.4001</span><span class="op">;</span> y<span class="op">+=</span><span class="fl">0.22</span>)</span>
<span id="cb3-646"><a href="#cb3-646"></a>      pts<span class="op">.</span><span class="fu">push</span>([x<span class="op">,</span>y])<span class="op">;</span></span>
<span id="cb3-647"><a href="#cb3-647"></a></span>
<span id="cb3-648"><a href="#cb3-648"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb3-649"><a href="#cb3-649"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="vs">`0 0 </span><span class="sc">${</span>W<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>H<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb3-650"><a href="#cb3-650"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span><span class="st">"100%"</span>)</span>
<span id="cb3-651"><a href="#cb3-651"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span><span class="st">"520px"</span>)</span>
<span id="cb3-652"><a href="#cb3-652"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span><span class="st">"260px"</span>)</span>
<span id="cb3-653"><a href="#cb3-653"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border"</span><span class="op">,</span><span class="st">"1px solid rgba(255,255,255,0.18)"</span>)</span>
<span id="cb3-654"><a href="#cb3-654"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"border-radius"</span><span class="op">,</span><span class="st">"10px"</span>)<span class="op">;</span></span>
<span id="cb3-655"><a href="#cb3-655"></a></span>
<span id="cb3-656"><a href="#cb3-656"></a>  <span class="kw">const</span> label <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-657"><a href="#cb3-657"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">18</span>)</span>
<span id="cb3-658"><a href="#cb3-658"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">14</span>)</span>
<span id="cb3-659"><a href="#cb3-659"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">600</span>)<span class="op">;</span></span>
<span id="cb3-660"><a href="#cb3-660"></a></span>
<span id="cb3-661"><a href="#cb3-661"></a>  <span class="kw">const</span> dots <span class="op">=</span> svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"circle"</span>)</span>
<span id="cb3-662"><a href="#cb3-662"></a>    <span class="op">.</span><span class="fu">data</span>(pts)</span>
<span id="cb3-663"><a href="#cb3-663"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"circle"</span>)</span>
<span id="cb3-664"><a href="#cb3-664"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="fl">1.6</span>)</span>
<span id="cb3-665"><a href="#cb3-665"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.75</span>)<span class="op">;</span></span>
<span id="cb3-666"><a href="#cb3-666"></a></span>
<span id="cb3-667"><a href="#cb3-667"></a>  <span class="kw">function</span> <span class="fu">frame</span>(tms){</span>
<span id="cb3-668"><a href="#cb3-668"></a>    <span class="kw">const</span> t <span class="op">=</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(tms<span class="op">/</span><span class="dv">900</span>) <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-669"><a href="#cb3-669"></a>    <span class="kw">const</span> strength <span class="op">=</span> (<span class="dv">2</span><span class="op">*</span>t <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.55</span><span class="op">;</span></span>
<span id="cb3-670"><a href="#cb3-670"></a></span>
<span id="cb3-671"><a href="#cb3-671"></a>    label<span class="op">.</span><span class="fu">text</span>(strength <span class="op">&gt;=</span> <span class="dv">0</span></span>
<span id="cb3-672"><a href="#cb3-672"></a>      <span class="op">?</span> <span class="st">"Expansion"</span></span>
<span id="cb3-673"><a href="#cb3-673"></a>      <span class="op">:</span> <span class="st">"Contraction"</span></span>
<span id="cb3-674"><a href="#cb3-674"></a>    )<span class="op">;</span></span>
<span id="cb3-675"><a href="#cb3-675"></a></span>
<span id="cb3-676"><a href="#cb3-676"></a>    <span class="kw">const</span> warped <span class="op">=</span> pts<span class="op">.</span><span class="fu">map</span>(([x0<span class="op">,</span>y0]) <span class="kw">=&gt;</span> {</span>
<span id="cb3-677"><a href="#cb3-677"></a>      <span class="kw">const</span> r2 <span class="op">=</span> x0<span class="op">*</span>x0 <span class="op">+</span> y0<span class="op">*</span>y0 <span class="op">+</span> <span class="fl">0.15</span><span class="op">;</span></span>
<span id="cb3-678"><a href="#cb3-678"></a>      <span class="kw">const</span> s <span class="op">=</span> strength <span class="op">/</span> r2<span class="op">;</span></span>
<span id="cb3-679"><a href="#cb3-679"></a>      <span class="cf">return</span> [x0 <span class="op">+</span> s<span class="op">*</span>x0<span class="op">,</span> y0 <span class="op">+</span> s<span class="op">*</span>y0]<span class="op">;</span></span>
<span id="cb3-680"><a href="#cb3-680"></a>    })<span class="op">;</span></span>
<span id="cb3-681"><a href="#cb3-681"></a></span>
<span id="cb3-682"><a href="#cb3-682"></a>    dots</span>
<span id="cb3-683"><a href="#cb3-683"></a>      <span class="op">.</span><span class="fu">data</span>(warped)</span>
<span id="cb3-684"><a href="#cb3-684"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">xs</span>(d[<span class="dv">0</span>]))</span>
<span id="cb3-685"><a href="#cb3-685"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">ys</span>(d[<span class="dv">1</span>]))<span class="op">;</span></span>
<span id="cb3-686"><a href="#cb3-686"></a></span>
<span id="cb3-687"><a href="#cb3-687"></a>    <span class="fu">requestAnimationFrame</span>(frame)<span class="op">;</span></span>
<span id="cb3-688"><a href="#cb3-688"></a>  }</span>
<span id="cb3-689"><a href="#cb3-689"></a></span>
<span id="cb3-690"><a href="#cb3-690"></a>  <span class="fu">requestAnimationFrame</span>(frame)<span class="op">;</span></span>
<span id="cb3-691"><a href="#cb3-691"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb3-692"><a href="#cb3-692"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="infinitestimal-flows" class="slide level2">
<h2>Infinitestimal Flows</h2>
<p>We define the variational posterior as <span class="math display">
q_\phi(z \mid x) := q_K(z_K),
</span></p>
<p>where the transformations <span class="math inline">f_k</span> are parameterized by <span class="math inline">\phi</span></p>
<h3 id="key-idea">Key idea</h3>
<p>Complexity is controlled by <strong>flow length</strong> <span class="math inline">K</span>,</p>
<p>What happens as the flow length <span class="math inline">K \to \infty</span>?</p>
<p>Instead of discrete transformations, the density evolves continuously in time: <span class="math display">
\frac{\partial}{\partial t} q_t(z) = \mathcal{T}_t[q_t(z)],
</span></p>
<p>where <span class="math inline">\mathcal{T}_t</span> defines continuous-time dynamics.</p>
</section>
<section class="slide level2">

<div class="columns">
<div class="column">
<h3 id="langevin-flow">Langevin flow</h3>
<p>One important infinitesimal flow is the Langevin SDE: <span class="math display">
dz(t) = F(z(t),t)\,dt + G(z(t),t)\,d\xi(t),
</span></p>
<p>where <span class="math inline">d\xi(t)</span> is a Wiener process, <span class="math inline">F</span> is a drift vector, <span class="math inline">D=GG'</span> is a diffusion matrix.</p>
<p><br> In machine learning, commonly: <span class="math display">
F(z,t) = -\nabla_z \mathcal{L}(z),
\qquad
G(z,t) = \sqrt{2}\,I.
</span> where <span class="math inline">\mathcal{L}(z)</span> is a unnormalised log-density of the model.</p>
</div><div class="column">
<h3 id="hamiltonian-flows">Hamiltonian flows</h3>
<p>Hamiltonian Monte Carlo can also be viewed as a normalizing flow on an augmented space <span class="math inline">(z,\omega)</span>.</p>
<p><br></p>
<p>Its dynamics results from Hamiltonian <span class="math display">\mathcal{H}(z,w)=-\mathcal{L}(z)-\frac{1}{2}\omega'M\omega</span></p>
<p><br></p>
<p>Also widely used in machine learning.</p>
</div>
</div>
</section>
<section id="InfNormFlow" class="slide level2">
<h2>Inference with normalizing flows</h2>
<h3 id="invertible-linear-time-transformations">Invertible linear-time transformations</h3>
<p><br></p>
<p>To construct expressive variational posteriors, we need transformations that are:</p>
<ul>
<li><strong>Invertible</strong> (to define a valid density)</li>
<li><strong>Differentiable</strong> (for gradients)</li>
<li><strong>Computationally efficient</strong> (Jacobian determinant is cheap)</li>
</ul>
<p><br></p>
<p><br></p>
<div class="mizzou-gold-box">
<p>The key idea is to design flows whose Jacobian determinants can be computed in <strong>linear time</strong> <span class="math inline">O(d)</span>.</p>
</div>
</section>
<section id="invertible-linear-time-transformations-1" class="slide level2">
<h2>Invertible Linear-time Transformations</h2>
<p>Consider transformations of the form: <span class="math display">
f(z) = z + u\, h(w^\top z + b),
</span></p>
<p>where <span class="math inline">u, w \in \mathbb{R}^d</span>, <span class="math inline">b \in \mathbb{R}</span> <span class="math inline">\&amp;</span> <span class="math inline">h(\cdot)</span> is a smooth scalar nonlinearity</p>
<h3 id="jacobian-determinant-planar-flow">Jacobian determinant (planar flow)</h3>
<p>Define <span class="math display">
\psi(z) = h'(w^\top z + b)\, w.
</span></p>
<p>Then the Jacobian determinant simplifies to: <span class="math display">
\left| \det \frac{\partial f}{\partial z} \right|
=
\left| 1 + u^\top \psi(z) \right|.
</span></p>
<h3 id="consequences-1">Consequences</h3>
<p>Determinant computed in <strong>(O(d)) time</strong></p>
<p>Density is tractable: <span class="math inline">\log q_K(z_K) = \log q_0(z_0) - \sum_{k=1}^K \log | 1 + u_k^\top \psi_k(z_k) |</span></p>
</section>
<section id="flow-based-free-energy-bound" class="slide level2">
<h2>Flow-based free energy bound</h2>
<p>We parameterize the approximate posterior using a flow of length (K): <span class="math display">
q_\phi(z \mid x) := q_K(z_K),
\qquad
z_K = f_K \circ \cdots \circ f_1(z_0),
\quad
z_0 \sim q_0(z_0).
</span></p>
<p><br></p>
<h3 id="free-energy-elbo">Free energy (ELBO)</h3>
<p>The variational free energy can be written as an expectation over the <strong>base distribution</strong> <span class="math inline">q_0</span>: <span class="math display">
\mathcal{F}(x)
=
\mathbb{E}_{q_0(z_0)}\!\left[
\log q_0(z_0)
-
\log p(x, z_K)
-
\sum_{k=1}^K
\log \left| 1 + u_k^\top \psi_k(z_k) \right|
\right].
</span></p>
<p><br></p>
<h3 id="interpretation-1">Interpretation</h3>
<ul>
<li>Optimization is performed <strong>in the base space</strong> <span class="math inline">z_0</span></li>
<li>Normalizing flows and this free energy bound can be used with any variational optimization scheme, including generalized variational EM.</li>
</ul>
</section>
<section id="AlgoNormFlows" class="slide level2">
<h2>Algorithm summary (normalizing flows)</h2>
<p>Normalizing flows extend <strong>amortized variational inference</strong> by augmenting the variational posterior with a sequence of invertible transformations.</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="878" data-source-offset="0"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 877;"><span id="cb4-878"><a href="#cb4-878"></a>algo_diagram <span class="op">=</span> {</span>
<span id="cb4-879"><a href="#cb4-879"></a>  <span class="kw">const</span> W <span class="op">=</span> <span class="dv">980</span><span class="op">,</span> H <span class="op">=</span> <span class="dv">260</span><span class="op">;</span></span>
<span id="cb4-880"><a href="#cb4-880"></a></span>
<span id="cb4-881"><a href="#cb4-881"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb4-882"><a href="#cb4-882"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="vs">`0 0 </span><span class="sc">${</span>W<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>H<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb4-883"><a href="#cb4-883"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span><span class="st">"100%"</span>)</span>
<span id="cb4-884"><a href="#cb4-884"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span><span class="st">"980px"</span>)</span>
<span id="cb4-885"><a href="#cb4-885"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span><span class="st">"260px"</span>)<span class="op">;</span></span>
<span id="cb4-886"><a href="#cb4-886"></a></span>
<span id="cb4-887"><a href="#cb4-887"></a>  <span class="co">// ---- layout ----</span></span>
<span id="cb4-888"><a href="#cb4-888"></a>  <span class="kw">const</span> nodes <span class="op">=</span> [</span>
<span id="cb4-889"><a href="#cb4-889"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"mb"</span><span class="op">,</span>  <span class="dt">x</span><span class="op">:</span><span class="dv">60</span><span class="op">,</span>  <span class="dt">y</span><span class="op">:</span><span class="dv">60</span><span class="op">,</span>  <span class="dt">w</span><span class="op">:</span><span class="dv">170</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">54</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Mini-batch"</span><span class="op">,</span>   <span class="dt">sub</span><span class="op">:</span><span class="st">"x ← {get mini-batch}"</span>}<span class="op">,</span></span>
<span id="cb4-890"><a href="#cb4-890"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"q0"</span><span class="op">,</span>  <span class="dt">x</span><span class="op">:</span><span class="dv">270</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span><span class="dv">60</span><span class="op">,</span>  <span class="dt">w</span><span class="op">:</span><span class="dv">200</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">54</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Base sample"</span><span class="op">,</span>  <span class="dt">sub</span><span class="op">:</span><span class="st">"z₀ ~ q₀(z₀ | x)"</span>}<span class="op">,</span></span>
<span id="cb4-891"><a href="#cb4-891"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"flow"</span><span class="op">,</span><span class="dt">x</span><span class="op">:</span><span class="dv">520</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span><span class="dv">60</span><span class="op">,</span>  <span class="dt">w</span><span class="op">:</span><span class="dv">240</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">54</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Flow map"</span><span class="op">,</span>     <span class="dt">sub</span><span class="op">:</span><span class="st">"z_K = f_K∘…∘f₁(z₀)"</span>}<span class="op">,</span></span>
<span id="cb4-892"><a href="#cb4-892"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"F"</span><span class="op">,</span>   <span class="dt">x</span><span class="op">:</span><span class="dv">810</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span><span class="dv">60</span><span class="op">,</span>  <span class="dt">w</span><span class="op">:</span><span class="dv">150</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">54</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Free energy"</span><span class="op">,</span>  <span class="dt">sub</span><span class="op">:</span><span class="st">"𝓕(x) ≈ 𝓕(x,z_K)"</span>}<span class="op">,</span></span>
<span id="cb4-893"><a href="#cb4-893"></a></span>
<span id="cb4-894"><a href="#cb4-894"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"gth"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span><span class="dv">620</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span><span class="dv">170</span><span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">210</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">54</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Update θ"</span><span class="op">,</span>     <span class="dt">sub</span><span class="op">:</span><span class="st">"Δθ ∝ −∇_θ 𝓕(x)"</span>}<span class="op">,</span></span>
<span id="cb4-895"><a href="#cb4-895"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"gph"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span><span class="dv">360</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span><span class="dv">170</span><span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">210</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">54</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Update ϕ"</span><span class="op">,</span>     <span class="dt">sub</span><span class="op">:</span><span class="st">"Δϕ ∝ −∇_ϕ 𝓕(x)"</span>}</span>
<span id="cb4-896"><a href="#cb4-896"></a>  ]<span class="op">;</span></span>
<span id="cb4-897"><a href="#cb4-897"></a></span>
<span id="cb4-898"><a href="#cb4-898"></a>  <span class="kw">const</span> edges <span class="op">=</span> [</span>
<span id="cb4-899"><a href="#cb4-899"></a>    [<span class="st">"mb"</span><span class="op">,</span><span class="st">"q0"</span>]<span class="op">,</span> [<span class="st">"q0"</span><span class="op">,</span><span class="st">"flow"</span>]<span class="op">,</span> [<span class="st">"flow"</span><span class="op">,</span><span class="st">"F"</span>]<span class="op">,</span></span>
<span id="cb4-900"><a href="#cb4-900"></a>    [<span class="st">"F"</span><span class="op">,</span><span class="st">"gth"</span>]<span class="op">,</span> [<span class="st">"F"</span><span class="op">,</span><span class="st">"gph"</span>]</span>
<span id="cb4-901"><a href="#cb4-901"></a>  ]<span class="op">;</span></span>
<span id="cb4-902"><a href="#cb4-902"></a></span>
<span id="cb4-903"><a href="#cb4-903"></a>  <span class="co">// ---- defs: arrow ----</span></span>
<span id="cb4-904"><a href="#cb4-904"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb4-905"><a href="#cb4-905"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span><span class="st">"arrow"</span>)</span>
<span id="cb4-906"><a href="#cb4-906"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span><span class="st">"0 0 10 10"</span>)</span>
<span id="cb4-907"><a href="#cb4-907"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">9</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb4-908"><a href="#cb4-908"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb4-909"><a href="#cb4-909"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span> <span class="st">"auto-start-reverse"</span>)</span>
<span id="cb4-910"><a href="#cb4-910"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb4-911"><a href="#cb4-911"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="st">"M 0 0 L 10 5 L 0 10 z"</span>)</span>
<span id="cb4-912"><a href="#cb4-912"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.45)"</span>)<span class="op">;</span></span>
<span id="cb4-913"><a href="#cb4-913"></a></span>
<span id="cb4-914"><a href="#cb4-914"></a>  <span class="co">// helper</span></span>
<span id="cb4-915"><a href="#cb4-915"></a>  <span class="kw">const</span> byId <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>(nodes<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">id</span><span class="op">,</span> d]))<span class="op">;</span></span>
<span id="cb4-916"><a href="#cb4-916"></a>  <span class="kw">const</span> centerRight <span class="op">=</span> d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> d<span class="op">.</span><span class="at">w</span><span class="op">,</span> d<span class="op">.</span><span class="at">y</span> <span class="op">+</span> d<span class="op">.</span><span class="at">h</span><span class="op">/</span><span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb4-917"><a href="#cb4-917"></a>  <span class="kw">const</span> centerLeft  <span class="op">=</span> d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">x</span><span class="op">,</span>       d<span class="op">.</span><span class="at">y</span> <span class="op">+</span> d<span class="op">.</span><span class="at">h</span><span class="op">/</span><span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb4-918"><a href="#cb4-918"></a>  <span class="kw">const</span> centerTop   <span class="op">=</span> d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> d<span class="op">.</span><span class="at">w</span><span class="op">/</span><span class="dv">2</span><span class="op">,</span> d<span class="op">.</span><span class="at">y</span>]<span class="op">;</span></span>
<span id="cb4-919"><a href="#cb4-919"></a>  <span class="kw">const</span> centerBot   <span class="op">=</span> d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> d<span class="op">.</span><span class="at">w</span><span class="op">/</span><span class="dv">2</span><span class="op">,</span> d<span class="op">.</span><span class="at">y</span> <span class="op">+</span> d<span class="op">.</span><span class="at">h</span>]<span class="op">;</span></span>
<span id="cb4-920"><a href="#cb4-920"></a></span>
<span id="cb4-921"><a href="#cb4-921"></a>  <span class="co">// ---- edges ----</span></span>
<span id="cb4-922"><a href="#cb4-922"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb4-923"><a href="#cb4-923"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path"</span>)</span>
<span id="cb4-924"><a href="#cb4-924"></a>    <span class="op">.</span><span class="fu">data</span>(edges)</span>
<span id="cb4-925"><a href="#cb4-925"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb4-926"><a href="#cb4-926"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)</span>
<span id="cb4-927"><a href="#cb4-927"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.35)"</span>)</span>
<span id="cb4-928"><a href="#cb4-928"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb4-929"><a href="#cb4-929"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span><span class="st">"url(#arrow)"</span>)</span>
<span id="cb4-930"><a href="#cb4-930"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> ([a<span class="op">,</span>b]) <span class="kw">=&gt;</span> {</span>
<span id="cb4-931"><a href="#cb4-931"></a>        <span class="kw">const</span> A <span class="op">=</span> byId<span class="op">.</span><span class="fu">get</span>(a)<span class="op">,</span> B <span class="op">=</span> byId<span class="op">.</span><span class="fu">get</span>(b)<span class="op">;</span></span>
<span id="cb4-932"><a href="#cb4-932"></a></span>
<span id="cb4-933"><a href="#cb4-933"></a>        <span class="co">// horizontal main chain</span></span>
<span id="cb4-934"><a href="#cb4-934"></a>        <span class="cf">if</span> ([<span class="st">"mb"</span><span class="op">,</span><span class="st">"q0"</span><span class="op">,</span><span class="st">"flow"</span>]<span class="op">.</span><span class="fu">includes</span>(a) <span class="op">&amp;&amp;</span> [<span class="st">"q0"</span><span class="op">,</span><span class="st">"flow"</span><span class="op">,</span><span class="st">"F"</span>]<span class="op">.</span><span class="fu">includes</span>(b)) {</span>
<span id="cb4-935"><a href="#cb4-935"></a>          <span class="kw">const</span> [x1<span class="op">,</span>y1] <span class="op">=</span> <span class="fu">centerRight</span>(A)<span class="op">;</span></span>
<span id="cb4-936"><a href="#cb4-936"></a>          <span class="kw">const</span> [x2<span class="op">,</span>y2] <span class="op">=</span> <span class="fu">centerLeft</span>(B)<span class="op">;</span></span>
<span id="cb4-937"><a href="#cb4-937"></a>          <span class="kw">const</span> mx <span class="op">=</span> (x1<span class="op">+</span>x2)<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb4-938"><a href="#cb4-938"></a>          <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>x1<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y1<span class="sc">}</span><span class="vs"> C</span><span class="sc">${</span>mx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y1<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>mx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y2<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x2<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb4-939"><a href="#cb4-939"></a>        }</span>
<span id="cb4-940"><a href="#cb4-940"></a></span>
<span id="cb4-941"><a href="#cb4-941"></a>        <span class="co">// down from F to updates</span></span>
<span id="cb4-942"><a href="#cb4-942"></a>        <span class="cf">if</span> (a <span class="op">===</span> <span class="st">"F"</span>) {</span>
<span id="cb4-943"><a href="#cb4-943"></a>          <span class="kw">const</span> [x1<span class="op">,</span>y1] <span class="op">=</span> <span class="fu">centerBot</span>(A)<span class="op">;</span></span>
<span id="cb4-944"><a href="#cb4-944"></a>          <span class="kw">const</span> [x2<span class="op">,</span>y2] <span class="op">=</span> <span class="fu">centerTop</span>(B)<span class="op">;</span></span>
<span id="cb4-945"><a href="#cb4-945"></a>          <span class="kw">const</span> mx <span class="op">=</span> (x1<span class="op">+</span>x2)<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb4-946"><a href="#cb4-946"></a>          <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>x1<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y1<span class="sc">}</span><span class="vs"> C</span><span class="sc">${</span>x1<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y1<span class="op">+</span><span class="dv">30</span><span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x2<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y2<span class="op">-</span><span class="dv">30</span><span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x2<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb4-947"><a href="#cb4-947"></a>        }</span>
<span id="cb4-948"><a href="#cb4-948"></a>        <span class="cf">return</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb4-949"><a href="#cb4-949"></a>      })<span class="op">;</span></span>
<span id="cb4-950"><a href="#cb4-950"></a></span>
<span id="cb4-951"><a href="#cb4-951"></a>  <span class="co">// ---- nodes ----</span></span>
<span id="cb4-952"><a href="#cb4-952"></a>  <span class="kw">const</span> g <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"g.node"</span>)</span>
<span id="cb4-953"><a href="#cb4-953"></a>    <span class="op">.</span><span class="fu">data</span>(nodes)</span>
<span id="cb4-954"><a href="#cb4-954"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"g"</span>)</span>
<span id="cb4-955"><a href="#cb4-955"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span><span class="st">"node"</span>)</span>
<span id="cb4-956"><a href="#cb4-956"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`translate(</span><span class="sc">${</span>d<span class="op">.</span><span class="at">x</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>d<span class="op">.</span><span class="at">y</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb4-957"><a href="#cb4-957"></a></span>
<span id="cb4-958"><a href="#cb4-958"></a>  g<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb4-959"><a href="#cb4-959"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">w</span>)</span>
<span id="cb4-960"><a href="#cb4-960"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">h</span>)</span>
<span id="cb4-961"><a href="#cb4-961"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">14</span>)</span>
<span id="cb4-962"><a href="#cb4-962"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(255,255,255,0.85)"</span>)</span>
<span id="cb4-963"><a href="#cb4-963"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"rgba(0,0,0,0.18)"</span>)</span>
<span id="cb4-964"><a href="#cb4-964"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb4-965"><a href="#cb4-965"></a></span>
<span id="cb4-966"><a href="#cb4-966"></a>  g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb4-967"><a href="#cb4-967"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">14</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">22</span>)</span>
<span id="cb4-968"><a href="#cb4-968"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">14</span>)</span>
<span id="cb4-969"><a href="#cb4-969"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">800</span>)</span>
<span id="cb4-970"><a href="#cb4-970"></a>    <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">title</span>)<span class="op">;</span></span>
<span id="cb4-971"><a href="#cb4-971"></a></span>
<span id="cb4-972"><a href="#cb4-972"></a>  g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb4-973"><a href="#cb4-973"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">14</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">42</span>)</span>
<span id="cb4-974"><a href="#cb4-974"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">13</span>)</span>
<span id="cb4-975"><a href="#cb4-975"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.85</span>)</span>
<span id="cb4-976"><a href="#cb4-976"></a>    <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">sub</span>)<span class="op">;</span></span>
<span id="cb4-977"><a href="#cb4-977"></a></span>
<span id="cb4-978"><a href="#cb4-978"></a>  <span class="co">// ---- cycling highlight ----</span></span>
<span id="cb4-979"><a href="#cb4-979"></a>  <span class="kw">const</span> hi <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb4-980"><a href="#cb4-980"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">14</span>)</span>
<span id="cb4-981"><a href="#cb4-981"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(234,170,0,0.10)"</span>)</span>
<span id="cb4-982"><a href="#cb4-982"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"rgba(234,170,0,0.75)"</span>)</span>
<span id="cb4-983"><a href="#cb4-983"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)</span>
<span id="cb4-984"><a href="#cb4-984"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"pointer-events"</span><span class="op">,</span><span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb4-985"><a href="#cb4-985"></a></span>
<span id="cb4-986"><a href="#cb4-986"></a>  <span class="kw">const</span> cycle <span class="op">=</span> [<span class="st">"mb"</span><span class="op">,</span><span class="st">"q0"</span><span class="op">,</span><span class="st">"flow"</span><span class="op">,</span><span class="st">"F"</span><span class="op">,</span><span class="st">"gth"</span><span class="op">,</span><span class="st">"gph"</span>]<span class="op">;</span> <span class="co">// matches pseudo-code order + both updates</span></span>
<span id="cb4-987"><a href="#cb4-987"></a>  <span class="kw">let</span> idx <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-988"><a href="#cb4-988"></a></span>
<span id="cb4-989"><a href="#cb4-989"></a>  <span class="kw">function</span> <span class="fu">step</span>(){</span>
<span id="cb4-990"><a href="#cb4-990"></a>    <span class="kw">const</span> d <span class="op">=</span> byId<span class="op">.</span><span class="fu">get</span>(cycle[idx])<span class="op">;</span></span>
<span id="cb4-991"><a href="#cb4-991"></a>    hi<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d<span class="op">.</span><span class="at">y</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> d<span class="op">.</span><span class="at">w</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> d<span class="op">.</span><span class="at">h</span>)<span class="op">;</span></span>
<span id="cb4-992"><a href="#cb4-992"></a>    idx <span class="op">=</span> (idx <span class="op">+</span> <span class="dv">1</span>) <span class="op">%</span> cycle<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb4-993"><a href="#cb4-993"></a>    <span class="pp">setTimeout</span>(step<span class="op">,</span> <span class="dv">900</span>)<span class="op">;</span></span>
<span id="cb4-994"><a href="#cb4-994"></a>  }</span>
<span id="cb4-995"><a href="#cb4-995"></a>  <span class="fu">step</span>()<span class="op">;</span></span>
<span id="cb4-996"><a href="#cb4-996"></a></span>
<span id="cb4-997"><a href="#cb4-997"></a>  <span class="co">// small label: while loop</span></span>
<span id="cb4-998"><a href="#cb4-998"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb4-999"><a href="#cb4-999"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">60</span>)</span>
<span id="cb4-1000"><a href="#cb4-1000"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">28</span>)</span>
<span id="cb4-1001"><a href="#cb4-1001"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">14</span>)</span>
<span id="cb4-1002"><a href="#cb4-1002"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">700</span>)</span>
<span id="cb4-1003"><a href="#cb4-1003"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.8</span>)</span>
<span id="cb4-1004"><a href="#cb4-1004"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Repeat until converged"</span>)<span class="op">;</span></span>
<span id="cb4-1005"><a href="#cb4-1005"></a></span>
<span id="cb4-1006"><a href="#cb4-1006"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb4-1007"><a href="#cb4-1007"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
</div>
<h3 id="computational-complexity">Computational complexity</h3>
<p>A key advantage of normalizing flows is that they add <strong>minimal computational overhead</strong>.</p>
<ul>
<li>Jacobian determinant computed in <strong><span class="math inline">O(D)</span></strong></li>
<li>No matrix inverses required</li>
<li>Total cost scales <strong>linearly in flow length</strong> <span class="math inline">K</span></li>
<li>Compatible with minibatch SGD and backpropagation</li>
</ul>
</section>
<section id="BFlowStart" class="slide level2">
<h2>Bayes Flows</h2>
<h3 id="why-bayesflow">Why BayesFlow?</h3>
<p>Many scientific models are <strong>simulator-based</strong>:</p>
<ul>
<li>We can simulate data <span class="math inline">x \sim p(x\mid \theta)</span></li>
<li>But the likelihood <span class="math inline">p(x\mid \theta)</span> is <strong>intractable / unavailable</strong></li>
<li>Goal: learn the <strong>posterior</strong> <span class="math inline">p(\theta \mid x)</span>anyway</li>
</ul>
<h3 id="why-this-is-hard">Why this is hard</h3>
<ul>
<li>Classical Bayesian inference relies on evaluating <span class="math inline">p(x\mid \theta)</span></li>
<li>ABC / SMC-ABC can work, but is often:
<ul>
<li>slow (many simulations)</li>
<li>sensitive to handcrafted summaries / distances</li>
<li>hard to scale to high dimensions</li>
</ul></li>
</ul>
<p><strong>Key need:</strong> fast, accurate <strong>likelihood-free</strong> Bayesian inference that can be reused across many datasets.</p>
</section>
<section id="bayesflow-in-one-idea-amortize-inference" class="slide level2">
<h2>BayesFlow in one idea: amortize inference</h2>
<div class="mizzou-code-box">
<p>BayesFlow is a framework for globally amortized Bayesian inference that uses invertible neural networks (normalizing flows) and learned summary statistics to perform likelihood-free inference efficiently and accurately across many datasets.</p>
</div>
<p><br><br></p>
<h3 id="what-bayesflow-learns-high-level">What BayesFlow learns (high level)</h3>
<ul>
<li>A <strong>summary network</strong> learns informative representations of the dataset <span class="math inline">\tilde{x} = h_\psi(x_{1:N})</span></li>
<li>A <strong>conditional normalizing flow</strong> learns an invertible transform so we can:
<ul>
<li><strong>sample</strong> quickly from <span class="math inline">\theta \sim p(\theta \mid x)</span></li>
<li><strong>evaluate</strong> posterior densities via Jacobians (for calibration and diagnostics)</li>
</ul></li>
</ul>
</section>
<section id="bayesflow-summary-inference-networks" class="slide level2">
<h2>BayesFlow: summary + inference networks</h2>
<div class="columns">
<div class="column">
<h3 id="core-idea">Core idea</h3>
<p>BayesFlow learns the inverse mapping <span class="math display">
x_{1:N} \;\mapsto\; p(\theta \mid x_{1:N})
</span> <strong>once</strong> using simulations, and reuses it for fast inference.</p>
<p><br></p>
<h3 id="summary-network">Summary network</h3>
<p><span class="math display">
\tilde{x} = h_\psi(x_{1:N})
</span> - Converts variable-length data to fixed summaries<br>
- Learns informative statistics automatically<br>
- Architecture matches data structure</p>
</div><div class="column">
<h3 id="inference-network-flow-based">Inference network (flow-based)</h3>
<p><span class="math display">
\theta \;\xleftrightarrow[]{\text{invertible}}\; z,
\qquad z \sim \mathcal{N}(0,I)
</span></p>
<ul>
<li>Conditional invertible neural network (cINN)<br>
</li>
<li>Learns a bijective transport map <span class="math display">
\theta = f_\phi(z \mid \tilde{x})
</span></li>
<li>Enables:
<ul>
<li>exact density evaluation (Jacobian)</li>
<li>exact posterior sampling (inverse pass)</li>
</ul></li>
</ul>
</div>
</div>
</section>
<section id="notation-and-setup" class="slide level2">
<h2>Notation and setup</h2>
<div class="columns">
<div class="column">
<p>We consider a generative model with:</p>
<ul>
<li><p>Parameter vector<br>
<span class="math display">
\theta = (\theta_1,\ldots,\theta_D) \in \mathbb{R}^D
</span></p></li>
<li><p>Dataset of size <span class="math inline">N</span> <span class="math inline">x_{1:N} = (x_1,\ldots,x_N)</span></p></li>
</ul>
<p><br></p>
<h3 id="neural-components">Neural components</h3>
<ul>
<li><strong>Inference network (flow)</strong> with parameters <span class="math inline">\phi</span></li>
<li><strong>Summary network</strong> with parameters <span class="math inline">\psi</span></li>
</ul>
</div><div class="column">
<p><br><br><br></p>
<h3 id="latent-space">Latent space</h3>
<p>We introduce a latent Gaussian variable <span class="math display">
z \sim \mathcal{N}(0, I),
</span> which will be mapped <strong>invertibly</strong> to <span class="math inline">\theta</span>.</p>
</div>
</div>
</section>
<section id="learning-the-posterior-via-invertible-maps" class="slide level2">
<h2>Learning the posterior via invertible maps</h2>
<p>We seek an approximation <span class="math display">
p_\phi(\theta \mid x) \approx p(\theta \mid x)
</span> using an invertible neural network <span class="math display">
\theta = f_\phi(z; x),
\qquad
z \sim \mathcal{N}(0, I).
</span></p>
<p><br></p>
<h3 id="change-of-variables-1">Change of variables</h3>
<p>The induced posterior density is <span class="math display">
p_\phi(\theta \mid x)
=
p(z)\,
\left|
\det \frac{\partial f_\phi(z;x)}{\partial \theta}
\right|^{-1}.
</span></p>
<p>Thus, inference reduces to learning a <strong>normalizing flow</strong> between <span class="math inline">z</span> and <span class="math inline">\theta</span>, conditioned on data.</p>
</section>
<section id="optimization-objective" class="slide level2">
<h2>Optimization objective</h2>
<p>We minimize the expected KL divergence: <span class="math display">
\phi^\star
=
\arg\min_\phi
\mathbb{E}_{p(x)}
\big[
\mathrm{KL}(p(\theta\mid x)\,\|\,p_\phi(\theta\mid x))
\big].
</span></p>
<p>This is equivalent to maximizing: <span class="math display">
\mathbb{E}_{p(x,\theta)}
\big[
\log p_\phi(\theta \mid x)
\big].
</span></p>
<h3 id="monte-carlo-training">Monte Carlo training</h3>
<p>Using simulated pairs <span class="math inline">(x^{(m)},\theta^{(m)})</span>: <span class="math display">
\mathcal{L}(\phi)
=
\frac{1}{M}\sum_{m=1}^M
\Big(
-\log p(z^{(m)})
- \log \big|\det J_{f_\phi}\big|
\Big).
</span></p>
<p>This objective is <strong>fully tractable</strong>.</p>
</section>
<section id="variable-size-datasets-and-summaries" class="slide level2">
<h2>Variable-size datasets and summaries</h2>
<p>When <span class="math inline">N</span> varies, raw data cannot be fed directly.</p>
<p><br></p>
<p>Introduce a learned summary: <span class="math display">
\tilde{x} = h_\psi(x_{1:N})
</span></p>
<p>The conditional flow becomes: <span class="math display">
\theta = f_\phi(z; \tilde{x}),
\qquad
\tilde{x} = h_\psi(x_{1:N}).
</span></p>
<h3 id="joint-objective">Joint objective</h3>
<p>We now optimize: <span class="math display">
(\phi^\star,\psi^\star)
=
\arg\max_{\phi,\psi}
\mathbb{E}_{p(x,\theta)}
\big[
\log p_\phi(\theta \mid h_\psi(x_{1:N}))
\big].
</span></p>
</section>
<section id="composing-invertible-networks" class="slide level2">
<h2>Composing invertible networks</h2>
<p>BayesFlow uses <strong>chains of invertible transformations</strong> to increase expressiveness.</p>
<p>Let <span class="math display">
f_\phi = f_K \circ \cdots \circ f_1,
</span> so that <span class="math display">
\theta = f_K \circ \cdots \circ f_1(z).
</span></p>
<p>Each block <span class="math inline">f_k</span> is an <strong>affine coupling block (ACB)</strong>.</p>
<h3 id="log-density">Log-density</h3>
<p>The log determinant decomposes: <span class="math display">
\log \left|\det J_{f_\phi}\right|
=
\sum_{k=1}^K
\log \left|\det J_{f_k}\right|.
</span></p>
</section>
<section id="affine-coupling-blocks-acb" class="slide level2">
<h2>Affine coupling blocks (ACB)</h2>
<p>Split input into two parts: <span class="math display">
u = (u_1, u_2).
</span></p>
<p>Forward map: <span class="math display">
\begin{aligned}
v_1 &amp;= u_1 \odot \exp(s_1(u_2)) + t_1(u_2), \\
v_2 &amp;= u_2 \odot \exp(s_2(v_1)) + t_2(v_1).
\end{aligned}
</span></p>
<p>Inverse map exists in closed form: <span class="math display">
u = f^{-1}(v).
</span></p>
<h3 id="key-properties">Key properties</h3>
<ul>
<li>Determinant is cheap</li>
<li>Internal networks need <strong>not</strong> be invertible</li>
</ul>
</section>
<section id="summary-network-why-do-we-need-it" class="slide level2">
<h2>Summary network: why do we need it?</h2>
<p>In practice, the number of observations varies: - different dataset sizes <span class="math inline">N</span> - different numbers of time points / measurements - redundancy in raw observations</p>
<p><br><br></p>
<p>So instead of feeding raw <span class="math inline">x_{1:N}</span> directly into the cINN, we learn a fixed-size summary: <span class="math display">
\tilde{x} = h_\psi(x_{1:N}).
</span></p>
<br><br>
<div class="mizzou-code-box">
<p><strong>Goal:</strong> avoid information loss from handcrafted summaries, and learn informative statistics directly from data.</p>
</div>
</section>
<section id="how-tildex-enters-the-invertible-network" class="slide level2">
<h2>How <span class="math inline">\tilde{x}</span> enters the invertible network</h2>
<p><br></p>
<p>Rather than feeding raw <span class="math inline">x_{1:N}</span> into each affine coupling block (ACB), we condition the internal networks on the learned summary <span class="math inline">\tilde{x}</span>.</p>
<p><br><br></p>
<p>For an ACB splitting <span class="math inline">u=(u_1,u_2)</span>, the forward map becomes: <span class="math display">
v_1 = u_1 \odot \exp(s_1(u_2,\tilde{x})) + t_1(u_2,\tilde{x}),
</span> <span class="math display">
v_2 = u_2 \odot \exp(s_2(v_1,\tilde{x})) + t_2(v_1,\tilde{x}).
</span></p>
<p>This keeps the overall map invertible, while injecting data information via <span class="math inline">\tilde{x}</span>.</p>
</section>
<section id="AlgoBayesFlow" class="slide level2">
<h2>Amortized Bayesian Inference With the BayesFlow Method</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="1355" data-source-offset="0"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1354;"><span id="cb5-1355"><a href="#cb5-1355"></a>bayesflow_algo_anim575 <span class="op">=</span> {</span>
<span id="cb5-1356"><a href="#cb5-1356"></a>  <span class="kw">const</span> W <span class="op">=</span> <span class="dv">1400</span><span class="op">,</span> H <span class="op">=</span> <span class="dv">520</span><span class="op">;</span></span>
<span id="cb5-1357"><a href="#cb5-1357"></a></span>
<span id="cb5-1358"><a href="#cb5-1358"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb5-1359"><a href="#cb5-1359"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="vs">`0 0 </span><span class="sc">${</span>W<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>H<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb5-1360"><a href="#cb5-1360"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span><span class="st">"100%"</span>)</span>
<span id="cb5-1361"><a href="#cb5-1361"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>W<span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb5-1362"><a href="#cb5-1362"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>H<span class="sc">}</span><span class="vs">px`</span>)<span class="op">;</span></span>
<span id="cb5-1363"><a href="#cb5-1363"></a></span>
<span id="cb5-1364"><a href="#cb5-1364"></a>  <span class="co">// ---------- defs ----------</span></span>
<span id="cb5-1365"><a href="#cb5-1365"></a>  <span class="kw">const</span> defs <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb5-1366"><a href="#cb5-1366"></a></span>
<span id="cb5-1367"><a href="#cb5-1367"></a>  defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb5-1368"><a href="#cb5-1368"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span><span class="st">"arr"</span>)</span>
<span id="cb5-1369"><a href="#cb5-1369"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span><span class="st">"0 0 10 10"</span>)</span>
<span id="cb5-1370"><a href="#cb5-1370"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">9</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb5-1371"><a href="#cb5-1371"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb5-1372"><a href="#cb5-1372"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span><span class="st">"auto"</span>)</span>
<span id="cb5-1373"><a href="#cb5-1373"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1374"><a href="#cb5-1374"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="st">"M 0 0 L 10 5 L 0 10 z"</span>)</span>
<span id="cb5-1375"><a href="#cb5-1375"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.55)"</span>)<span class="op">;</span></span>
<span id="cb5-1376"><a href="#cb5-1376"></a></span>
<span id="cb5-1377"><a href="#cb5-1377"></a>  defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"filter"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span><span class="st">"sh"</span>)</span>
<span id="cb5-1378"><a href="#cb5-1378"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"feDropShadow"</span>)</span>
<span id="cb5-1379"><a href="#cb5-1379"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="fl">1.2</span>)</span>
<span id="cb5-1380"><a href="#cb5-1380"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stdDeviation"</span><span class="op">,</span> <span class="fl">1.2</span>)</span>
<span id="cb5-1381"><a href="#cb5-1381"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"flood-opacity"</span><span class="op">,</span> <span class="fl">0.18</span>)<span class="op">;</span></span>
<span id="cb5-1382"><a href="#cb5-1382"></a></span>
<span id="cb5-1383"><a href="#cb5-1383"></a>  <span class="kw">const</span> g <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb5-1384"><a href="#cb5-1384"></a></span>
<span id="cb5-1385"><a href="#cb5-1385"></a>  <span class="co">// ---------- helpers ----------</span></span>
<span id="cb5-1386"><a href="#cb5-1386"></a>  <span class="kw">const</span> box <span class="op">=</span> (d<span class="op">,</span> accent<span class="op">=</span><span class="kw">false</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1387"><a href="#cb5-1387"></a>    <span class="kw">const</span> gg <span class="op">=</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"data-id"</span><span class="op">,</span> d<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb5-1388"><a href="#cb5-1388"></a></span>
<span id="cb5-1389"><a href="#cb5-1389"></a>    gg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb5-1390"><a href="#cb5-1390"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb5-1391"><a href="#cb5-1391"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> d<span class="op">.</span><span class="at">w</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> d<span class="op">.</span><span class="at">h</span>)</span>
<span id="cb5-1392"><a href="#cb5-1392"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">16</span>)</span>
<span id="cb5-1393"><a href="#cb5-1393"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(255,255,255,0.94)"</span>)</span>
<span id="cb5-1394"><a href="#cb5-1394"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> accent <span class="op">?</span> <span class="st">"rgba(244,180,0,0.95)"</span> <span class="op">:</span> <span class="st">"rgba(0,0,0,0.16)"</span>)</span>
<span id="cb5-1395"><a href="#cb5-1395"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> accent <span class="op">?</span> <span class="dv">3</span> <span class="op">:</span> <span class="fl">1.6</span>)</span>
<span id="cb5-1396"><a href="#cb5-1396"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"filter"</span><span class="op">,</span><span class="st">"url(#sh)"</span>)<span class="op">;</span></span>
<span id="cb5-1397"><a href="#cb5-1397"></a></span>
<span id="cb5-1398"><a href="#cb5-1398"></a>    gg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-1399"><a href="#cb5-1399"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> <span class="dv">16</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d<span class="op">.</span><span class="at">y</span> <span class="op">+</span> <span class="dv">28</span>)</span>
<span id="cb5-1400"><a href="#cb5-1400"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">16</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">850</span>)</span>
<span id="cb5-1401"><a href="#cb5-1401"></a>      <span class="op">.</span><span class="fu">text</span>(d<span class="op">.</span><span class="at">title</span>)<span class="op">;</span></span>
<span id="cb5-1402"><a href="#cb5-1402"></a></span>
<span id="cb5-1403"><a href="#cb5-1403"></a>    gg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-1404"><a href="#cb5-1404"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> <span class="dv">16</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d<span class="op">.</span><span class="at">y</span> <span class="op">+</span> <span class="dv">52</span>)</span>
<span id="cb5-1405"><a href="#cb5-1405"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="fl">12.5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.82</span>)</span>
<span id="cb5-1406"><a href="#cb5-1406"></a>      <span class="op">.</span><span class="fu">text</span>(d<span class="op">.</span><span class="at">line1</span> <span class="op">||</span> <span class="st">""</span>)<span class="op">;</span></span>
<span id="cb5-1407"><a href="#cb5-1407"></a></span>
<span id="cb5-1408"><a href="#cb5-1408"></a>    <span class="cf">if</span> (d<span class="op">.</span><span class="at">line2</span>){</span>
<span id="cb5-1409"><a href="#cb5-1409"></a>      gg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-1410"><a href="#cb5-1410"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> <span class="dv">16</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> d<span class="op">.</span><span class="at">y</span> <span class="op">+</span> <span class="dv">72</span>)</span>
<span id="cb5-1411"><a href="#cb5-1411"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="fl">12.5</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.82</span>)</span>
<span id="cb5-1412"><a href="#cb5-1412"></a>        <span class="op">.</span><span class="fu">text</span>(d<span class="op">.</span><span class="at">line2</span>)<span class="op">;</span></span>
<span id="cb5-1413"><a href="#cb5-1413"></a>    }</span>
<span id="cb5-1414"><a href="#cb5-1414"></a>    <span class="cf">return</span> gg<span class="op">;</span></span>
<span id="cb5-1415"><a href="#cb5-1415"></a>  }<span class="op">;</span></span>
<span id="cb5-1416"><a href="#cb5-1416"></a></span>
<span id="cb5-1417"><a href="#cb5-1417"></a>  <span class="kw">const</span> center <span class="op">=</span> d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> d<span class="op">.</span><span class="at">w</span><span class="op">/</span><span class="dv">2</span><span class="op">,</span> d<span class="op">.</span><span class="at">y</span> <span class="op">+</span> d<span class="op">.</span><span class="at">h</span><span class="op">/</span><span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb5-1418"><a href="#cb5-1418"></a>  <span class="kw">const</span> midR   <span class="op">=</span> d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> d<span class="op">.</span><span class="at">w</span><span class="op">,</span>   d<span class="op">.</span><span class="at">y</span> <span class="op">+</span> d<span class="op">.</span><span class="at">h</span><span class="op">/</span><span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb5-1419"><a href="#cb5-1419"></a>  <span class="kw">const</span> midL   <span class="op">=</span> d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">x</span><span class="op">,</span>         d<span class="op">.</span><span class="at">y</span> <span class="op">+</span> d<span class="op">.</span><span class="at">h</span><span class="op">/</span><span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb5-1420"><a href="#cb5-1420"></a>  <span class="kw">const</span> midB   <span class="op">=</span> d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> d<span class="op">.</span><span class="at">w</span><span class="op">/</span><span class="dv">2</span><span class="op">,</span> d<span class="op">.</span><span class="at">y</span> <span class="op">+</span> d<span class="op">.</span><span class="at">h</span>]<span class="op">;</span></span>
<span id="cb5-1421"><a href="#cb5-1421"></a>  <span class="kw">const</span> midT   <span class="op">=</span> d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> d<span class="op">.</span><span class="at">w</span><span class="op">/</span><span class="dv">2</span><span class="op">,</span> d<span class="op">.</span><span class="at">y</span>]<span class="op">;</span></span>
<span id="cb5-1422"><a href="#cb5-1422"></a></span>
<span id="cb5-1423"><a href="#cb5-1423"></a>  <span class="kw">const</span> curvedLR <span class="op">=</span> (A<span class="op">,</span>B) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1424"><a href="#cb5-1424"></a>    <span class="kw">const</span> [x1<span class="op">,</span>y1] <span class="op">=</span> A<span class="op">,</span> [x2<span class="op">,</span>y2] <span class="op">=</span> B<span class="op">;</span></span>
<span id="cb5-1425"><a href="#cb5-1425"></a>    <span class="kw">const</span> mx <span class="op">=</span> (x1<span class="op">+</span>x2)<span class="op">/</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb5-1426"><a href="#cb5-1426"></a>    <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>x1<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y1<span class="sc">}</span><span class="vs"> C</span><span class="sc">${</span>mx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y1<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>mx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y2<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x2<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb5-1427"><a href="#cb5-1427"></a>  }<span class="op">;</span></span>
<span id="cb5-1428"><a href="#cb5-1428"></a></span>
<span id="cb5-1429"><a href="#cb5-1429"></a>  <span class="kw">const</span> curvedDown <span class="op">=</span> (A<span class="op">,</span>B<span class="op">,</span> bow<span class="op">=</span><span class="dv">60</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1430"><a href="#cb5-1430"></a>    <span class="kw">const</span> [x1<span class="op">,</span>y1] <span class="op">=</span> A<span class="op">,</span> [x2<span class="op">,</span>y2] <span class="op">=</span> B<span class="op">;</span></span>
<span id="cb5-1431"><a href="#cb5-1431"></a>    <span class="kw">const</span> my <span class="op">=</span> (y1<span class="op">+</span>y2)<span class="op">/</span><span class="dv">2</span> <span class="op">+</span> bow<span class="op">;</span></span>
<span id="cb5-1432"><a href="#cb5-1432"></a>    <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>x1<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y1<span class="sc">}</span><span class="vs"> C</span><span class="sc">${</span>x1<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>my<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x2<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>my<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x2<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb5-1433"><a href="#cb5-1433"></a>  }<span class="op">;</span></span>
<span id="cb5-1434"><a href="#cb5-1434"></a></span>
<span id="cb5-1435"><a href="#cb5-1435"></a>  <span class="kw">const</span> loopBelow <span class="op">=</span> (fromA<span class="op">,</span> toB<span class="op">,</span> yLaneBottom) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1436"><a href="#cb5-1436"></a>    <span class="kw">const</span> [x1<span class="op">,</span>y1] <span class="op">=</span> fromA<span class="op">;</span></span>
<span id="cb5-1437"><a href="#cb5-1437"></a>    <span class="kw">const</span> [x2<span class="op">,</span>y2] <span class="op">=</span> toB<span class="op">;</span></span>
<span id="cb5-1438"><a href="#cb5-1438"></a></span>
<span id="cb5-1439"><a href="#cb5-1439"></a>    <span class="kw">const</span> yDown <span class="op">=</span> yLaneBottom <span class="op">+</span> <span class="dv">34</span><span class="op">;</span></span>
<span id="cb5-1440"><a href="#cb5-1440"></a>    <span class="kw">const</span> pull <span class="op">=</span> <span class="dv">140</span><span class="op">;</span></span>
<span id="cb5-1441"><a href="#cb5-1441"></a></span>
<span id="cb5-1442"><a href="#cb5-1442"></a>    <span class="cf">return</span> [</span>
<span id="cb5-1443"><a href="#cb5-1443"></a>      <span class="vs">`M</span><span class="sc">${</span>x1<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y1<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb5-1444"><a href="#cb5-1444"></a>      <span class="vs">`C</span><span class="sc">${</span>x1<span class="op">+</span>pull<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y1<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x1<span class="op">+</span>pull<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>yDown<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x1<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>yDown<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb5-1445"><a href="#cb5-1445"></a>      <span class="vs">`C</span><span class="sc">${</span>(x1<span class="op">+</span>x2)<span class="op">/</span><span class="dv">2</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>yDown<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>(x1<span class="op">+</span>x2)<span class="op">/</span><span class="dv">2</span><span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>yDown<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x2<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>yDown<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb5-1446"><a href="#cb5-1446"></a>      <span class="vs">`C</span><span class="sc">${</span>x2<span class="op">-</span>pull<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>yDown<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x2<span class="op">-</span>pull<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y2<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x2<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y2<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb5-1447"><a href="#cb5-1447"></a>    ]<span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">;</span></span>
<span id="cb5-1448"><a href="#cb5-1448"></a>  }<span class="op">;</span></span>
<span id="cb5-1449"><a href="#cb5-1449"></a></span>
<span id="cb5-1450"><a href="#cb5-1450"></a>  <span class="kw">const</span> loopBracket <span class="op">=</span> ({x<span class="op">,</span> y<span class="op">,</span> w<span class="op">,</span> h<span class="op">,</span> label}) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1451"><a href="#cb5-1451"></a>    <span class="kw">const</span> gg <span class="op">=</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb5-1452"><a href="#cb5-1452"></a></span>
<span id="cb5-1453"><a href="#cb5-1453"></a>    gg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb5-1454"><a href="#cb5-1454"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> x)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> y)</span>
<span id="cb5-1455"><a href="#cb5-1455"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> w)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> h)</span>
<span id="cb5-1456"><a href="#cb5-1456"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">18</span>)</span>
<span id="cb5-1457"><a href="#cb5-1457"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(244,180,0,0.06)"</span>)</span>
<span id="cb5-1458"><a href="#cb5-1458"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"rgba(244,180,0,0.55)"</span>)</span>
<span id="cb5-1459"><a href="#cb5-1459"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">2</span>)</span>
<span id="cb5-1460"><a href="#cb5-1460"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"8,6"</span>)<span class="op">;</span></span>
<span id="cb5-1461"><a href="#cb5-1461"></a></span>
<span id="cb5-1462"><a href="#cb5-1462"></a>    gg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-1463"><a href="#cb5-1463"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> x <span class="op">+</span> <span class="dv">16</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> y <span class="op">-</span> <span class="dv">10</span>)</span>
<span id="cb5-1464"><a href="#cb5-1464"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="fl">13.5</span>)</span>
<span id="cb5-1465"><a href="#cb5-1465"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">850</span>)</span>
<span id="cb5-1466"><a href="#cb5-1466"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.90</span>)</span>
<span id="cb5-1467"><a href="#cb5-1467"></a>      <span class="op">.</span><span class="fu">text</span>(label)<span class="op">;</span></span>
<span id="cb5-1468"><a href="#cb5-1468"></a></span>
<span id="cb5-1469"><a href="#cb5-1469"></a>    <span class="cf">return</span> gg<span class="op">;</span></span>
<span id="cb5-1470"><a href="#cb5-1470"></a>  }<span class="op">;</span></span>
<span id="cb5-1471"><a href="#cb5-1471"></a></span>
<span id="cb5-1472"><a href="#cb5-1472"></a>  <span class="co">// ---------- layout ----------</span></span>
<span id="cb5-1473"><a href="#cb5-1473"></a>  <span class="kw">const</span> yT <span class="op">=</span> <span class="dv">120</span><span class="op">;</span></span>
<span id="cb5-1474"><a href="#cb5-1474"></a>  <span class="kw">const</span> yI <span class="op">=</span> <span class="dv">360</span><span class="op">;</span></span>
<span id="cb5-1475"><a href="#cb5-1475"></a></span>
<span id="cb5-1476"><a href="#cb5-1476"></a>  <span class="kw">const</span> train <span class="op">=</span> [</span>
<span id="cb5-1477"><a href="#cb5-1477"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"N"</span><span class="op">,</span>   <span class="dt">x</span><span class="op">:</span><span class="dv">70</span><span class="op">,</span>   <span class="dt">y</span><span class="op">:</span>yT<span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">210</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">92</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"1) Sample N"</span><span class="op">,</span>   <span class="dt">line1</span><span class="op">:</span><span class="st">"N ~ U(Nmin, Nmax)"</span>}<span class="op">,</span></span>
<span id="cb5-1478"><a href="#cb5-1478"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"th"</span><span class="op">,</span>  <span class="dt">x</span><span class="op">:</span><span class="dv">320</span><span class="op">,</span>  <span class="dt">y</span><span class="op">:</span>yT<span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">210</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">92</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"2) Sample θ"</span><span class="op">,</span>   <span class="dt">line1</span><span class="op">:</span><span class="st">"θ^(m) ~ p(θ)"</span>}<span class="op">,</span></span>
<span id="cb5-1479"><a href="#cb5-1479"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"sim"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span><span class="dv">570</span><span class="op">,</span>  <span class="dt">y</span><span class="op">:</span>yT<span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">230</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">92</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"3) Simulate x"</span><span class="op">,</span> <span class="dt">line1</span><span class="op">:</span><span class="st">"x_i = g(θ^(m), ξ_i)"</span><span class="op">,</span> <span class="dt">line2</span><span class="op">:</span><span class="st">"for i = 1..N"</span>}<span class="op">,</span></span>
<span id="cb5-1480"><a href="#cb5-1480"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"sum"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span><span class="dv">840</span><span class="op">,</span>  <span class="dt">y</span><span class="op">:</span>yT<span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">210</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">92</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"4) Summary"</span><span class="op">,</span>    <span class="dt">line1</span><span class="op">:</span><span class="st">"x̃ = hψ(x₁:N)"</span>}<span class="op">,</span></span>
<span id="cb5-1481"><a href="#cb5-1481"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"fwd"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span><span class="dv">1090</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span>yT<span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">210</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">92</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"5) Flow (→)"</span><span class="op">,</span>   <span class="dt">line1</span><span class="op">:</span><span class="st">"z = fϕ(θ; x̃)"</span>}<span class="op">,</span></span>
<span id="cb5-1482"><a href="#cb5-1482"></a>  ]<span class="op">;</span></span>
<span id="cb5-1483"><a href="#cb5-1483"></a></span>
<span id="cb5-1484"><a href="#cb5-1484"></a>  <span class="kw">const</span> infer <span class="op">=</span> [</span>
<span id="cb5-1485"><a href="#cb5-1485"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"obs"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span><span class="dv">70</span><span class="op">,</span>   <span class="dt">y</span><span class="op">:</span>yI<span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">250</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">92</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Inference input"</span><span class="op">,</span> <span class="dt">line1</span><span class="op">:</span><span class="st">"observed x₁:N^o"</span>}<span class="op">,</span></span>
<span id="cb5-1486"><a href="#cb5-1486"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"sumo"</span><span class="op">,</span><span class="dt">x</span><span class="op">:</span><span class="dv">360</span><span class="op">,</span>  <span class="dt">y</span><span class="op">:</span>yI<span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">210</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">92</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Summary"</span><span class="op">,</span>         <span class="dt">line1</span><span class="op">:</span><span class="st">"x̃^o = hψ(x₁:N^o)"</span>}<span class="op">,</span></span>
<span id="cb5-1487"><a href="#cb5-1487"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"z"</span><span class="op">,</span>   <span class="dt">x</span><span class="op">:</span><span class="dv">610</span><span class="op">,</span>  <span class="dt">y</span><span class="op">:</span>yI<span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">210</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">92</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Sample latent"</span><span class="op">,</span>   <span class="dt">line1</span><span class="op">:</span><span class="st">"z(l) ~ N(0, I)"</span>}<span class="op">,</span></span>
<span id="cb5-1488"><a href="#cb5-1488"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"inv"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span><span class="dv">860</span><span class="op">,</span>  <span class="dt">y</span><span class="op">:</span>yI<span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">250</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">92</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Flow (←)"</span><span class="op">,</span>        <span class="dt">line1</span><span class="op">:</span><span class="st">"θ^(l) = fϕ(z(l); x̃^o)"</span>}<span class="op">,</span></span>
<span id="cb5-1489"><a href="#cb5-1489"></a>    <span class="co">// tweak return to be explicit (optional)</span></span>
<span id="cb5-1490"><a href="#cb5-1490"></a>    {<span class="dt">id</span><span class="op">:</span><span class="st">"out"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span><span class="dv">1150</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span>yI<span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">160</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">92</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Return"</span><span class="op">,</span>          <span class="dt">line1</span><span class="op">:</span><span class="st">"{θ^(l)}_{l=1}^L"</span>}<span class="op">,</span></span>
<span id="cb5-1491"><a href="#cb5-1491"></a>  ]<span class="op">;</span></span>
<span id="cb5-1492"><a href="#cb5-1492"></a></span>
<span id="cb5-1493"><a href="#cb5-1493"></a>  <span class="kw">const</span> upd <span class="op">=</span> {</span>
<span id="cb5-1494"><a href="#cb5-1494"></a>    <span class="dt">id</span><span class="op">:</span><span class="st">"updPanel"</span><span class="op">,</span> <span class="dt">x</span><span class="op">:</span><span class="dv">1040</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span><span class="dv">235</span><span class="op">,</span> <span class="dt">w</span><span class="op">:</span><span class="dv">260</span><span class="op">,</span> <span class="dt">h</span><span class="op">:</span><span class="dv">96</span><span class="op">,</span></span>
<span id="cb5-1495"><a href="#cb5-1495"></a>    <span class="dt">title</span><span class="op">:</span><span class="st">"Training objective"</span><span class="op">,</span></span>
<span id="cb5-1496"><a href="#cb5-1496"></a>    <span class="dt">line1</span><span class="op">:</span><span class="st">"compute loss "</span><span class="op">,</span></span>
<span id="cb5-1497"><a href="#cb5-1497"></a>    <span class="dt">line2</span><span class="op">:</span><span class="st">"update parameters: ϕ, ψ"</span></span>
<span id="cb5-1498"><a href="#cb5-1498"></a>  }<span class="op">;</span></span>
<span id="cb5-1499"><a href="#cb5-1499"></a></span>
<span id="cb5-1500"><a href="#cb5-1500"></a>  <span class="co">// titles</span></span>
<span id="cb5-1501"><a href="#cb5-1501"></a>  <span class="kw">const</span> tag <span class="op">=</span> (x<span class="op">,</span>y<span class="op">,</span>text) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1502"><a href="#cb5-1502"></a>    g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-1503"><a href="#cb5-1503"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> x)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> y)</span>
<span id="cb5-1504"><a href="#cb5-1504"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">14</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">900</span>)</span>
<span id="cb5-1505"><a href="#cb5-1505"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.85</span>)</span>
<span id="cb5-1506"><a href="#cb5-1506"></a>      <span class="op">.</span><span class="fu">text</span>(text)<span class="op">;</span></span>
<span id="cb5-1507"><a href="#cb5-1507"></a>  }<span class="op">;</span></span>
<span id="cb5-1508"><a href="#cb5-1508"></a>  <span class="fu">tag</span>(<span class="dv">70</span><span class="op">,</span> <span class="dv">95</span><span class="op">,</span>  <span class="st">"TRAINING PHASE (repeat)"</span>)<span class="op">;</span></span>
<span id="cb5-1509"><a href="#cb5-1509"></a>  <span class="fu">tag</span>(<span class="dv">70</span><span class="op">,</span> <span class="dv">335</span><span class="op">,</span> <span class="st">"INFERENCE PHASE (given observed data)"</span>)<span class="op">;</span></span>
<span id="cb5-1510"><a href="#cb5-1510"></a></span>
<span id="cb5-1511"><a href="#cb5-1511"></a>  <span class="co">// entry/exit gates</span></span>
<span id="cb5-1512"><a href="#cb5-1512"></a>  <span class="kw">const</span> gate <span class="op">=</span> (x<span class="op">,</span>y<span class="op">,</span>label) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1513"><a href="#cb5-1513"></a>    <span class="kw">const</span> gg <span class="op">=</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb5-1514"><a href="#cb5-1514"></a>    gg<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb5-1515"><a href="#cb5-1515"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span>x)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span>y)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span><span class="dv">10</span>)</span>
<span id="cb5-1516"><a href="#cb5-1516"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"rgba(244,180,0,0.95)"</span>)</span>
<span id="cb5-1517"><a href="#cb5-1517"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.18)"</span>)<span class="op">;</span></span>
<span id="cb5-1518"><a href="#cb5-1518"></a>    gg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-1519"><a href="#cb5-1519"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>x<span class="op">+</span><span class="dv">16</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>y<span class="op">+</span><span class="dv">5</span>)</span>
<span id="cb5-1520"><a href="#cb5-1520"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">13</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">850</span>)</span>
<span id="cb5-1521"><a href="#cb5-1521"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.85</span>)</span>
<span id="cb5-1522"><a href="#cb5-1522"></a>      <span class="op">.</span><span class="fu">text</span>(label)<span class="op">;</span></span>
<span id="cb5-1523"><a href="#cb5-1523"></a>  }<span class="op">;</span></span>
<span id="cb5-1524"><a href="#cb5-1524"></a>  <span class="fu">gate</span>(<span class="dv">40</span><span class="op">,</span> yT <span class="op">+</span> <span class="dv">46</span><span class="op">,</span> <span class="st">"enter repeat"</span>)<span class="op">;</span></span>
<span id="cb5-1525"><a href="#cb5-1525"></a>  <span class="fu">gate</span>(<span class="dv">40</span><span class="op">,</span> yI <span class="op">+</span> <span class="dv">46</span><span class="op">,</span> <span class="st">"exit with posterior samples"</span>)<span class="op">;</span></span>
<span id="cb5-1526"><a href="#cb5-1526"></a></span>
<span id="cb5-1527"><a href="#cb5-1527"></a>  <span class="co">// draw boxes</span></span>
<span id="cb5-1528"><a href="#cb5-1528"></a>  <span class="kw">const</span> nodes <span class="op">=</span> [<span class="op">...</span>train<span class="op">,</span> <span class="op">...</span>infer<span class="op">,</span> upd]<span class="op">;</span></span>
<span id="cb5-1529"><a href="#cb5-1529"></a>  <span class="kw">const</span> map <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>(nodes<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">id</span><span class="op">,</span> d]))<span class="op">;</span></span>
<span id="cb5-1530"><a href="#cb5-1530"></a></span>
<span id="cb5-1531"><a href="#cb5-1531"></a>  <span class="kw">const</span> nodeG <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb5-1532"><a href="#cb5-1532"></a>  train<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> nodeG<span class="op">.</span><span class="fu">set</span>(d<span class="op">.</span><span class="at">id</span><span class="op">,</span> <span class="fu">box</span>(d<span class="op">,</span> <span class="kw">false</span>)))<span class="op">;</span></span>
<span id="cb5-1533"><a href="#cb5-1533"></a>  infer<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> nodeG<span class="op">.</span><span class="fu">set</span>(d<span class="op">.</span><span class="at">id</span><span class="op">,</span> <span class="fu">box</span>(d<span class="op">,</span> <span class="kw">false</span>)))<span class="op">;</span></span>
<span id="cb5-1534"><a href="#cb5-1534"></a>  nodeG<span class="op">.</span><span class="fu">set</span>(upd<span class="op">.</span><span class="at">id</span><span class="op">,</span> <span class="fu">box</span>(upd<span class="op">,</span> <span class="kw">true</span>))<span class="op">;</span></span>
<span id="cb5-1535"><a href="#cb5-1535"></a></span>
<span id="cb5-1536"><a href="#cb5-1536"></a>  <span class="co">// loop annotations (m and i)</span></span>
<span id="cb5-1537"><a href="#cb5-1537"></a>  <span class="kw">const</span> mLeft  <span class="op">=</span> map<span class="op">.</span><span class="fu">get</span>(<span class="st">"th"</span>)<span class="op">.</span><span class="at">x</span> <span class="op">-</span> <span class="dv">18</span><span class="op">;</span></span>
<span id="cb5-1538"><a href="#cb5-1538"></a>  <span class="kw">const</span> mTop   <span class="op">=</span> map<span class="op">.</span><span class="fu">get</span>(<span class="st">"th"</span>)<span class="op">.</span><span class="at">y</span> <span class="op">-</span> <span class="dv">22</span><span class="op">;</span></span>
<span id="cb5-1539"><a href="#cb5-1539"></a>  <span class="kw">const</span> mRight <span class="op">=</span> map<span class="op">.</span><span class="fu">get</span>(<span class="st">"fwd"</span>)<span class="op">.</span><span class="at">x</span> <span class="op">+</span> map<span class="op">.</span><span class="fu">get</span>(<span class="st">"fwd"</span>)<span class="op">.</span><span class="at">w</span> <span class="op">+</span> <span class="dv">18</span><span class="op">;</span></span>
<span id="cb5-1540"><a href="#cb5-1540"></a>  <span class="kw">const</span> mBot   <span class="op">=</span> map<span class="op">.</span><span class="fu">get</span>(<span class="st">"fwd"</span>)<span class="op">.</span><span class="at">y</span> <span class="op">+</span> map<span class="op">.</span><span class="fu">get</span>(<span class="st">"fwd"</span>)<span class="op">.</span><span class="at">h</span> <span class="op">+</span> <span class="dv">18</span><span class="op">;</span></span>
<span id="cb5-1541"><a href="#cb5-1541"></a></span>
<span id="cb5-1542"><a href="#cb5-1542"></a>  <span class="fu">loopBracket</span>({</span>
<span id="cb5-1543"><a href="#cb5-1543"></a>    <span class="dt">x</span><span class="op">:</span> mLeft<span class="op">,</span></span>
<span id="cb5-1544"><a href="#cb5-1544"></a>    <span class="dt">y</span><span class="op">:</span> mTop<span class="op">,</span></span>
<span id="cb5-1545"><a href="#cb5-1545"></a>    <span class="dt">w</span><span class="op">:</span> mRight <span class="op">-</span> mLeft<span class="op">,</span></span>
<span id="cb5-1546"><a href="#cb5-1546"></a>    <span class="dt">h</span><span class="op">:</span> mBot <span class="op">-</span> mTop<span class="op">,</span></span>
<span id="cb5-1547"><a href="#cb5-1547"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"for m = 1..M  (mini-batch)"</span></span>
<span id="cb5-1548"><a href="#cb5-1548"></a>  })<span class="op">;</span></span>
<span id="cb5-1549"><a href="#cb5-1549"></a></span>
<span id="cb5-1550"><a href="#cb5-1550"></a>  <span class="kw">const</span> simBox <span class="op">=</span> map<span class="op">.</span><span class="fu">get</span>(<span class="st">"sim"</span>)<span class="op">;</span></span>
<span id="cb5-1551"><a href="#cb5-1551"></a>  <span class="fu">loopBracket</span>({</span>
<span id="cb5-1552"><a href="#cb5-1552"></a>    <span class="dt">x</span><span class="op">:</span> simBox<span class="op">.</span><span class="at">x</span> <span class="op">-</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb5-1553"><a href="#cb5-1553"></a>    <span class="dt">y</span><span class="op">:</span> simBox<span class="op">.</span><span class="at">y</span> <span class="op">-</span> <span class="dv">14</span><span class="op">,</span></span>
<span id="cb5-1554"><a href="#cb5-1554"></a>    <span class="dt">w</span><span class="op">:</span> simBox<span class="op">.</span><span class="at">w</span> <span class="op">+</span> <span class="dv">24</span><span class="op">,</span></span>
<span id="cb5-1555"><a href="#cb5-1555"></a>    <span class="dt">h</span><span class="op">:</span> simBox<span class="op">.</span><span class="at">h</span> <span class="op">+</span> <span class="dv">28</span><span class="op">,</span></span>
<span id="cb5-1556"><a href="#cb5-1556"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"for i = 1..N  (simulate observations)"</span></span>
<span id="cb5-1557"><a href="#cb5-1557"></a>  })<span class="op">;</span></span>
<span id="cb5-1558"><a href="#cb5-1558"></a></span>
<span id="cb5-1559"><a href="#cb5-1559"></a>  <span class="co">// NEW: inference loop over l = 1..L (covers Sample latent + Flow inverse)</span></span>
<span id="cb5-1560"><a href="#cb5-1560"></a>  <span class="kw">const</span> zBox <span class="op">=</span> map<span class="op">.</span><span class="fu">get</span>(<span class="st">"z"</span>)<span class="op">;</span></span>
<span id="cb5-1561"><a href="#cb5-1561"></a>  <span class="kw">const</span> invBox <span class="op">=</span> map<span class="op">.</span><span class="fu">get</span>(<span class="st">"inv"</span>)<span class="op">;</span></span>
<span id="cb5-1562"><a href="#cb5-1562"></a>  <span class="kw">const</span> lLeft  <span class="op">=</span> zBox<span class="op">.</span><span class="at">x</span> <span class="op">-</span> <span class="dv">14</span><span class="op">;</span></span>
<span id="cb5-1563"><a href="#cb5-1563"></a>  <span class="kw">const</span> lTop   <span class="op">=</span> zBox<span class="op">.</span><span class="at">y</span> <span class="op">-</span> <span class="dv">22</span><span class="op">;</span></span>
<span id="cb5-1564"><a href="#cb5-1564"></a>  <span class="kw">const</span> lRight <span class="op">=</span> invBox<span class="op">.</span><span class="at">x</span> <span class="op">+</span> invBox<span class="op">.</span><span class="at">w</span> <span class="op">+</span> <span class="dv">14</span><span class="op">;</span></span>
<span id="cb5-1565"><a href="#cb5-1565"></a>  <span class="kw">const</span> lBot   <span class="op">=</span> invBox<span class="op">.</span><span class="at">y</span> <span class="op">+</span> invBox<span class="op">.</span><span class="at">h</span> <span class="op">+</span> <span class="dv">18</span><span class="op">;</span></span>
<span id="cb5-1566"><a href="#cb5-1566"></a></span>
<span id="cb5-1567"><a href="#cb5-1567"></a>  <span class="fu">loopBracket</span>({</span>
<span id="cb5-1568"><a href="#cb5-1568"></a>    <span class="dt">x</span><span class="op">:</span> lLeft<span class="op">,</span></span>
<span id="cb5-1569"><a href="#cb5-1569"></a>    <span class="dt">y</span><span class="op">:</span> lTop<span class="op">,</span></span>
<span id="cb5-1570"><a href="#cb5-1570"></a>    <span class="dt">w</span><span class="op">:</span> lRight <span class="op">-</span> lLeft<span class="op">,</span></span>
<span id="cb5-1571"><a href="#cb5-1571"></a>    <span class="dt">h</span><span class="op">:</span> lBot <span class="op">-</span> lTop<span class="op">,</span></span>
<span id="cb5-1572"><a href="#cb5-1572"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"for l = 1..L  (posterior samples)"</span></span>
<span id="cb5-1573"><a href="#cb5-1573"></a>  })<span class="op">;</span></span>
<span id="cb5-1574"><a href="#cb5-1574"></a></span>
<span id="cb5-1575"><a href="#cb5-1575"></a>  <span class="co">// main lane arrows</span></span>
<span id="cb5-1576"><a href="#cb5-1576"></a>  <span class="kw">const</span> drawEdges <span class="op">=</span> (arr) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1577"><a href="#cb5-1577"></a>    g<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-1578"><a href="#cb5-1578"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"path.e"</span>)</span>
<span id="cb5-1579"><a href="#cb5-1579"></a>      <span class="op">.</span><span class="fu">data</span>(arr)</span>
<span id="cb5-1580"><a href="#cb5-1580"></a>      <span class="op">.</span><span class="fu">join</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1581"><a href="#cb5-1581"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)</span>
<span id="cb5-1582"><a href="#cb5-1582"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.28)"</span>)</span>
<span id="cb5-1583"><a href="#cb5-1583"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">2.2</span>)</span>
<span id="cb5-1584"><a href="#cb5-1584"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span><span class="st">"url(#arr)"</span>)</span>
<span id="cb5-1585"><a href="#cb5-1585"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> ([a<span class="op">,</span>b]) <span class="kw">=&gt;</span> <span class="fu">curvedLR</span>(<span class="fu">midR</span>(map<span class="op">.</span><span class="fu">get</span>(a))<span class="op">,</span> <span class="fu">midL</span>(map<span class="op">.</span><span class="fu">get</span>(b))))<span class="op">;</span></span>
<span id="cb5-1586"><a href="#cb5-1586"></a>  }<span class="op">;</span></span>
<span id="cb5-1587"><a href="#cb5-1587"></a></span>
<span id="cb5-1588"><a href="#cb5-1588"></a>  <span class="fu">drawEdges</span>([[<span class="st">"N"</span><span class="op">,</span><span class="st">"th"</span>]<span class="op">,</span>[<span class="st">"th"</span><span class="op">,</span><span class="st">"sim"</span>]<span class="op">,</span>[<span class="st">"sim"</span><span class="op">,</span><span class="st">"sum"</span>]<span class="op">,</span>[<span class="st">"sum"</span><span class="op">,</span><span class="st">"fwd"</span>]])<span class="op">;</span></span>
<span id="cb5-1589"><a href="#cb5-1589"></a>  <span class="fu">drawEdges</span>([[<span class="st">"obs"</span><span class="op">,</span><span class="st">"sumo"</span>]<span class="op">,</span>[<span class="st">"sumo"</span><span class="op">,</span><span class="st">"z"</span>]<span class="op">,</span>[<span class="st">"z"</span><span class="op">,</span><span class="st">"inv"</span>]<span class="op">,</span>[<span class="st">"inv"</span><span class="op">,</span><span class="st">"out"</span>]])<span class="op">;</span></span>
<span id="cb5-1590"><a href="#cb5-1590"></a></span>
<span id="cb5-1591"><a href="#cb5-1591"></a>  <span class="co">// Flow -&gt; Training objective</span></span>
<span id="cb5-1592"><a href="#cb5-1592"></a>  g<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1593"><a href="#cb5-1593"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)</span>
<span id="cb5-1594"><a href="#cb5-1594"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.28)"</span>)</span>
<span id="cb5-1595"><a href="#cb5-1595"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">2.2</span>)</span>
<span id="cb5-1596"><a href="#cb5-1596"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span><span class="st">"url(#arr)"</span>)</span>
<span id="cb5-1597"><a href="#cb5-1597"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">curvedDown</span>(<span class="fu">midB</span>(map<span class="op">.</span><span class="fu">get</span>(<span class="st">"fwd"</span>))<span class="op">,</span> <span class="fu">midT</span>(map<span class="op">.</span><span class="fu">get</span>(<span class="st">"updPanel"</span>))<span class="op">,</span> <span class="dv">70</span>))<span class="op">;</span></span>
<span id="cb5-1598"><a href="#cb5-1598"></a></span>
<span id="cb5-1599"><a href="#cb5-1599"></a>  <span class="co">// repeat loop: objective -&gt; Sample N (under boxes)</span></span>
<span id="cb5-1600"><a href="#cb5-1600"></a>  <span class="kw">const</span> yTrainBottom <span class="op">=</span> yT <span class="op">+</span> <span class="dv">92</span><span class="op">;</span></span>
<span id="cb5-1601"><a href="#cb5-1601"></a>  g<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1602"><a href="#cb5-1602"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)</span>
<span id="cb5-1603"><a href="#cb5-1603"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.18)"</span>)</span>
<span id="cb5-1604"><a href="#cb5-1604"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">2.1</span>)</span>
<span id="cb5-1605"><a href="#cb5-1605"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span><span class="st">"url(#arr)"</span>)</span>
<span id="cb5-1606"><a href="#cb5-1606"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">loopBelow</span>(<span class="fu">midL</span>(map<span class="op">.</span><span class="fu">get</span>(<span class="st">"updPanel"</span>))<span class="op">,</span> <span class="fu">midL</span>(map<span class="op">.</span><span class="fu">get</span>(<span class="st">"N"</span>))<span class="op">,</span> yTrainBottom))<span class="op">;</span></span>
<span id="cb5-1607"><a href="#cb5-1607"></a></span>
<span id="cb5-1608"><a href="#cb5-1608"></a>  <span class="co">// ---------- animation ----------</span></span>
<span id="cb5-1609"><a href="#cb5-1609"></a>  <span class="kw">const</span> steps <span class="op">=</span> [</span>
<span id="cb5-1610"><a href="#cb5-1610"></a>    <span class="st">"N"</span><span class="op">,</span><span class="st">"th"</span><span class="op">,</span><span class="st">"sim"</span><span class="op">,</span><span class="st">"sum"</span><span class="op">,</span><span class="st">"fwd"</span><span class="op">,</span><span class="st">"updPanel"</span><span class="op">,</span><span class="st">"N"</span><span class="op">,</span></span>
<span id="cb5-1611"><a href="#cb5-1611"></a>    <span class="st">"obs"</span><span class="op">,</span><span class="st">"sumo"</span><span class="op">,</span><span class="st">"z"</span><span class="op">,</span><span class="st">"inv"</span><span class="op">,</span><span class="st">"out"</span></span>
<span id="cb5-1612"><a href="#cb5-1612"></a>  ]<span class="op">;</span></span>
<span id="cb5-1613"><a href="#cb5-1613"></a></span>
<span id="cb5-1614"><a href="#cb5-1614"></a>  <span class="kw">const</span> packet <span class="op">=</span> g<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb5-1615"><a href="#cb5-1615"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb5-1616"><a href="#cb5-1616"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.65)"</span>)</span>
<span id="cb5-1617"><a href="#cb5-1617"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.85</span>)<span class="op">;</span></span>
<span id="cb5-1618"><a href="#cb5-1618"></a></span>
<span id="cb5-1619"><a href="#cb5-1619"></a>  <span class="kw">function</span> <span class="fu">setAccent</span>(id){</span>
<span id="cb5-1620"><a href="#cb5-1620"></a>    [<span class="op">...</span>train<span class="op">,</span> <span class="op">...</span>infer]<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb5-1621"><a href="#cb5-1621"></a>      nodeG<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">id</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">"rect"</span>)</span>
<span id="cb5-1622"><a href="#cb5-1622"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.16)"</span>)</span>
<span id="cb5-1623"><a href="#cb5-1623"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">1.6</span>)<span class="op">;</span></span>
<span id="cb5-1624"><a href="#cb5-1624"></a>    })<span class="op">;</span></span>
<span id="cb5-1625"><a href="#cb5-1625"></a>    nodeG<span class="op">.</span><span class="fu">get</span>(<span class="st">"updPanel"</span>)<span class="op">.</span><span class="fu">select</span>(<span class="st">"rect"</span>)</span>
<span id="cb5-1626"><a href="#cb5-1626"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(244,180,0,0.95)"</span>)</span>
<span id="cb5-1627"><a href="#cb5-1627"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb5-1628"><a href="#cb5-1628"></a></span>
<span id="cb5-1629"><a href="#cb5-1629"></a>    <span class="cf">if</span> (id <span class="op">!==</span> <span class="st">"updPanel"</span>){</span>
<span id="cb5-1630"><a href="#cb5-1630"></a>      nodeG<span class="op">.</span><span class="fu">get</span>(id)<span class="op">.</span><span class="fu">select</span>(<span class="st">"rect"</span>)</span>
<span id="cb5-1631"><a href="#cb5-1631"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(244,180,0,0.95)"</span>)</span>
<span id="cb5-1632"><a href="#cb5-1632"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb5-1633"><a href="#cb5-1633"></a>    }</span>
<span id="cb5-1634"><a href="#cb5-1634"></a>  }</span>
<span id="cb5-1635"><a href="#cb5-1635"></a></span>
<span id="cb5-1636"><a href="#cb5-1636"></a>  <span class="kw">const</span> lerp <span class="op">=</span> (a<span class="op">,</span>b<span class="op">,</span>t) <span class="kw">=&gt;</span> a <span class="op">+</span> (b<span class="op">-</span>a)<span class="op">*</span>t<span class="op">;</span></span>
<span id="cb5-1637"><a href="#cb5-1637"></a></span>
<span id="cb5-1638"><a href="#cb5-1638"></a>  <span class="kw">function</span> <span class="fu">tick</span>(tms){</span>
<span id="cb5-1639"><a href="#cb5-1639"></a>    <span class="kw">const</span> T <span class="op">=</span> <span class="dv">1200</span><span class="op">;</span></span>
<span id="cb5-1640"><a href="#cb5-1640"></a>    <span class="kw">const</span> k <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((tms <span class="op">/</span> T) <span class="op">%</span> steps<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb5-1641"><a href="#cb5-1641"></a>    <span class="kw">const</span> t <span class="op">=</span> (tms <span class="op">/</span> T) <span class="op">%</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-1642"><a href="#cb5-1642"></a></span>
<span id="cb5-1643"><a href="#cb5-1643"></a>    <span class="kw">const</span> a <span class="op">=</span> steps[k]<span class="op">;</span></span>
<span id="cb5-1644"><a href="#cb5-1644"></a>    <span class="kw">const</span> b <span class="op">=</span> steps[(k<span class="op">+</span><span class="dv">1</span>) <span class="op">%</span> steps<span class="op">.</span><span class="at">length</span>]<span class="op">;</span></span>
<span id="cb5-1645"><a href="#cb5-1645"></a></span>
<span id="cb5-1646"><a href="#cb5-1646"></a>    <span class="fu">setAccent</span>(a)<span class="op">;</span></span>
<span id="cb5-1647"><a href="#cb5-1647"></a></span>
<span id="cb5-1648"><a href="#cb5-1648"></a>    <span class="kw">const</span> A <span class="op">=</span> <span class="fu">center</span>(map<span class="op">.</span><span class="fu">get</span>(a))<span class="op">;</span></span>
<span id="cb5-1649"><a href="#cb5-1649"></a>    <span class="kw">const</span> B <span class="op">=</span> <span class="fu">center</span>(map<span class="op">.</span><span class="fu">get</span>(b))<span class="op">;</span></span>
<span id="cb5-1650"><a href="#cb5-1650"></a></span>
<span id="cb5-1651"><a href="#cb5-1651"></a>    packet</span>
<span id="cb5-1652"><a href="#cb5-1652"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="fu">lerp</span>(A[<span class="dv">0</span>]<span class="op">,</span> B[<span class="dv">0</span>]<span class="op">,</span> t))</span>
<span id="cb5-1653"><a href="#cb5-1653"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="fu">lerp</span>(A[<span class="dv">1</span>]<span class="op">,</span> B[<span class="dv">1</span>]<span class="op">,</span> t))<span class="op">;</span></span>
<span id="cb5-1654"><a href="#cb5-1654"></a></span>
<span id="cb5-1655"><a href="#cb5-1655"></a>    <span class="fu">requestAnimationFrame</span>(tick)<span class="op">;</span></span>
<span id="cb5-1656"><a href="#cb5-1656"></a>  }</span>
<span id="cb5-1657"><a href="#cb5-1657"></a>  <span class="fu">requestAnimationFrame</span>(tick)<span class="op">;</span></span>
<span id="cb5-1658"><a href="#cb5-1658"></a></span>
<span id="cb5-1659"><a href="#cb5-1659"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb5-1660"><a href="#cb5-1660"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="notation-and-setup-1" class="slide level2">
<h2>Notation and setup</h2>
<div class="columns">
<div class="column">
<h3 id="normalizing-flows">Normalizing Flows</h3>
<p>Learn an invertible transformation between a simple base distribution and a complex target distribution.</p>
<p><span class="math display">
z = f_\theta(x), \qquad x = f_\theta^{-1}(z)
</span></p>
<p>Uses the change-of-variables formula: <span class="math display">
p(x) = p(z)\left|\det \frac{\partial f_\theta(x)}{\partial x}\right|
</span></p>
<p>Model complex probability densities by warping a simple distribution.</p>
<p>It learns a single invertible mapping <span class="math inline">f_\theta</span> with fixed parameters.</p>
<p>Inference is not amortized by default. A new dataset typically requires retraining or re-optimization.</p>
</div><div class="column">
<h3 id="bayesian-flows-bayesflow">Bayesian Flows (BayesFlow)</h3>
<p>Learn an amortized inverse mapping from data to posterior distributions using simulations.</p>
<p><span class="math display">
x_{1:N} \;\longmapsto\; p(\theta \mid x_{1:N})
</span></p>
<ol type="1">
<li><p>Summary network <span class="math inline">\tilde{x} = h_\psi(x_{1:N})</span></p></li>
<li><p>Conditional invertible inference network <span class="math display">
\theta = f_\phi^{-1}(z; \tilde{x}), \qquad z \sim \mathcal{N}(0, I)
</span></p></li>
</ol>
<p>Minimize the KL divergence between the true and approximate posterior using simulated data.</p>
<p>It leanrs A reusable inference network and a summary network aligned with probabilistic symmetries</p>
<p>Inference is amortized. After training, posterior sampling is near-instant for new datasets.</p>
</div>
</div>
</section>
<section id="DevelopNormFlow" class="slide level2">
<h2>Recent Developments in Normalizing Flows</h2>
<p>Modern normalizing flows extend the basic idea of invertible density transformations to achieve <strong>scalability, expressiveness, and stability</strong> in high dimensions.</p>
<h3 id="discrete-time-flow-architectures">Discrete-Time Flow Architectures</h3>
<p>Most practical flows use <strong>layered, discrete transformations</strong>: <span class="math display">
z_K = f_K \circ f_{K-1} \circ \cdots \circ f_1(z_0),
\qquad z_0 \sim p_0(z)
</span></p>
<h3 id="coupling-based-flows">Coupling-based flows</h3>
<p>Split variables into two blocks: <span class="math display">
(x_A, x_B) \;\mapsto\; (y_A, y_B)
</span> with <span class="math display">
y_A = h(x_A; \Theta(x_B)), \qquad y_B = x_B.
</span></p>
<p><strong>Key property:</strong> - Triangular Jacobian - <span class="math inline">\log|\det J|</span> computed cheaply</p>
<p><strong>Examples:</strong> NICE, RealNVP, Glow</p>
</section>
<section id="overview-of-coupling-flows" class="slide level2">
<h2>Overview of Coupling flows</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="1760" data-source-offset="0"><pre class="sourceCode numberSource js number-lines code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1759;"><span id="cb6-1760"><a href="#cb6-1760"></a>nf_methods_timeline <span class="op">=</span> {</span>
<span id="cb6-1761"><a href="#cb6-1761"></a>  <span class="kw">const</span> W <span class="op">=</span> <span class="dv">1000</span><span class="op">,</span> H <span class="op">=</span> <span class="dv">440</span><span class="op">;</span></span>
<span id="cb6-1762"><a href="#cb6-1762"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb6-1763"><a href="#cb6-1763"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="vs">`0 0 </span><span class="sc">${</span>W<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>H<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb6-1764"><a href="#cb6-1764"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"width"</span><span class="op">,</span><span class="st">"100%"</span>)</span>
<span id="cb6-1765"><a href="#cb6-1765"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span><span class="st">"980px"</span>)</span>
<span id="cb6-1766"><a href="#cb6-1766"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"height"</span><span class="op">,</span><span class="st">"440px"</span>)<span class="op">;</span></span>
<span id="cb6-1767"><a href="#cb6-1767"></a></span>
<span id="cb6-1768"><a href="#cb6-1768"></a>  <span class="co">// ---------- defs ----------</span></span>
<span id="cb6-1769"><a href="#cb6-1769"></a>  <span class="kw">const</span> defs <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"defs"</span>)<span class="op">;</span></span>
<span id="cb6-1770"><a href="#cb6-1770"></a></span>
<span id="cb6-1771"><a href="#cb6-1771"></a>  defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"marker"</span>)</span>
<span id="cb6-1772"><a href="#cb6-1772"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span><span class="st">"arrow"</span>)</span>
<span id="cb6-1773"><a href="#cb6-1773"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span><span class="st">"0 0 10 10"</span>)</span>
<span id="cb6-1774"><a href="#cb6-1774"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"refX"</span><span class="op">,</span> <span class="dv">9</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"refY"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb6-1775"><a href="#cb6-1775"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerWidth"</span><span class="op">,</span> <span class="dv">8</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"markerHeight"</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb6-1776"><a href="#cb6-1776"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"orient"</span><span class="op">,</span><span class="st">"auto"</span>)</span>
<span id="cb6-1777"><a href="#cb6-1777"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb6-1778"><a href="#cb6-1778"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="st">"M 0 0 L 10 5 L 0 10 z"</span>)</span>
<span id="cb6-1779"><a href="#cb6-1779"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.55)"</span>)<span class="op">;</span></span>
<span id="cb6-1780"><a href="#cb6-1780"></a></span>
<span id="cb6-1781"><a href="#cb6-1781"></a>  defs<span class="op">.</span><span class="fu">append</span>(<span class="st">"filter"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span><span class="st">"glow"</span>)</span>
<span id="cb6-1782"><a href="#cb6-1782"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"feDropShadow"</span>)</span>
<span id="cb6-1783"><a href="#cb6-1783"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dx"</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb6-1784"><a href="#cb6-1784"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stdDeviation"</span><span class="op">,</span> <span class="fl">2.2</span>)</span>
<span id="cb6-1785"><a href="#cb6-1785"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"flood-opacity"</span><span class="op">,</span> <span class="fl">0.30</span>)<span class="op">;</span></span>
<span id="cb6-1786"><a href="#cb6-1786"></a></span>
<span id="cb6-1787"><a href="#cb6-1787"></a>  <span class="co">// ---------- frame ----------</span></span>
<span id="cb6-1788"><a href="#cb6-1788"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb6-1789"><a href="#cb6-1789"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">18</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">26</span>)</span>
<span id="cb6-1790"><a href="#cb6-1790"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> W<span class="op">-</span><span class="dv">36</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> H<span class="op">-</span><span class="dv">52</span>)</span>
<span id="cb6-1791"><a href="#cb6-1791"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">10</span>)</span>
<span id="cb6-1792"><a href="#cb6-1792"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"white"</span>)</span>
<span id="cb6-1793"><a href="#cb6-1793"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.25)"</span>)<span class="op">;</span></span>
<span id="cb6-1794"><a href="#cb6-1794"></a></span>
<span id="cb6-1795"><a href="#cb6-1795"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb6-1796"><a href="#cb6-1796"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">22</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">18</span>)</span>
<span id="cb6-1797"><a href="#cb6-1797"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb6-1798"><a href="#cb6-1798"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.8</span>)</span>
<span id="cb6-1799"><a href="#cb6-1799"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"IEEE TRANSACTIONS ON PATTERN ANALYSIS AND MACHINE INTELLIGENCE"</span>)<span class="op">;</span></span>
<span id="cb6-1800"><a href="#cb6-1800"></a></span>
<span id="cb6-1801"><a href="#cb6-1801"></a>  <span class="co">// ---------- left-side taxonomy ----------</span></span>
<span id="cb6-1802"><a href="#cb6-1802"></a>  <span class="kw">const</span> items <span class="op">=</span> [</span>
<span id="cb6-1803"><a href="#cb6-1803"></a>    {<span class="dt">sec</span><span class="op">:</span><span class="st">"§3.1"</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Elementwise bijections"</span><span class="op">,</span> <span class="dt">sub</span><span class="op">:</span><span class="st">"Non-linear elementwise transform"</span><span class="op">,</span></span>
<span id="cb6-1804"><a href="#cb6-1804"></a>     <span class="dt">prob</span><span class="op">:</span><span class="st">"Problem: no mixing of variables"</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span><span class="st">"#b00020"</span>}<span class="op">,</span></span>
<span id="cb6-1805"><a href="#cb6-1805"></a>    {<span class="dt">sec</span><span class="op">:</span><span class="st">"§3.2"</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Linear flows"</span><span class="op">,</span> <span class="dt">sub</span><span class="op">:</span><span class="st">"Affine combination of variables"</span><span class="op">,</span></span>
<span id="cb6-1806"><a href="#cb6-1806"></a>     <span class="dt">prob</span><span class="op">:</span><span class="st">"Problem: limited representational power"</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span><span class="st">"#b00020"</span>}<span class="op">,</span></span>
<span id="cb6-1807"><a href="#cb6-1807"></a>    {<span class="dt">sec</span><span class="op">:</span><span class="st">"§3.3"</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Planar and radial flows"</span><span class="op">,</span> <span class="dt">sub</span><span class="op">:</span><span class="st">"Non-linear transforms"</span><span class="op">,</span></span>
<span id="cb6-1808"><a href="#cb6-1808"></a>     <span class="dt">prob</span><span class="op">:</span><span class="st">"Problem: hard to compute inverse"</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span><span class="st">"#b00020"</span>}<span class="op">,</span></span>
<span id="cb6-1809"><a href="#cb6-1809"></a>    {<span class="dt">sec</span><span class="op">:</span><span class="st">"§3.4.1"</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Coupling flows"</span><span class="op">,</span></span>
<span id="cb6-1810"><a href="#cb6-1810"></a>     <span class="dt">sub</span><span class="op">:</span><span class="st">"Architectures that allow invertible non-linear transformations"</span><span class="op">,</span></span>
<span id="cb6-1811"><a href="#cb6-1811"></a>     <span class="dt">prob</span><span class="op">:</span><span class="st">"Depend on coupling"</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span><span class="st">"#1b7f3a"</span>}<span class="op">,</span></span>
<span id="cb6-1812"><a href="#cb6-1812"></a>    {<span class="dt">sec</span><span class="op">:</span><span class="st">"§3.4.2"</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Autoregressive flows"</span><span class="op">,</span></span>
<span id="cb6-1813"><a href="#cb6-1813"></a>     <span class="dt">sub</span><span class="op">:</span><span class="st">"Architectures that allow invertible non-linear transformations"</span><span class="op">,</span></span>
<span id="cb6-1814"><a href="#cb6-1814"></a>     <span class="dt">prob</span><span class="op">:</span><span class="st">"Depend on coupling"</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span><span class="st">"#1b7f3a"</span>}<span class="op">,</span></span>
<span id="cb6-1815"><a href="#cb6-1815"></a>    {<span class="dt">sec</span><span class="op">:</span><span class="st">"§3.5"</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Residual flows"</span><span class="op">,</span> <span class="dt">sub</span><span class="op">:</span><span class="st">"Invertible residual networks"</span><span class="op">,</span></span>
<span id="cb6-1816"><a href="#cb6-1816"></a>     <span class="dt">prob</span><span class="op">:</span><span class="st">""</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span><span class="st">"#1b7f3a"</span>}<span class="op">,</span></span>
<span id="cb6-1817"><a href="#cb6-1817"></a>    {<span class="dt">sec</span><span class="op">:</span><span class="st">"§3.6"</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span><span class="st">"Infinitesimal flows"</span><span class="op">,</span></span>
<span id="cb6-1818"><a href="#cb6-1818"></a>     <span class="dt">sub</span><span class="op">:</span><span class="st">"Continuous flows depending on ODEs or SDEs"</span><span class="op">,</span></span>
<span id="cb6-1819"><a href="#cb6-1819"></a>     <span class="dt">prob</span><span class="op">:</span><span class="st">""</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span><span class="st">"#1b7f3a"</span>}</span>
<span id="cb6-1820"><a href="#cb6-1820"></a>  ]<span class="op">;</span></span>
<span id="cb6-1821"><a href="#cb6-1821"></a></span>
<span id="cb6-1822"><a href="#cb6-1822"></a>  <span class="kw">const</span> leftX <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb6-1823"><a href="#cb6-1823"></a>  <span class="kw">const</span> startY <span class="op">=</span> <span class="dv">70</span><span class="op">;</span></span>
<span id="cb6-1824"><a href="#cb6-1824"></a>  <span class="kw">const</span> rowH <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb6-1825"><a href="#cb6-1825"></a></span>
<span id="cb6-1826"><a href="#cb6-1826"></a>  <span class="kw">const</span> rows <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb6-1827"><a href="#cb6-1827"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"g.row"</span>)</span>
<span id="cb6-1828"><a href="#cb6-1828"></a>    <span class="op">.</span><span class="fu">data</span>(items)</span>
<span id="cb6-1829"><a href="#cb6-1829"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"g"</span>)</span>
<span id="cb6-1830"><a href="#cb6-1830"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span><span class="vs">`translate(</span><span class="sc">${</span>leftX<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>startY<span class="op">+</span>i<span class="op">*</span>rowH<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb6-1831"><a href="#cb6-1831"></a></span>
<span id="cb6-1832"><a href="#cb6-1832"></a>  rows<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb6-1833"><a href="#cb6-1833"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,-</span><span class="dv">12</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,-</span><span class="dv">18</span>)</span>
<span id="cb6-1834"><a href="#cb6-1834"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span><span class="dv">460</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span><span class="dv">42</span>)</span>
<span id="cb6-1835"><a href="#cb6-1835"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span><span class="dv">10</span>)</span>
<span id="cb6-1836"><a href="#cb6-1836"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"rgba(244,180,0,0.08)"</span>)</span>
<span id="cb6-1837"><a href="#cb6-1837"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(244,180,0,0.85)"</span>)</span>
<span id="cb6-1838"><a href="#cb6-1838"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">2.5</span>)</span>
<span id="cb6-1839"><a href="#cb6-1839"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">0</span>)</span>
<span id="cb6-1840"><a href="#cb6-1840"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"filter"</span><span class="op">,</span><span class="st">"url(#glow)"</span>)<span class="op">;</span></span>
<span id="cb6-1841"><a href="#cb6-1841"></a></span>
<span id="cb6-1842"><a href="#cb6-1842"></a>  rows<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb6-1843"><a href="#cb6-1843"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,-</span><span class="dv">2</span>)</span>
<span id="cb6-1844"><a href="#cb6-1844"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">16</span>)</span>
<span id="cb6-1845"><a href="#cb6-1845"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">700</span>)</span>
<span id="cb6-1846"><a href="#cb6-1846"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span><span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">sec</span><span class="sc">}</span><span class="vs">  </span><span class="sc">${</span>d<span class="op">.</span><span class="at">title</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb6-1847"><a href="#cb6-1847"></a></span>
<span id="cb6-1848"><a href="#cb6-1848"></a>  rows<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb6-1849"><a href="#cb6-1849"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">20</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span><span class="dv">16</span>)</span>
<span id="cb6-1850"><a href="#cb6-1850"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="fl">12.5</span>)</span>
<span id="cb6-1851"><a href="#cb6-1851"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"#1b7f3a"</span>)</span>
<span id="cb6-1852"><a href="#cb6-1852"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d<span class="op">.</span><span class="at">sub</span>)<span class="op">;</span></span>
<span id="cb6-1853"><a href="#cb6-1853"></a></span>
<span id="cb6-1854"><a href="#cb6-1854"></a>  rows<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb6-1855"><a href="#cb6-1855"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span><span class="dv">330</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span><span class="dv">380</span>)</span>
<span id="cb6-1856"><a href="#cb6-1856"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,-</span><span class="dv">6</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,-</span><span class="dv">6</span>)</span>
<span id="cb6-1857"><a href="#cb6-1857"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.5)"</span>)</span>
<span id="cb6-1858"><a href="#cb6-1858"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.8</span>)<span class="op">;</span></span>
<span id="cb6-1859"><a href="#cb6-1859"></a></span>
<span id="cb6-1860"><a href="#cb6-1860"></a>  rows<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb6-1861"><a href="#cb6-1861"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="st">"M380,-6 L450,-6"</span>)</span>
<span id="cb6-1862"><a href="#cb6-1862"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.5)"</span>)</span>
<span id="cb6-1863"><a href="#cb6-1863"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.8</span>)</span>
<span id="cb6-1864"><a href="#cb6-1864"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span><span class="st">"url(#arrow)"</span>)<span class="op">;</span></span>
<span id="cb6-1865"><a href="#cb6-1865"></a></span>
<span id="cb6-1866"><a href="#cb6-1866"></a>  rows<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb6-1867"><a href="#cb6-1867"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span><span class="dv">462</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,-</span><span class="dv">2</span>)</span>
<span id="cb6-1868"><a href="#cb6-1868"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="fl">12.5</span>)</span>
<span id="cb6-1869"><a href="#cb6-1869"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">650</span>)</span>
<span id="cb6-1870"><a href="#cb6-1870"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span>d<span class="kw">=&gt;</span>d<span class="op">.</span><span class="at">color</span>)</span>
<span id="cb6-1871"><a href="#cb6-1871"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d<span class="op">.</span><span class="at">prob</span>)<span class="op">;</span></span>
<span id="cb6-1872"><a href="#cb6-1872"></a></span>
<span id="cb6-1873"><a href="#cb6-1873"></a>  <span class="co">// ---------- coupling-functions box (MOVED DOWN) ----------</span></span>
<span id="cb6-1874"><a href="#cb6-1874"></a>  <span class="kw">const</span> cf <span class="op">=</span> {</span>
<span id="cb6-1875"><a href="#cb6-1875"></a>    <span class="dt">x</span><span class="op">:</span> <span class="dv">640</span><span class="op">,</span></span>
<span id="cb6-1876"><a href="#cb6-1876"></a>    <span class="dt">y</span><span class="op">:</span> <span class="dv">210</span><span class="op">,</span>          <span class="co">// &lt;&lt; MOVED DOWN</span></span>
<span id="cb6-1877"><a href="#cb6-1877"></a>    <span class="dt">w</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb6-1878"><a href="#cb6-1878"></a>    <span class="dt">h</span><span class="op">:</span> <span class="dv">210</span><span class="op">,</span></span>
<span id="cb6-1879"><a href="#cb6-1879"></a>    <span class="dt">bullets</span><span class="op">:</span> [</span>
<span id="cb6-1880"><a href="#cb6-1880"></a>      <span class="st">"Affine"</span><span class="op">,</span></span>
<span id="cb6-1881"><a href="#cb6-1881"></a>      <span class="st">"Non-linear squared"</span><span class="op">,</span></span>
<span id="cb6-1882"><a href="#cb6-1882"></a>      <span class="st">"Continuous mixture CDFs"</span><span class="op">,</span></span>
<span id="cb6-1883"><a href="#cb6-1883"></a>      <span class="st">"Splines"</span><span class="op">,</span></span>
<span id="cb6-1884"><a href="#cb6-1884"></a>      <span class="st">"Neural autoregressive"</span><span class="op">,</span></span>
<span id="cb6-1885"><a href="#cb6-1885"></a>      <span class="st">"Sum-of-squares polynomial"</span><span class="op">,</span></span>
<span id="cb6-1886"><a href="#cb6-1886"></a>      <span class="st">"Piecewise-bijective"</span></span>
<span id="cb6-1887"><a href="#cb6-1887"></a>    ]</span>
<span id="cb6-1888"><a href="#cb6-1888"></a>  }<span class="op">;</span></span>
<span id="cb6-1889"><a href="#cb6-1889"></a></span>
<span id="cb6-1890"><a href="#cb6-1890"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb6-1891"><a href="#cb6-1891"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>cf<span class="op">.</span><span class="at">x</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>cf<span class="op">.</span><span class="at">y</span>)</span>
<span id="cb6-1892"><a href="#cb6-1892"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span>cf<span class="op">.</span><span class="at">w</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span>cf<span class="op">.</span><span class="at">h</span>)</span>
<span id="cb6-1893"><a href="#cb6-1893"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span><span class="dv">10</span>)</span>
<span id="cb6-1894"><a href="#cb6-1894"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"white"</span>)</span>
<span id="cb6-1895"><a href="#cb6-1895"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.45)"</span>)</span>
<span id="cb6-1896"><a href="#cb6-1896"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="fl">1.6</span>)<span class="op">;</span></span>
<span id="cb6-1897"><a href="#cb6-1897"></a></span>
<span id="cb6-1898"><a href="#cb6-1898"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb6-1899"><a href="#cb6-1899"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>cf<span class="op">.</span><span class="at">x</span><span class="op">+</span><span class="dv">14</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>cf<span class="op">.</span><span class="at">y</span><span class="op">+</span><span class="dv">26</span>)</span>
<span id="cb6-1900"><a href="#cb6-1900"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">15</span>)</span>
<span id="cb6-1901"><a href="#cb6-1901"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span><span class="dv">750</span>)</span>
<span id="cb6-1902"><a href="#cb6-1902"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"§3.4.4  Coupling functions"</span>)<span class="op">;</span></span>
<span id="cb6-1903"><a href="#cb6-1903"></a></span>
<span id="cb6-1904"><a href="#cb6-1904"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"text.cf"</span>)</span>
<span id="cb6-1905"><a href="#cb6-1905"></a>    <span class="op">.</span><span class="fu">data</span>(cf<span class="op">.</span><span class="at">bullets</span>)</span>
<span id="cb6-1906"><a href="#cb6-1906"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"text"</span>)</span>
<span id="cb6-1907"><a href="#cb6-1907"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span>cf<span class="op">.</span><span class="at">x</span><span class="op">+</span><span class="dv">18</span>)</span>
<span id="cb6-1908"><a href="#cb6-1908"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span>(d<span class="op">,</span>i)<span class="kw">=&gt;</span>cf<span class="op">.</span><span class="at">y</span><span class="op">+</span><span class="dv">54</span><span class="op">+</span>i<span class="op">*</span><span class="dv">22</span>)</span>
<span id="cb6-1909"><a href="#cb6-1909"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span><span class="dv">13</span>)</span>
<span id="cb6-1910"><a href="#cb6-1910"></a>      <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span><span class="st">"• "</span><span class="op">+</span>d)<span class="op">;</span></span>
<span id="cb6-1911"><a href="#cb6-1911"></a></span>
<span id="cb6-1912"><a href="#cb6-1912"></a>  <span class="co">// ---------- connectors ----------</span></span>
<span id="cb6-1913"><a href="#cb6-1913"></a>  <span class="kw">function</span> <span class="fu">connector</span>(y0){</span>
<span id="cb6-1914"><a href="#cb6-1914"></a>    <span class="kw">const</span> x1 <span class="op">=</span> leftX <span class="op">+</span> <span class="dv">380</span><span class="op">;</span></span>
<span id="cb6-1915"><a href="#cb6-1915"></a>    <span class="kw">const</span> x2 <span class="op">=</span> cf<span class="op">.</span><span class="at">x</span> <span class="op">-</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb6-1916"><a href="#cb6-1916"></a>    <span class="kw">const</span> y2 <span class="op">=</span> cf<span class="op">.</span><span class="at">y</span> <span class="op">+</span> <span class="dv">22</span><span class="op">;</span></span>
<span id="cb6-1917"><a href="#cb6-1917"></a>    <span class="kw">const</span> mx <span class="op">=</span> (x1<span class="op">+</span>x2)<span class="op">/</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">40</span><span class="op">;</span></span>
<span id="cb6-1918"><a href="#cb6-1918"></a>    <span class="cf">return</span> <span class="vs">`M</span><span class="sc">${</span>x1<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y0<span class="sc">}</span><span class="vs"> C</span><span class="sc">${</span>mx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y0<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>mx<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y2<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>x2<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>y2<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb6-1919"><a href="#cb6-1919"></a>  }</span>
<span id="cb6-1920"><a href="#cb6-1920"></a></span>
<span id="cb6-1921"><a href="#cb6-1921"></a>  <span class="kw">const</span> conn <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb6-1922"><a href="#cb6-1922"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span><span class="st">"none"</span>)</span>
<span id="cb6-1923"><a href="#cb6-1923"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span><span class="st">"rgba(0,0,0,0.35)"</span>)</span>
<span id="cb6-1924"><a href="#cb6-1924"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span><span class="dv">2</span>)</span>
<span id="cb6-1925"><a href="#cb6-1925"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"marker-end"</span><span class="op">,</span><span class="st">"url(#arrow)"</span>)<span class="op">;</span></span>
<span id="cb6-1926"><a href="#cb6-1926"></a></span>
<span id="cb6-1927"><a href="#cb6-1927"></a>  <span class="co">// ---------- animation ----------</span></span>
<span id="cb6-1928"><a href="#cb6-1928"></a>  <span class="kw">let</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-1929"><a href="#cb6-1929"></a>  <span class="kw">const</span> T <span class="op">=</span> <span class="dv">1700</span><span class="op">;</span></span>
<span id="cb6-1930"><a href="#cb6-1930"></a></span>
<span id="cb6-1931"><a href="#cb6-1931"></a>  <span class="kw">function</span> <span class="fu">focus</span>(i){</span>
<span id="cb6-1932"><a href="#cb6-1932"></a>    rows<span class="op">.</span><span class="fu">select</span>(<span class="st">"rect"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb6-1933"><a href="#cb6-1933"></a>    rows<span class="op">.</span><span class="fu">filter</span>((d<span class="op">,</span>idx)<span class="kw">=&gt;</span>idx<span class="op">===</span>i)</span>
<span id="cb6-1934"><a href="#cb6-1934"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"rect"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb6-1935"><a href="#cb6-1935"></a></span>
<span id="cb6-1936"><a href="#cb6-1936"></a>    <span class="cf">if</span> (i<span class="op">===</span><span class="dv">3</span> <span class="op">||</span> i<span class="op">===</span><span class="dv">4</span>){</span>
<span id="cb6-1937"><a href="#cb6-1937"></a>      <span class="kw">const</span> y0 <span class="op">=</span> startY <span class="op">+</span> i<span class="op">*</span>rowH <span class="op">-</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb6-1938"><a href="#cb6-1938"></a>      conn<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span><span class="fu">connector</span>(y0))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb6-1939"><a href="#cb6-1939"></a>    } <span class="cf">else</span> {</span>
<span id="cb6-1940"><a href="#cb6-1940"></a>      conn<span class="op">.</span><span class="fu">attr</span>(<span class="st">"opacity"</span><span class="op">,</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb6-1941"><a href="#cb6-1941"></a>    }</span>
<span id="cb6-1942"><a href="#cb6-1942"></a>  }</span>
<span id="cb6-1943"><a href="#cb6-1943"></a></span>
<span id="cb6-1944"><a href="#cb6-1944"></a>  <span class="kw">function</span> <span class="fu">loop</span>(){</span>
<span id="cb6-1945"><a href="#cb6-1945"></a>    <span class="fu">focus</span>(k)<span class="op">;</span></span>
<span id="cb6-1946"><a href="#cb6-1946"></a>    k <span class="op">=</span> (k<span class="op">+</span><span class="dv">1</span>)<span class="op">%</span>items<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb6-1947"><a href="#cb6-1947"></a>    d3<span class="op">.</span><span class="fu">timeout</span>(loop<span class="op">,</span>T)<span class="op">;</span></span>
<span id="cb6-1948"><a href="#cb6-1948"></a>  }</span>
<span id="cb6-1949"><a href="#cb6-1949"></a></span>
<span id="cb6-1950"><a href="#cb6-1950"></a>  <span class="fu">focus</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb6-1951"><a href="#cb6-1951"></a>  d3<span class="op">.</span><span class="fu">timeout</span>(loop<span class="op">,</span>T)<span class="op">;</span></span>
<span id="cb6-1952"><a href="#cb6-1952"></a></span>
<span id="cb6-1953"><a href="#cb6-1953"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb6-1954"><a href="#cb6-1954"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="autoregressive-and-spline-flows" class="slide level2">
<h2>Autoregressive and Spline Flows</h2>
<h3 id="autoregressive-flows">Autoregressive flows</h3>
<p>Each dimension depends on previous ones: <span class="math display">
y_t = h\big(x_t;\,\Theta_t(x_{1:t-1})\big)
</span></p>
<ul>
<li><strong>MAF</strong>: fast density evaluation<br>
</li>
<li><strong>IAF</strong>: fast sampling</li>
</ul>
<p><br> <br><br></p>
<h3 id="neural-spline-flows">Neural spline flows</h3>
<p>Replace affine maps with <strong>monotone splines</strong>: - Rational quadratic splines - Piecewise polynomial transforms</p>
<p><strong>Key insight:</strong> &gt; Nonlinear monotone transformations dramatically increase expressiveness without sacrificing invertibility.</p>
</section>
<section id="continuous-time-normalizing-flows" class="slide level2">
<h2>Continuous-Time Normalizing Flows</h2>
<p>Flows can be defined as <strong>continuous dynamics</strong>: <span class="math display">
\frac{dx(t)}{dt} = F(x(t), t)
</span></p>
<p>Density evolves via: <span class="math display">
\frac{d}{dt} \log p(x(t))
=
-\mathrm{Tr}\!\left(\frac{\partial F}{\partial x}\right)
</span></p>
<p><strong>Representative methods:</strong> - Neural ODE flows - FFJORD (stochastic trace estimator)</p>
<p><strong>Advantages:</strong> - No explicit Jacobian determinant - Parameter-efficient - Smooth transformations</p>
</section>
<section id="SummNormFlow" class="slide level2">
<h2>Summary of Normalizing Flow Families (I)</h2>
<table>
<colgroup>
<col style="width: 18%">
<col style="width: 30%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Flow family</th>
<th>Core transformation</th>
<th>Key idea</th>
<th>Strengths</th>
<th>Limitations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Elementwise bijections</td>
<td><span class="math display">z_i = f_i(x_i)</span></td>
<td>Independent nonlinear transforms</td>
<td>Simple, cheap Jacobian</td>
<td>No variable mixing</td>
</tr>
<tr class="even">
<td>Linear flows</td>
<td><span class="math display">z = Ax + b</span></td>
<td>Global affine transform</td>
<td>Mixes variables, exact inverse</td>
<td>Limited expressiveness</td>
</tr>
<tr class="odd">
<td>Planar flows</td>
<td><span class="math display">z = x + u\,h(w^\top x + b)</span></td>
<td>Rank-1 nonlinear deformation</td>
<td>Flexible, fast Jacobian</td>
<td>Inverse often intractable</td>
</tr>
<tr class="even">
<td>Radial flows</td>
<td><span class="math display">z = x + \beta\,h(\alpha, r)(x - x_0)</span></td>
<td>Radial contraction/expansion</td>
<td>Can induce multimodality</td>
<td>Hard inverse</td>
</tr>
<tr class="odd">
<td>Coupling flows</td>
<td><span class="math display">z_{1:d}=x_{1:d}</span> <span class="math display">z_{d+1:D}=x_{d+1:D}\odot e^{s(x_{1:d})}+t(x_{1:d})</span></td>
<td>Split variables, conditional transforms</td>
<td>Exact inverse, scalable</td>
<td>Needs good coupling design</td>
</tr>
</tbody>
</table>
</section>
<section id="summary-of-normalizing-flow-families-ii" class="slide level2">
<h2>Summary of Normalizing Flow Families (II)</h2>
<p><br><br></p>
<table>
<colgroup>
<col style="width: 18%">
<col style="width: 30%">
<col style="width: 15%">
<col style="width: 16%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Flow family</th>
<th>Core transformation</th>
<th>Key idea</th>
<th>Strengths</th>
<th>Limitations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Autoregressive flows</td>
<td><span class="math display">z_i = f_i(x_i; x_{&lt;i})</span></td>
<td>Sequential conditional transforms</td>
<td>Highly expressive</td>
<td>Slow sampling or likelihood</td>
</tr>
<tr class="even">
<td>Residual flows</td>
<td><span class="math display">z = x + f(x)</span></td>
<td>Invertible residual networks</td>
<td>Deep &amp; flexible</td>
<td>Requires Lipschitz control</td>
</tr>
<tr class="odd">
<td>Continuous (Neural ODE) flows</td>
<td><span class="math display">\frac{dz(t)}{dt} = f(z(t), t)</span></td>
<td>Continuous-time transformation</td>
<td>Memory efficient, smooth</td>
<td>Expensive ODE solves</td>
</tr>
</tbody>
</table>
</section>
<section id="FutureDir" class="slide level2">
<h2>Future Directions of Normalizing Flows</h2>
<p><strong>Next-Generation Generative Modeling &amp; Inference</strong></p>
<ul>
<li><strong>Continuous-Time Flows:</strong> Moving beyond discrete layers to Neural ODEs for more flexible, invertible transformations.</li>
<li><strong>Geometric &amp; Graph Flows:</strong> Adapting flows to non-Euclidean data (graphs, manifolds) for structural biology and chemistry.</li>
<li><strong>Efficiency &amp; Scalability:</strong> Reducing computational overhead for high-dimensional data (e.g., high-res images, 3D modeling).</li>
<li><strong>Hybrid Architectures:</strong> Combining flows with diffusion models or VAEs to leverage exact likelihoods and high-fidelity generation.</li>
<li><strong>Beyond Gaussian Base:</strong> Exploring more expressive, non-Gaussian, or learnable base distributions.</li>
</ul>
<p><br></p>
<h3 id="key-research-areas">Key Research Areas</h3>
<ol type="1">
<li>Riemannian Manifold Flows</li>
<li>Adaptive Step Size ODEs</li>
<li>Implicit Regularization Techniques</li>
</ol>
</section>
<section id="section" class="slide level2" data-background-image="assets/tigerstripes.png" data-background-size="cover" data-background-position="center">
<h2></h2>
<div class="thankyou-slide">
<div class="thankyou-content">
<p>Thank you for your attention!</p>
</div>
</div>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="NormalisingFlows_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="NormalisingFlows_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="NormalisingFlows_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="NormalisingFlows_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="NormalisingFlows_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="NormalisingFlows_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="NormalisingFlows_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="NormalisingFlows_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="NormalisingFlows_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="NormalisingFlows_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 5.0e-2,

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script type="ojs-module-contents">
    {"contents":[{"methodName":"interpret","cellName":"ojs-cell-1","inline":false,"source":"\n\nflow_strip_anim = {\n  const W = 920, H = 170, pad = 10;\n  const panels = 4, panelW = W / panels;\n\n  // sample base points\n  const n = 320;\n  const pts0 = d3.range(n).map(() => {\n    const u1 = Math.random(), u2 = Math.random();\n    const r = Math.sqrt(-2*Math.log(u1));\n    const a = 2*Math.PI*u2;\n    return [r*Math.cos(a), r*Math.sin(a)];\n  });\n\n  // STRONGER, visually distinct warps\n  const f1 = ([x,y]) => [x + 1.2*Math.tanh(1.2*y), y];                   // big shear\n  const f2 = ([x,y]) => {\n    const th = 0.55*Math.tanh(0.9*x);                                    // local rotation\n    const c = Math.cos(th), s = Math.sin(th);\n    return [c*x - s*y, s*x + c*y];\n  };\n  const f3 = ([x,y]) => {\n    const r = Math.sqrt(x*x + y*y) + 1e-6;\n    const k = 0.9*Math.tanh(1.0*(r-1.1));                                // twist/radial\n    return [x + k*(-y), y + k*(x)];\n  };\n\n  const steps = [\n    {name: \"z₀\", pts: pts0},\n    {name: \"z₁\", pts: pts0.map(f1)},\n    {name: \"z₂\", pts: pts0.map(f1).map(f2)},\n    {name: \"z₃\", pts: pts0.map(f1).map(f2).map(f3)}\n  ];\n\n  const xS = d3.scaleLinear().domain([-4,4]).range([pad, panelW-pad]);\n  const yS = d3.scaleLinear().domain([-4,4]).range([H-pad, pad]);\n\n  const svg = d3.create(\"svg\")\n    .attr(\"viewBox\", `0 0 ${W} ${H}`)\n    .style(\"width\",\"100%\")\n    .style(\"max-width\",\"920px\")\n    .style(\"height\",\"170px\")\n    .style(\"border\",\"1px solid rgba(255,255,255,0.18)\")\n    .style(\"border-radius\",\"10px\");\n\n  // panel frames + labels\n  steps.forEach((s, i) => {\n    const g = svg.append(\"g\").attr(\"transform\", `translate(${i*panelW},0)`);\n\n    g.append(\"rect\")\n      .attr(\"x\", 2).attr(\"y\", 2)\n      .attr(\"width\", panelW-4).attr(\"height\", H-4)\n      .attr(\"rx\", 10)\n      .attr(\"fill\", \"transparent\")\n      .attr(\"stroke\", \"rgba(255,255,255,0.12)\");\n\n    g.append(\"text\")\n      .attr(\"x\", 10).attr(\"y\", 18)\n      .attr(\"font-size\", 14)\n      .attr(\"font-weight\", 650)\n      .text(s.name);\n\n    if (i < panels-1) {\n      svg.append(\"text\")\n        .attr(\"x\", (i+1)*panelW - 10)\n        .attr(\"y\", H/2 + 6)\n        .attr(\"font-size\", 22)\n        .attr(\"opacity\", 0.55)\n        .text(\"→\");\n    }\n  });\n\n  // draw dots in each panel (same indices, so we can interpolate)\n  const dotGroups = steps.map((s, i) => {\n    return svg.append(\"g\")\n      .attr(\"transform\", `translate(${i*panelW},0)`)\n      .selectAll(\"circle\")\n      .data(pts0.map((p, idx) => ({idx, p0: p})))\n      .join(\"circle\")\n        .attr(\"r\", 1.35)\n        .attr(\"opacity\", 0.75);\n  });\n\n  // helper: interpolate between step a and b\n  function lerp(a,b,t){ return a + (b-a)*t; }\n\n  function render(tms){\n    // stage cycles: (0→1) for z0->z1, then z1->z2, then z2->z3\n    const cycle = (tms/1200) % 3;             // 0..3\n    const k = Math.floor(cycle);              // 0,1,2\n    const t = cycle - k;                      // 0..1\n\n    for (let i=0; i<steps.length; i++){\n      // Each panel shows its \"target\" step, but animates the transition for the current stage\n      let from = i, to = i;\n\n      if (k === 0 && i === 1) { from = 0; to = 1; }   // animate z1\n      if (k === 1 && i === 2) { from = 1; to = 2; }   // animate z2\n      if (k === 2 && i === 3) { from = 2; to = 3; }   // animate z3\n\n      const A = steps[from].pts;\n      const B = steps[to].pts;\n\n      dotGroups[i]\n        .attr(\"cx\", d => {\n          const a = A[d.idx], b = B[d.idx];\n          return xS(lerp(a[0], b[0], t));\n        })\n        .attr(\"cy\", d => {\n          const a = A[d.idx], b = B[d.idx];\n          return yS(lerp(a[1], b[1], t));\n        });\n    }\n\n    requestAnimationFrame(render);\n  }\n\n  requestAnimationFrame(render);\n  return svg.node();\n}\n"},{"methodName":"interpret","cellName":"ojs-cell-2","inline":false,"source":"flow_path_anim = {\n  const W = 920, H = 230, pad = 16;\n  const K = 5;                 // show z0..z5\n  const panelW = (W - 2*pad) / (K+1);\n\n  // sample base points (standard normal)\n  const n = 260;\n  const pts0 = d3.range(n).map(() => {\n    const u1 = Math.random(), u2 = Math.random();\n    const r = Math.sqrt(-2*Math.log(u1));\n    const a = 2*Math.PI*u2;\n    return [r*Math.cos(a), r*Math.sin(a)];\n  });\n\n  // simple \"flow-like\" warps (deterministic, invertible-looking)\n  const f1 = ([x,y]) => [x + 0.95*Math.tanh(1.1*y), y];                     // shear\n  const f2 = ([x,y]) => {\n    const th = 0.55*Math.tanh(0.8*x);                                      // local rotation\n    const c = Math.cos(th), s = Math.sin(th);\n    return [c*x - s*y, s*x + c*y];\n  };\n  const f3 = ([x,y]) => {\n    const r = Math.sqrt(x*x + y*y) + 1e-6;\n    const k = 0.75*Math.tanh(0.9*(r-1.1));                                 // radial twist\n    return [x + k*(-y), y + k*(x)];\n  };\n\n  const Fs = [p => p, f1, p => f2(f1(p)), p => f3(f2(f1(p))), p => f1(f3(f2(f1(p)))), p => f2(f1(f3(f2(f1(p)))))];\n\n  // precompute pts at each k (z_k)\n  const steps = d3.range(K+1).map(k => pts0.map(Fs[k]));\n\n  const xS = d3.scaleLinear().domain([-4,4]).range([pad, panelW - pad]);\n  const yS = d3.scaleLinear().domain([-4,4]).range([H - pad, pad]);\n\n  const svg = d3.create(\"svg\")\n    .attr(\"viewBox\", `0 0 ${W} ${H}`)\n    .style(\"width\",\"100%\")\n    .style(\"max-width\",\"920px\")\n    .style(\"height\",\"230px\")\n    .style(\"border\",\"1px solid rgba(255,255,255,0.18)\")\n    .style(\"border-radius\",\"12px\");\n\n  // panel frames + labels\n  for (let i=0; i<=K; i++){\n    const x0 = pad + i*panelW;\n\n    svg.append(\"rect\")\n      .attr(\"x\", x0 + 4).attr(\"y\", 8)\n      .attr(\"width\", panelW - 8).attr(\"height\", H - 16)\n      .attr(\"rx\", 12)\n      .attr(\"fill\",\"transparent\")\n      .attr(\"stroke\",\"rgba(255,255,255,0.12)\");\n\n    svg.append(\"text\")\n      .attr(\"x\", x0 + 12).attr(\"y\", 26)\n      .attr(\"font-size\", 13.5)\n      .attr(\"font-weight\", 750)\n      .attr(\"opacity\", 0.92)\n      .text(`z_${i}`);\n\n    if (i < K){\n      svg.append(\"text\")\n        .attr(\"x\", x0 + panelW - 6)\n        .attr(\"y\", H/2 + 6)\n        .attr(\"font-size\", 22)\n        .attr(\"opacity\", 0.55)\n        .text(\"→\");\n    }\n  }\n\n  // dots per panel (same indices, so we can interpolate)\n  const dotGroups = d3.range(K+1).map(i => {\n    const gx = svg.append(\"g\").attr(\"transform\", `translate(${pad + i*panelW},0)`);\n    return gx.selectAll(\"circle\")\n      .data(pts0.map((p, idx) => ({idx})))\n      .join(\"circle\")\n        .attr(\"r\", 1.55)\n        .attr(\"opacity\", 0.78);\n  });\n\n  const lerp = (a,b,t) => a + (b-a)*t;\n\n  function render(tms){\n    // stage cycles through transitions: z0->z1->...->zK\n    const speed = 1100;\n    const cycle = (tms / speed) % K;        // 0..K\n    const k = Math.floor(cycle);            // transition k -> k+1\n    const t = cycle - k;                    // 0..1\n\n    for (let i=0; i<=K; i++){\n      // each panel shows its final step, but panel i animates when it is the \"current\" step\n      let from = i, to = i;\n      if (i === k+1) { from = k; to = k+1; }   // animate the next panel filling in\n\n      const A = steps[from];\n      const B = steps[to];\n\n      dotGroups[i]\n        .attr(\"cx\", d => {\n          const a = A[d.idx], b = B[d.idx];\n          return xS(lerp(a[0], b[0], t));\n        })\n        .attr(\"cy\", d => {\n          const a = A[d.idx], b = B[d.idx];\n          return yS(lerp(a[1], b[1], t));\n        });\n    }\n\n    requestAnimationFrame(render);\n  }\n\n  requestAnimationFrame(render);\n  return svg.node();\n}\n\n\n"},{"methodName":"interpret","cellName":"ojs-cell-3","inline":false,"source":"d3 = require(\"d3@7\")\n\nflow_viz = {\n  // ↓↓↓ reduced size ↓↓↓\n  const W = 520, H = 260, pad = 18;\n\n  const xs = d3.scaleLinear().domain([-2,2]).range([pad, W-pad]);\n  const ys = d3.scaleLinear().domain([-1.4,1.4]).range([H-pad, pad]);\n\n  // ↓↓↓ slightly sparser grid ↓↓↓\n  const pts = [];\n  for (let x=-2; x<=2.001; x+=0.22)\n    for (let y=-1.4; y<=1.4001; y+=0.22)\n      pts.push([x,y]);\n\n  const svg = d3.create(\"svg\")\n    .attr(\"viewBox\", `0 0 ${W} ${H}`)\n    .style(\"width\",\"100%\")\n    .style(\"max-width\",\"520px\")\n    .style(\"height\",\"260px\")\n    .style(\"border\",\"1px solid rgba(255,255,255,0.18)\")\n    .style(\"border-radius\",\"10px\");\n\n  const label = svg.append(\"text\")\n    .attr(\"x\", 10).attr(\"y\", 18)\n    .attr(\"font-size\", 14)\n    .attr(\"font-weight\", 600);\n\n  const dots = svg.selectAll(\"circle\")\n    .data(pts)\n    .join(\"circle\")\n      .attr(\"r\", 1.6)\n      .attr(\"opacity\", 0.75);\n\n  function frame(tms){\n    const t = (Math.sin(tms/900) + 1) / 2;\n    const strength = (2*t - 1) * 0.55;\n\n    label.text(strength >= 0\n      ? \"Expansion\"\n      : \"Contraction\"\n    );\n\n    const warped = pts.map(([x0,y0]) => {\n      const r2 = x0*x0 + y0*y0 + 0.15;\n      const s = strength / r2;\n      return [x0 + s*x0, y0 + s*y0];\n    });\n\n    dots\n      .data(warped)\n      .attr(\"cx\", d => xs(d[0]))\n      .attr(\"cy\", d => ys(d[1]));\n\n    requestAnimationFrame(frame);\n  }\n\n  requestAnimationFrame(frame);\n  return svg.node();\n}\n\n"},{"methodName":"interpret","cellName":"ojs-cell-4","inline":false,"source":"\nalgo_diagram = {\n  const W = 980, H = 260;\n\n  const svg = d3.create(\"svg\")\n    .attr(\"viewBox\", `0 0 ${W} ${H}`)\n    .style(\"width\",\"100%\")\n    .style(\"max-width\",\"980px\")\n    .style(\"height\",\"260px\");\n\n  // ---- layout ----\n  const nodes = [\n    {id:\"mb\",  x:60,  y:60,  w:170, h:54, title:\"Mini-batch\",   sub:\"x ← {get mini-batch}\"},\n    {id:\"q0\",  x:270, y:60,  w:200, h:54, title:\"Base sample\",  sub:\"z₀ ~ q₀(z₀ | x)\"},\n    {id:\"flow\",x:520, y:60,  w:240, h:54, title:\"Flow map\",     sub:\"z_K = f_K∘…∘f₁(z₀)\"},\n    {id:\"F\",   x:810, y:60,  w:150, h:54, title:\"Free energy\",  sub:\"𝓕(x) ≈ 𝓕(x,z_K)\"},\n\n    {id:\"gth\", x:620, y:170, w:210, h:54, title:\"Update θ\",     sub:\"Δθ ∝ −∇_θ 𝓕(x)\"},\n    {id:\"gph\", x:360, y:170, w:210, h:54, title:\"Update ϕ\",     sub:\"Δϕ ∝ −∇_ϕ 𝓕(x)\"}\n  ];\n\n  const edges = [\n    [\"mb\",\"q0\"], [\"q0\",\"flow\"], [\"flow\",\"F\"],\n    [\"F\",\"gth\"], [\"F\",\"gph\"]\n  ];\n\n  // ---- defs: arrow ----\n  svg.append(\"defs\").append(\"marker\")\n    .attr(\"id\",\"arrow\")\n    .attr(\"viewBox\",\"0 0 10 10\")\n    .attr(\"refX\", 9).attr(\"refY\", 5)\n    .attr(\"markerWidth\", 8).attr(\"markerHeight\", 8)\n    .attr(\"orient\", \"auto-start-reverse\")\n    .append(\"path\")\n    .attr(\"d\",\"M 0 0 L 10 5 L 0 10 z\")\n    .attr(\"fill\",\"rgba(0,0,0,0.45)\");\n\n  // helper\n  const byId = new Map(nodes.map(d => [d.id, d]));\n  const centerRight = d => [d.x + d.w, d.y + d.h/2];\n  const centerLeft  = d => [d.x,       d.y + d.h/2];\n  const centerTop   = d => [d.x + d.w/2, d.y];\n  const centerBot   = d => [d.x + d.w/2, d.y + d.h];\n\n  // ---- edges ----\n  svg.append(\"g\")\n    .selectAll(\"path\")\n    .data(edges)\n    .join(\"path\")\n      .attr(\"fill\",\"none\")\n      .attr(\"stroke\",\"rgba(0,0,0,0.35)\")\n      .attr(\"stroke-width\", 2)\n      .attr(\"marker-end\",\"url(#arrow)\")\n      .attr(\"d\", ([a,b]) => {\n        const A = byId.get(a), B = byId.get(b);\n\n        // horizontal main chain\n        if ([\"mb\",\"q0\",\"flow\"].includes(a) && [\"q0\",\"flow\",\"F\"].includes(b)) {\n          const [x1,y1] = centerRight(A);\n          const [x2,y2] = centerLeft(B);\n          const mx = (x1+x2)/2;\n          return `M${x1},${y1} C${mx},${y1} ${mx},${y2} ${x2},${y2}`;\n        }\n\n        // down from F to updates\n        if (a === \"F\") {\n          const [x1,y1] = centerBot(A);\n          const [x2,y2] = centerTop(B);\n          const mx = (x1+x2)/2;\n          return `M${x1},${y1} C${x1},${y1+30} ${x2},${y2-30} ${x2},${y2}`;\n        }\n        return \"\";\n      });\n\n  // ---- nodes ----\n  const g = svg.append(\"g\").selectAll(\"g.node\")\n    .data(nodes)\n    .join(\"g\")\n      .attr(\"class\",\"node\")\n      .attr(\"transform\", d => `translate(${d.x},${d.y})`);\n\n  g.append(\"rect\")\n    .attr(\"width\", d => d.w)\n    .attr(\"height\", d => d.h)\n    .attr(\"rx\", 14)\n    .attr(\"fill\", \"rgba(255,255,255,0.85)\")\n    .attr(\"stroke\", \"rgba(0,0,0,0.18)\")\n    .attr(\"stroke-width\", 1.5);\n\n  g.append(\"text\")\n    .attr(\"x\", 14).attr(\"y\", 22)\n    .attr(\"font-size\", 14)\n    .attr(\"font-weight\", 800)\n    .text(d => d.title);\n\n  g.append(\"text\")\n    .attr(\"x\", 14).attr(\"y\", 42)\n    .attr(\"font-size\", 13)\n    .attr(\"opacity\", 0.85)\n    .text(d => d.sub);\n\n  // ---- cycling highlight ----\n  const hi = svg.append(\"rect\")\n    .attr(\"rx\", 14)\n    .attr(\"fill\", \"rgba(234,170,0,0.10)\")\n    .attr(\"stroke\", \"rgba(234,170,0,0.75)\")\n    .attr(\"stroke-width\", 3)\n    .attr(\"pointer-events\",\"none\");\n\n  const cycle = [\"mb\",\"q0\",\"flow\",\"F\",\"gth\",\"gph\"]; // matches pseudo-code order + both updates\n  let idx = 0;\n\n  function step(){\n    const d = byId.get(cycle[idx]);\n    hi.attr(\"x\", d.x).attr(\"y\", d.y).attr(\"width\", d.w).attr(\"height\", d.h);\n    idx = (idx + 1) % cycle.length;\n    setTimeout(step, 900);\n  }\n  step();\n\n  // small label: while loop\n  svg.append(\"text\")\n    .attr(\"x\", 60)\n    .attr(\"y\", 28)\n    .attr(\"font-size\", 14)\n    .attr(\"font-weight\", 700)\n    .attr(\"opacity\", 0.8)\n    .text(\"Repeat until converged\");\n\n  return svg.node();\n}\n\n"},{"methodName":"interpret","cellName":"ojs-cell-5","inline":false,"source":"\nbayesflow_algo_anim575 = {\n  const W = 1400, H = 520;\n\n  const svg = d3.create(\"svg\")\n    .attr(\"viewBox\", `0 0 ${W} ${H}`)\n    .style(\"width\",\"100%\")\n    .style(\"max-width\", `${W}px`)\n    .style(\"height\", `${H}px`);\n\n  // ---------- defs ----------\n  const defs = svg.append(\"defs\");\n\n  defs.append(\"marker\")\n    .attr(\"id\",\"arr\")\n    .attr(\"viewBox\",\"0 0 10 10\")\n    .attr(\"refX\", 9).attr(\"refY\", 5)\n    .attr(\"markerWidth\", 8).attr(\"markerHeight\", 8)\n    .attr(\"orient\",\"auto\")\n    .append(\"path\")\n    .attr(\"d\",\"M 0 0 L 10 5 L 0 10 z\")\n    .attr(\"fill\",\"rgba(0,0,0,0.55)\");\n\n  defs.append(\"filter\").attr(\"id\",\"sh\")\n    .append(\"feDropShadow\")\n      .attr(\"dx\", 0).attr(\"dy\", 1.2)\n      .attr(\"stdDeviation\", 1.2)\n      .attr(\"flood-opacity\", 0.18);\n\n  const g = svg.append(\"g\");\n\n  // ---------- helpers ----------\n  const box = (d, accent=false) => {\n    const gg = g.append(\"g\").attr(\"data-id\", d.id);\n\n    gg.append(\"rect\")\n      .attr(\"x\", d.x).attr(\"y\", d.y)\n      .attr(\"width\", d.w).attr(\"height\", d.h)\n      .attr(\"rx\", 16)\n      .attr(\"fill\", \"rgba(255,255,255,0.94)\")\n      .attr(\"stroke\", accent ? \"rgba(244,180,0,0.95)\" : \"rgba(0,0,0,0.16)\")\n      .attr(\"stroke-width\", accent ? 3 : 1.6)\n      .attr(\"filter\",\"url(#sh)\");\n\n    gg.append(\"text\")\n      .attr(\"x\", d.x + 16).attr(\"y\", d.y + 28)\n      .attr(\"font-size\", 16).attr(\"font-weight\", 850)\n      .text(d.title);\n\n    gg.append(\"text\")\n      .attr(\"x\", d.x + 16).attr(\"y\", d.y + 52)\n      .attr(\"font-size\", 12.5).attr(\"opacity\", 0.82)\n      .text(d.line1 || \"\");\n\n    if (d.line2){\n      gg.append(\"text\")\n        .attr(\"x\", d.x + 16).attr(\"y\", d.y + 72)\n        .attr(\"font-size\", 12.5).attr(\"opacity\", 0.82)\n        .text(d.line2);\n    }\n    return gg;\n  };\n\n  const center = d => [d.x + d.w/2, d.y + d.h/2];\n  const midR   = d => [d.x + d.w,   d.y + d.h/2];\n  const midL   = d => [d.x,         d.y + d.h/2];\n  const midB   = d => [d.x + d.w/2, d.y + d.h];\n  const midT   = d => [d.x + d.w/2, d.y];\n\n  const curvedLR = (A,B) => {\n    const [x1,y1] = A, [x2,y2] = B;\n    const mx = (x1+x2)/2;\n    return `M${x1},${y1} C${mx},${y1} ${mx},${y2} ${x2},${y2}`;\n  };\n\n  const curvedDown = (A,B, bow=60) => {\n    const [x1,y1] = A, [x2,y2] = B;\n    const my = (y1+y2)/2 + bow;\n    return `M${x1},${y1} C${x1},${my} ${x2},${my} ${x2},${y2}`;\n  };\n\n  const loopBelow = (fromA, toB, yLaneBottom) => {\n    const [x1,y1] = fromA;\n    const [x2,y2] = toB;\n\n    const yDown = yLaneBottom + 34;\n    const pull = 140;\n\n    return [\n      `M${x1},${y1}`,\n      `C${x1+pull},${y1} ${x1+pull},${yDown} ${x1},${yDown}`,\n      `C${(x1+x2)/2},${yDown} ${(x1+x2)/2},${yDown} ${x2},${yDown}`,\n      `C${x2-pull},${yDown} ${x2-pull},${y2} ${x2},${y2}`\n    ].join(\" \");\n  };\n\n  const loopBracket = ({x, y, w, h, label}) => {\n    const gg = g.append(\"g\");\n\n    gg.append(\"rect\")\n      .attr(\"x\", x).attr(\"y\", y)\n      .attr(\"width\", w).attr(\"height\", h)\n      .attr(\"rx\", 18)\n      .attr(\"fill\", \"rgba(244,180,0,0.06)\")\n      .attr(\"stroke\", \"rgba(244,180,0,0.55)\")\n      .attr(\"stroke-width\", 2)\n      .attr(\"stroke-dasharray\", \"8,6\");\n\n    gg.append(\"text\")\n      .attr(\"x\", x + 16).attr(\"y\", y - 10)\n      .attr(\"font-size\", 13.5)\n      .attr(\"font-weight\", 850)\n      .attr(\"opacity\", 0.90)\n      .text(label);\n\n    return gg;\n  };\n\n  // ---------- layout ----------\n  const yT = 120;\n  const yI = 360;\n\n  const train = [\n    {id:\"N\",   x:70,   y:yT, w:210, h:92, title:\"1) Sample N\",   line1:\"N ~ U(Nmin, Nmax)\"},\n    {id:\"th\",  x:320,  y:yT, w:210, h:92, title:\"2) Sample θ\",   line1:\"θ^(m) ~ p(θ)\"},\n    {id:\"sim\", x:570,  y:yT, w:230, h:92, title:\"3) Simulate x\", line1:\"x_i = g(θ^(m), ξ_i)\", line2:\"for i = 1..N\"},\n    {id:\"sum\", x:840,  y:yT, w:210, h:92, title:\"4) Summary\",    line1:\"x̃ = hψ(x₁:N)\"},\n    {id:\"fwd\", x:1090, y:yT, w:210, h:92, title:\"5) Flow (→)\",   line1:\"z = fϕ(θ; x̃)\"},\n  ];\n\n  const infer = [\n    {id:\"obs\", x:70,   y:yI, w:250, h:92, title:\"Inference input\", line1:\"observed x₁:N^o\"},\n    {id:\"sumo\",x:360,  y:yI, w:210, h:92, title:\"Summary\",         line1:\"x̃^o = hψ(x₁:N^o)\"},\n    {id:\"z\",   x:610,  y:yI, w:210, h:92, title:\"Sample latent\",   line1:\"z(l) ~ N(0, I)\"},\n    {id:\"inv\", x:860,  y:yI, w:250, h:92, title:\"Flow (←)\",        line1:\"θ^(l) = fϕ(z(l); x̃^o)\"},\n    // tweak return to be explicit (optional)\n    {id:\"out\", x:1150, y:yI, w:160, h:92, title:\"Return\",          line1:\"{θ^(l)}_{l=1}^L\"},\n  ];\n\n  const upd = {\n    id:\"updPanel\", x:1040, y:235, w:260, h:96,\n    title:\"Training objective\",\n    line1:\"compute loss \",\n    line2:\"update parameters: ϕ, ψ\"\n  };\n\n  // titles\n  const tag = (x,y,text) => {\n    g.append(\"text\")\n      .attr(\"x\", x).attr(\"y\", y)\n      .attr(\"font-size\", 14).attr(\"font-weight\", 900)\n      .attr(\"opacity\", 0.85)\n      .text(text);\n  };\n  tag(70, 95,  \"TRAINING PHASE (repeat)\");\n  tag(70, 335, \"INFERENCE PHASE (given observed data)\");\n\n  // entry/exit gates\n  const gate = (x,y,label) => {\n    const gg = g.append(\"g\");\n    gg.append(\"circle\")\n      .attr(\"cx\",x).attr(\"cy\",y).attr(\"r\",10)\n      .attr(\"fill\",\"rgba(244,180,0,0.95)\")\n      .attr(\"stroke\",\"rgba(0,0,0,0.18)\");\n    gg.append(\"text\")\n      .attr(\"x\",x+16).attr(\"y\",y+5)\n      .attr(\"font-size\", 13).attr(\"font-weight\", 850)\n      .attr(\"opacity\", 0.85)\n      .text(label);\n  };\n  gate(40, yT + 46, \"enter repeat\");\n  gate(40, yI + 46, \"exit with posterior samples\");\n\n  // draw boxes\n  const nodes = [...train, ...infer, upd];\n  const map = new Map(nodes.map(d => [d.id, d]));\n\n  const nodeG = new Map();\n  train.forEach(d => nodeG.set(d.id, box(d, false)));\n  infer.forEach(d => nodeG.set(d.id, box(d, false)));\n  nodeG.set(upd.id, box(upd, true));\n\n  // loop annotations (m and i)\n  const mLeft  = map.get(\"th\").x - 18;\n  const mTop   = map.get(\"th\").y - 22;\n  const mRight = map.get(\"fwd\").x + map.get(\"fwd\").w + 18;\n  const mBot   = map.get(\"fwd\").y + map.get(\"fwd\").h + 18;\n\n  loopBracket({\n    x: mLeft,\n    y: mTop,\n    w: mRight - mLeft,\n    h: mBot - mTop,\n    label: \"for m = 1..M  (mini-batch)\"\n  });\n\n  const simBox = map.get(\"sim\");\n  loopBracket({\n    x: simBox.x - 12,\n    y: simBox.y - 14,\n    w: simBox.w + 24,\n    h: simBox.h + 28,\n    label: \"for i = 1..N  (simulate observations)\"\n  });\n\n  // NEW: inference loop over l = 1..L (covers Sample latent + Flow inverse)\n  const zBox = map.get(\"z\");\n  const invBox = map.get(\"inv\");\n  const lLeft  = zBox.x - 14;\n  const lTop   = zBox.y - 22;\n  const lRight = invBox.x + invBox.w + 14;\n  const lBot   = invBox.y + invBox.h + 18;\n\n  loopBracket({\n    x: lLeft,\n    y: lTop,\n    w: lRight - lLeft,\n    h: lBot - lTop,\n    label: \"for l = 1..L  (posterior samples)\"\n  });\n\n  // main lane arrows\n  const drawEdges = (arr) => {\n    g.append(\"g\")\n      .selectAll(\"path.e\")\n      .data(arr)\n      .join(\"path\")\n        .attr(\"fill\",\"none\")\n        .attr(\"stroke\",\"rgba(0,0,0,0.28)\")\n        .attr(\"stroke-width\", 2.2)\n        .attr(\"marker-end\",\"url(#arr)\")\n        .attr(\"d\", ([a,b]) => curvedLR(midR(map.get(a)), midL(map.get(b))));\n  };\n\n  drawEdges([[\"N\",\"th\"],[\"th\",\"sim\"],[\"sim\",\"sum\"],[\"sum\",\"fwd\"]]);\n  drawEdges([[\"obs\",\"sumo\"],[\"sumo\",\"z\"],[\"z\",\"inv\"],[\"inv\",\"out\"]]);\n\n  // Flow -> Training objective\n  g.append(\"path\")\n    .attr(\"fill\",\"none\")\n    .attr(\"stroke\",\"rgba(0,0,0,0.28)\")\n    .attr(\"stroke-width\", 2.2)\n    .attr(\"marker-end\",\"url(#arr)\")\n    .attr(\"d\", curvedDown(midB(map.get(\"fwd\")), midT(map.get(\"updPanel\")), 70));\n\n  // repeat loop: objective -> Sample N (under boxes)\n  const yTrainBottom = yT + 92;\n  g.append(\"path\")\n    .attr(\"fill\",\"none\")\n    .attr(\"stroke\",\"rgba(0,0,0,0.18)\")\n    .attr(\"stroke-width\", 2.1)\n    .attr(\"marker-end\",\"url(#arr)\")\n    .attr(\"d\", loopBelow(midL(map.get(\"updPanel\")), midL(map.get(\"N\")), yTrainBottom));\n\n  // ---------- animation ----------\n  const steps = [\n    \"N\",\"th\",\"sim\",\"sum\",\"fwd\",\"updPanel\",\"N\",\n    \"obs\",\"sumo\",\"z\",\"inv\",\"out\"\n  ];\n\n  const packet = g.append(\"circle\")\n    .attr(\"r\", 6)\n    .attr(\"fill\",\"rgba(0,0,0,0.65)\")\n    .attr(\"opacity\", 0.85);\n\n  function setAccent(id){\n    [...train, ...infer].forEach(d => {\n      nodeG.get(d.id).select(\"rect\")\n        .attr(\"stroke\",\"rgba(0,0,0,0.16)\")\n        .attr(\"stroke-width\", 1.6);\n    });\n    nodeG.get(\"updPanel\").select(\"rect\")\n      .attr(\"stroke\",\"rgba(244,180,0,0.95)\")\n      .attr(\"stroke-width\", 3);\n\n    if (id !== \"updPanel\"){\n      nodeG.get(id).select(\"rect\")\n        .attr(\"stroke\",\"rgba(244,180,0,0.95)\")\n        .attr(\"stroke-width\", 3);\n    }\n  }\n\n  const lerp = (a,b,t) => a + (b-a)*t;\n\n  function tick(tms){\n    const T = 1200;\n    const k = Math.floor((tms / T) % steps.length);\n    const t = (tms / T) % 1;\n\n    const a = steps[k];\n    const b = steps[(k+1) % steps.length];\n\n    setAccent(a);\n\n    const A = center(map.get(a));\n    const B = center(map.get(b));\n\n    packet\n      .attr(\"cx\", lerp(A[0], B[0], t))\n      .attr(\"cy\", lerp(A[1], B[1], t));\n\n    requestAnimationFrame(tick);\n  }\n  requestAnimationFrame(tick);\n\n  return svg.node();\n}\n\n\n"},{"methodName":"interpret","cellName":"ojs-cell-6","inline":false,"source":"nf_methods_timeline = {\n  const W = 1000, H = 440;\n  const svg = d3.create(\"svg\")\n    .attr(\"viewBox\", `0 0 ${W} ${H}`)\n    .style(\"width\",\"100%\")\n    .style(\"max-width\",\"980px\")\n    .style(\"height\",\"440px\");\n\n  // ---------- defs ----------\n  const defs = svg.append(\"defs\");\n\n  defs.append(\"marker\")\n    .attr(\"id\",\"arrow\")\n    .attr(\"viewBox\",\"0 0 10 10\")\n    .attr(\"refX\", 9).attr(\"refY\", 5)\n    .attr(\"markerWidth\", 8).attr(\"markerHeight\", 8)\n    .attr(\"orient\",\"auto\")\n    .append(\"path\")\n    .attr(\"d\",\"M 0 0 L 10 5 L 0 10 z\")\n    .attr(\"fill\",\"rgba(0,0,0,0.55)\");\n\n  defs.append(\"filter\").attr(\"id\",\"glow\")\n    .append(\"feDropShadow\")\n      .attr(\"dx\", 0).attr(\"dy\", 0)\n      .attr(\"stdDeviation\", 2.2)\n      .attr(\"flood-opacity\", 0.30);\n\n  // ---------- frame ----------\n  svg.append(\"rect\")\n    .attr(\"x\", 18).attr(\"y\", 26)\n    .attr(\"width\", W-36).attr(\"height\", H-52)\n    .attr(\"rx\", 10)\n    .attr(\"fill\",\"white\")\n    .attr(\"stroke\",\"rgba(0,0,0,0.25)\");\n\n  svg.append(\"text\")\n    .attr(\"x\", 22).attr(\"y\", 18)\n    .attr(\"font-size\", 12)\n    .attr(\"opacity\", 0.8)\n    .text(\"IEEE TRANSACTIONS ON PATTERN ANALYSIS AND MACHINE INTELLIGENCE\");\n\n  // ---------- left-side taxonomy ----------\n  const items = [\n    {sec:\"§3.1\", title:\"Elementwise bijections\", sub:\"Non-linear elementwise transform\",\n     prob:\"Problem: no mixing of variables\", color:\"#b00020\"},\n    {sec:\"§3.2\", title:\"Linear flows\", sub:\"Affine combination of variables\",\n     prob:\"Problem: limited representational power\", color:\"#b00020\"},\n    {sec:\"§3.3\", title:\"Planar and radial flows\", sub:\"Non-linear transforms\",\n     prob:\"Problem: hard to compute inverse\", color:\"#b00020\"},\n    {sec:\"§3.4.1\", title:\"Coupling flows\",\n     sub:\"Architectures that allow invertible non-linear transformations\",\n     prob:\"Depend on coupling\", color:\"#1b7f3a\"},\n    {sec:\"§3.4.2\", title:\"Autoregressive flows\",\n     sub:\"Architectures that allow invertible non-linear transformations\",\n     prob:\"Depend on coupling\", color:\"#1b7f3a\"},\n    {sec:\"§3.5\", title:\"Residual flows\", sub:\"Invertible residual networks\",\n     prob:\"\", color:\"#1b7f3a\"},\n    {sec:\"§3.6\", title:\"Infinitesimal flows\",\n     sub:\"Continuous flows depending on ODEs or SDEs\",\n     prob:\"\", color:\"#1b7f3a\"}\n  ];\n\n  const leftX = 42;\n  const startY = 70;\n  const rowH = 50;\n\n  const rows = svg.append(\"g\")\n    .selectAll(\"g.row\")\n    .data(items)\n    .join(\"g\")\n    .attr(\"transform\", (d,i)=>`translate(${leftX},${startY+i*rowH})`);\n\n  rows.append(\"rect\")\n    .attr(\"x\",-12).attr(\"y\",-18)\n    .attr(\"width\",460).attr(\"height\",42)\n    .attr(\"rx\",10)\n    .attr(\"fill\",\"rgba(244,180,0,0.08)\")\n    .attr(\"stroke\",\"rgba(244,180,0,0.85)\")\n    .attr(\"stroke-width\",2.5)\n    .attr(\"opacity\",0)\n    .attr(\"filter\",\"url(#glow)\");\n\n  rows.append(\"text\")\n    .attr(\"x\",0).attr(\"y\",-2)\n    .attr(\"font-size\",16)\n    .attr(\"font-weight\",700)\n    .text(d=>`${d.sec}  ${d.title}`);\n\n  rows.append(\"text\")\n    .attr(\"x\",20).attr(\"y\",16)\n    .attr(\"font-size\",12.5)\n    .attr(\"fill\",\"#1b7f3a\")\n    .text(d=>d.sub);\n\n  rows.append(\"line\")\n    .attr(\"x1\",330).attr(\"x2\",380)\n    .attr(\"y1\",-6).attr(\"y2\",-6)\n    .attr(\"stroke\",\"rgba(0,0,0,0.5)\")\n    .attr(\"stroke-width\",1.8);\n\n  rows.append(\"path\")\n    .attr(\"d\",\"M380,-6 L450,-6\")\n    .attr(\"stroke\",\"rgba(0,0,0,0.5)\")\n    .attr(\"stroke-width\",1.8)\n    .attr(\"marker-end\",\"url(#arrow)\");\n\n  rows.append(\"text\")\n    .attr(\"x\",462).attr(\"y\",-2)\n    .attr(\"font-size\",12.5)\n    .attr(\"font-weight\",650)\n    .attr(\"fill\",d=>d.color)\n    .text(d=>d.prob);\n\n  // ---------- coupling-functions box (MOVED DOWN) ----------\n  const cf = {\n    x: 640,\n    y: 210,          // << MOVED DOWN\n    w: 300,\n    h: 210,\n    bullets: [\n      \"Affine\",\n      \"Non-linear squared\",\n      \"Continuous mixture CDFs\",\n      \"Splines\",\n      \"Neural autoregressive\",\n      \"Sum-of-squares polynomial\",\n      \"Piecewise-bijective\"\n    ]\n  };\n\n  svg.append(\"rect\")\n    .attr(\"x\",cf.x).attr(\"y\",cf.y)\n    .attr(\"width\",cf.w).attr(\"height\",cf.h)\n    .attr(\"rx\",10)\n    .attr(\"fill\",\"white\")\n    .attr(\"stroke\",\"rgba(0,0,0,0.45)\")\n    .attr(\"stroke-width\",1.6);\n\n  svg.append(\"text\")\n    .attr(\"x\",cf.x+14).attr(\"y\",cf.y+26)\n    .attr(\"font-size\",15)\n    .attr(\"font-weight\",750)\n    .text(\"§3.4.4  Coupling functions\");\n\n  svg.selectAll(\"text.cf\")\n    .data(cf.bullets)\n    .join(\"text\")\n      .attr(\"x\",cf.x+18)\n      .attr(\"y\",(d,i)=>cf.y+54+i*22)\n      .attr(\"font-size\",13)\n      .text(d=>\"• \"+d);\n\n  // ---------- connectors ----------\n  function connector(y0){\n    const x1 = leftX + 380;\n    const x2 = cf.x - 12;\n    const y2 = cf.y + 22;\n    const mx = (x1+x2)/2 + 40;\n    return `M${x1},${y0} C${mx},${y0} ${mx},${y2} ${x2},${y2}`;\n  }\n\n  const conn = svg.append(\"path\")\n    .attr(\"fill\",\"none\")\n    .attr(\"stroke\",\"rgba(0,0,0,0.35)\")\n    .attr(\"stroke-width\",2)\n    .attr(\"marker-end\",\"url(#arrow)\");\n\n  // ---------- animation ----------\n  let k = 0;\n  const T = 1700;\n\n  function focus(i){\n    rows.select(\"rect\").attr(\"opacity\",0);\n    rows.filter((d,idx)=>idx===i)\n      .select(\"rect\").attr(\"opacity\",1);\n\n    if (i===3 || i===4){\n      const y0 = startY + i*rowH - 6;\n      conn.attr(\"d\",connector(y0)).attr(\"opacity\",1);\n    } else {\n      conn.attr(\"opacity\",0);\n    }\n  }\n\n  function loop(){\n    focus(k);\n    k = (k+1)%items.length;\n    d3.timeout(loop,T);\n  }\n\n  focus(0);\n  d3.timeout(loop,T);\n\n  return svg.node();\n}\n"}]}
    </script>
    <script type="module">
    window._ojs.paths.runtimeToDoc = "../../..";
    window._ojs.paths.runtimeToRoot = "../../..";
    window._ojs.paths.docToRoot = "";
    window._ojs.selfContained = false;
    window._ojs.runtime.interpretFromScriptTags();
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        setTimeout(function() {
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const cites = ref.parentNode.getAttribute('data-cites').split(' ');
        tippyHover(ref, function() {
          var popup = window.document.createElement('div');
          cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    });
    </script>
    <div class="mizzou-footer-bar">
      <div class="mizzou-left">
        <img src="assets/mizzou-logo.svg" alt="Mizzou logo">
      </div>
      <div class="mizzou-right">
        Department of Statistics / Class 9100
      </div>
    </div>

    <a class="home-btn" href="#outline" title="Go to Outline" aria-label="Go to Outline">
      <svg viewbox="0 0 24 24" aria-hidden="true">
        <path d="M3 10.5L12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1z"></path>
      </svg>
    </a>
    - flow-demo.js
    

</body></html>